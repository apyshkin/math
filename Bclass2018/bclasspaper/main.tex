\documentclass[12pt]{article}
\input{preamble}
\usepackage{tikz}
\usepackage{tkz-berge}
\usetikzlibrary{positioning, chains, fit, shapes, calc}

\begin{document}
% \title{Методы суммирования ряда Фурье \\
% относительно системы Азоффа--Шехада}

% \author{Алексей Пышкин\thanks{Работа поддержана грантом Президента РФ для государственной 
% поддержки молодых российских учёных -- докторов наук МД-5758.2015.1.}}
% \date{}

\section{B-class of vector systems}
  \subsection{From vector system to the countable network: linear summation problem}
    \label{fsys2graphs}
    We are interested in the completeness properties of the minimal vector system $\fsys = \seq{f}$
      in a separable real [TODO complex] Hilbert space $\cal{H}$.
    Suppose that $\cal{H}$ has an orthonormal basis $\seq{e}$.
    Let $\fstarsys = \seq{f^*}$ be a biorthogonal vector system to the original system $\seq{f}$.
    \begin{definition}
        The vector system $\fsys$ belongs to the \emph{B-class} whenever the following conditions are satisfied:
        \begin{itemize}
            \item either $f_n = e_n$ or $f^*_n = e_n$ for any $n > 0$,
            \item $\inner{f_n}{e_n} = \inner{f^*_n}{e_n} = 1$ for any $n > 0$,
            \item $\inner{f_n}{e_k} = -\inner{f^*_k}{e_n}$ for any $n, k > 0$,
            \item the matrices $\{\inner{f_n}{e_k}\}$ and $\{\inner{f^*_n}{e_k}\}$ are both finite-band.
        \end{itemize}
    \end{definition}
    This class of vector systems is the subject of this section.
    \begin{prop}
      The definition given above guarantees the biorthogonality of the $f_n$ and $f^*_n$.
    \end{prop}
    \begin{proof}
      Straightforward check.
    \end{proof}
    B-class has an interesting property we are going to exploit later.
    \begin{prop}
      A vector system which belongs to the B-class could be associated with a
      weighted bipartite graph $B(\fsys) = (V, E, \wt)$, where $\wt$ is a
      real-valued function on the $V\times V$ such that $\wt(v, u) = -\wt(u, v)$.
      Also the inverse is true: for each bipartite graph $(V, E, \wt)$ for which the weight function
      $\wt$ (or later it becomes the \emph{length} function) satisfies the conditions above there is a vector system from the B-class.
    \end{prop}
    \begin{proof}
      For each index $l > 0$ such that $f^*_l = e_l$ we put a vertex $v_l$ in the first part of the bipartite graph.
      We will call this part from now on the \emph{left} part of the graph $B(\fsys)$.
      For any other index $r > 0$ we construct a vertex in the other part of the graph.
      Evidently, for such indices $r > 0$ the condition $f_r = e_r$ holds due to the definition of the B-class vector systems.
      The second part of the graph will be referred as the \emph{right} part of the graph $B(\fsys)$.
      We put an edge between two vertices $v_l$ and $v_r$ from the left and right parts respectively,
      whenever the scalar product $\inner{f_l}{e_r}$ is not zero.
      For such two vertices we have $\inner{f_l}{e_r}$ = $-\inner{f_r}{e_l}$.
      Denote by $\wt_{lr}$ the expression $\wt_{lr} = \inner{f_l}{e_r}^{-1}$.
      Obviously $\wt_{lr} = -\wt_{rl}$.

      Conversely,
    \end{proof}
    \begin{remark}
      Note that the Azoff-Shehada vector system~\cite{azoff} lies in the B-class.
    \end{remark}
    \begin{example}
      The graph $B(\fsys_{AS})$ for the AS system looks like this:
      \definecolor{myblue}{RGB}{80,80,160}
      \definecolor{mygreen}{RGB}{80,160,80}
      \begin{center}
      \begin{tikzpicture}[auto,
                          thick,
                          every node/.style={draw,circle},
                          lnode/.style={draw,fill=gray},
                          rnode/.style={draw},
                          every fit/.style={ellipse,draw,inner sep=-1pt,text width=2cm},
                          ]

        \begin{scope}[start chain=going below,node distance=7mm]
          \foreach \i in {1,3,5,7}
          \node[lnode,on chain] (l\i) [label=left: $v_{l_\i}$] {$e_{\i}$};
          \node[draw=none,on chain, yshift=7mm]{$\vdots$};
        \end{scope}
        \begin{scope}[xshift=4cm,yshift=-0.5cm,start chain=going below,node distance=7mm]
          \foreach \i in {2,4,6,8}
          \node[rnode,on chain] (r\i) [label=right: $v_{r_\i}$] {$e_\i$};
          \node[draw=none,on chain, yshift=7mm]{$\vdots$};
        \end{scope}

        % the set U
        %\node [fit=(l1) (l5),label=above:\emph{left}] {};
        % the set V
        %\node [fit=(r6) (r9),label=above:\emph{right}] {};

        % the edges
        \draw (l1) -- (r2);
        \draw (r2) -- (l3);
        \draw (l3) -- (r4);
        \draw (r4) -- (l5);
        \draw (l5) -- (r6);
        \draw (r6) -- (l7);
        \draw (l7) -- (r8);
      \end{tikzpicture}
      \end{center}
    \end{example}
    We are going to find the necessary and sufficient condition for the $k$-completeness property for the B-class vector system.
    In order to pursue that we need to investigate the conditions, under which the B-class system admits a linear summation method.
    First of all we intend to demonstrate an elegant reformulation of the linear summation method existence problem for
      the B-class vector systems.
    Recall that there exists a linear summation method for the system $\seq{f}$
      iff there is no trace class operator $T: \cal{H} \to \cal{H}$ with the trace equal to $1$,
      such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$.
    Suppose that there is such an operator $T$ such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$.
    There are two cases: either $f^*_n = e_n$ or $f_n = e_n$.
    In the first case the condition $\inner{Tf_n}{f_n^*} = 0$ turns into
    \begin{equation}
        \label{left-eqn}
        \sum_j T_{nj} \inner{f_n}{e_j} = 0,
    \end{equation}
    and in the second case it is equivalent to 
    \begin{equation}
        \label{right-eqn}
        \sum_j T_{jn} \inner{f^*_n}{e_j} = 0.
    \end{equation}
    Now consider a real function $\flowsgn(T): E \to \mathbb{R}$
    on the edges of the graph $B(\fsys)$.
    \begin{align*}
        &\flowsgn(v_l, v_r) := T_{lr} \inner{f_l}{e_r} = T_{lr} \wt_{lr}^{-1},\\
        &\flowsgn(v_r, v_l) := T_{lr} \inner{f^*_r}{e_l} = T_{lr} \wt_{rl}^{-1}.
    \end{align*}
    Observe that $\flowsgn(T)$ is a skew-symmetric function.
    Moreover, two equalities~\eqref{left-eqn} and~\eqref{right-eqn} correspond to the \emph{left} and \emph{right}
      parts of the bipartite graph $B(\fsys)$ respectively.
    It follows that the condition $\inner{Tf_n}{f_n^*} = 0$ could be reduced to the simpler one:
    \begin{equation}
      \label{almost-flow-eqn}
      \sum_{u \in V} \flowsgn(v, u) + T_{vv} = 0
    \end{equation}
      for each vertex $v$ in the graph $B(\fsys)$.
    \begin{remark}
      Notice how the function $\flow$ defined on the graph $B(\fsys)$ resembles
      a \emph{flow} defined on the edges of the $B(\fsys)$ graph.
      One might also see that the equation~\eqref{almost-flow-eqn} describes the total flow (sum of the outgoing flow and incoming flow) 
      for each vertex $v$ in the graph $B(\fsys)$
      In order to formalize this observation we are going to build a flow function
      after a few changes are made to the graph $B(\fsys)$.
    \end{remark}
    Before we proceed we are going to introduce a few basic definitions.
    \begin{definition}
        \emph{Network} $\net$ is a quadruple $(G, \wtp, s, t)$, where $G = (V, E)$ is weighted graph
        with a positive length function $\wtp$ on $E$ and two vertices $s, t \in V$, which
        we will call $\source$ and $\sink$ of the network respectively.
    \end{definition}
    \begin{definition}
        Look at the skew-symmetric function $\flow: V \times V \to R$.
        The function $\flow$ will be called a \emph{pseudo-flow}.
    \end{definition}
    \begin{definition}
      Let $G = (V, \vec{E})$ be an oriented graph.
      For each vertex $v \in V$ we take $\ein(v)$ as the set of incoming edges
      and $\eout(v)$ as the set of outgoing edges in the graph $G$.
      For the set of vertices $V_0$ we denote
      \begin{align*}
        &\ein(V_0) = \big\{\ein(v) \mid v\in V_0\big\},\\
        &\eout(V_0) = \big\{\eout(v) \mid v\in V_0\big\}.
      \end{align*}
      For the subgraph $G_0 = (V_0, E_0) \subseteq G$ we denominate a little differently
      \begin{align*}
        &\ein(G_0) = \big\{(uv)\in E_0 \mid u \in V \setminus V_0, v \in V_0\big\},\\
        &\eout(G_0) = \big\{(uv) \in E_0 \mid u \in V_0, v \in V\setminus V_0\big\}.
      \end{align*}
      For each edge $e=(uv) \in \vec{E}$ we are going to denote by $\init(e)$ the starting vertex
      $u$ and by $\ter(e)$ the ending vertex $v$.
      For the set of edges $E_0$ we denote
      \begin{align*}
        &\init(E_0) = \big\{\init(e) \mid e\in E_0\big\},\\
        &\ter(E_0) = \big\{\ter(e) \mid e\in E_0\big\}.
      \end{align*}
    \end{definition}
    \begin{definition}
      Let $\net = (G, \wtp, s, t)$ be a network, and $\flow$ be a pseudo-flow function.
      Also denote by $d_{+}(v)$ the sum of the flows \emph{leaving} the node $v$ and by
      $d^{-}(v)$ the sum of the flows \emph{entering} $v$:
      \begin{align*}
        &d^{+}_{\flow}(v) = d^{+}(v) := \sum_{u \in \eout(v)} \flow(vu),\\
        &d^{-}_{\flow}(v) = d^{-}(v) := \sum_{u \in \ein(v)} \flow(uv).
      \end{align*}
      Also let $d(v)$ be equal to $d^{+}(v) - d^{-}(v)$. Sometimes we will refer to this value as
      a \emph{total flow} of the vertex $v$.
      The vertex is called \emph{$\flow$-active} iff $d(v)$ is less than zero,
      \emph{$\flow$-deficient} iff $d(v)$ is greater than zero and
      \emph{$\flow$-preserving} iff $d(v)$ is precisely zero, meaning that the total incoming flow
      is equal to the total outgoing flow of the vertex $v$.
    \end{definition}
    \begin{definition}
      Given a network $\net = (V, E, \wtp, s, t)$ and a pseudo-flow function $\flow$ we will name $\flow$ a
        \emph{flow} function iff for any vertex $v \in V \setminus \{s,t\}$ the total flow is zero: $d(v) = 0$.
    \end{definition}
    \begin{definition}
      For a network $\net = (G, \wtp, s, t)$ and a flow $\flow$ we will say,
      that the flow $\flow$ is \emph{$\flow$-preserving} if $d(\sink) = -d(\source)$ vertex.
    \end{definition}
    \begin{note}
      In simple words this property suggests
        that the total flow coming out of the $\source$ is equal to the total flow
        coming into the $\sink$.
    \end{note}
    \begin{definition}
      \emph{Oriented network} $\onet$ is a quadruple $(\vec{G}, \wtp, s, t)$, where
        $\vec{G}$ is an oriented weighted graph with
        a positive length function $\wtp$ on $\vec{E}$ and two vertices $s, t \in V$, which
        we will call $\source$ and $\sink$ of the oriented network respectively.
    \end{definition}
    \begin{note}
      The flow functions could be defined on the oriented networks in the similar manner
      we defined on the non-oriented networks.
    \end{note}
    Suppose $\net = (V, E, \wtp, s, t)$ is a network and $\flow$ is a skew-symmetric function defined
    on $\net$.
    Naturally, we might instead consider an oriented network $\onet = (V, \vec{E}, \wtp_{*}, s, t)$ and a 
      positive flow function $\flowpos: \vec{E} \to \mathbb{R}^{+}$, where
      the set of vertices $V$, $\source$ and $\sink$ vertices are the same.
    The length function $\wtp_{*}$ will be also positive but will be redefined since the edges set $\vec{E}$ is a different one.
    First we provide a direction of the edge $(uv)$ is as follows:
    \begin{itemize}
      \item $(uv) \in \vec{E}$ if $\flow(u, v) > 0$,
      \item $(vu) \in \vec{E}$ if $\flow(u, v) < 0$.
    \end{itemize}
    This way only one of the edges $(uv)$ and $(vu)$ is present in the graph $\vec{G} = (V, \vec{E})$.
    Also we set up the edge length and the positive flow function $\flowpos: E \to \mathbb{R}^{+}$ so that
    for any edge $\vec{e} = (uv) \in \vec{E}$
    \begin{align*}
      &\flowpos(uv) = |\flow(u,v)|,\\
      &\wtp_{*}(uv) = \wtp(u,v).
    \end{align*}
    \begin{definition}
      The oriented network $\onet$ is called an \emph{orientation} of the network $\net$.
      For the positive flow function $\flowpos$ we will use the same term:
        $\flowpos$ is an \emph{orientation} of the flow $\flow$.
    \end{definition}
    \begin{remark}
      As shown, the flow functions on the networks and the positive flow functions on the oriented networks
        are interchangeable and describe the same object.
      The notion of the direction of the positive flow over the particular edge $(uv)$ in the oriented network
        is incorporated into the sign of the flow function on the same edge $(uv)$ in the non-oriented network.
    \end{remark}
    \begin{definition}
      Consider a network $\net = (G, \wtp, s, t)$ such that
        the degree of each vertex in $V \setminus \{s, t\} $ is finite,
        and the length of each edge incident to $\source$ or to $\sink$ is equal to one.
      We will call such network a \emph{B-class network}.
    \end{definition}
    
    Now we are ready to continue with the linear summation method problem.
    Our aim is to build up a network from the graph $B(\fsys)$.
    We plan to construct the network $\net(\fsys) = (V, E, \wtp, s, t)$,
    positive length function $\wtp: E \to R^{+}$ and a real skew-symmetric flow function $\flow: V \times V \to R$.
    Firstly we consider the vertices and the edges of the graph $B(\fsys)$.
    All the vertices in the graph $B(\fsys)$ we incorporate into the network $\net(\fsys)$.
    The vertex set of the new graph is a superset of vertices of the graph $B(\fsys)$,
    so we will continue referring to the vertices as the vertices from 
    the \emph{left} part of the graph and the vertices from the \emph{right} part of the graph.
    The network $\net(\fsys)$ will contain all the edges from the graph $B(\fsys)$ as well.
    For each of these edges we are going to assign the flow function $\flow$ and
    establish a new positive length function $\wtp$.
    Each edge $e = (v_l v_r)$ which belongs to the graph $B(\fsys)$ we include in the graph of $\net(\fsys)$.
    We set the flow and the length functions on the edge $e$:
    \begin{align*}
      &\flow(v_l, v_r) = \flowsgn(v_r, v_l) = T_{lr} \inner{f^*_r}{e_l},\\
      &\wtp(e) = \left| \wt(e) \right|.
    \end{align*}
    Evidently on this kind of edges the flow functions $\flowsgn$ and $\flow$ agree.
    
    Now we add the $\source$ vertex $s$ and the $\sink$ vertex $t$ to the constructed graph.
    Suppose we have enumerated the vertices from the left part of the graph, for instance $\seq{l}$.
    Then for each $k > 0$ we connect the $\source$ vertex and the $l_k$ vertex with
      the edge $e_k = (s l_k)$, and put a flow:
    \begin{align*}
      &\flow(l_k, s) = T_{l_k l_k},\\
      &\flow(s, l_k) = -T_{l_k l_k}.
    \end{align*}
    We have the length equal to one for such edges: $\wtp(e) = 1$.
    As we added the edges ${e_k}$, the flow became \emph{preserved} at each vertex of the left part of the network $\net(\fsys)$.
    In the similar manner we will transform the right part of the graph.
    Assuming we have the vertices from the right part of the graph $B(\fsys)$ in the form of the sequence $\seq{r}$,
      for each $k > 0$ we connect the $r_k$ vertex to the $\sink$ with the edge $e'_k=(r_k t)$
      and set the flow equal to:
    \begin{align*}
      &\flow(r_k, t) = T_{r_k r_k},\\
      &\flow(t, r_k) = -T_{r_k r_k}.
    \end{align*}
    For these edges we put the length equal to one as well.
    The network $\net(\fsys)$ is built up, and it is a B-class network.
    The defined function $\flow$ is a flow, since each of the vertex preserves
      $\flow$ due to the equation~\eqref{almost-flow-eqn}.
    %\begin{remark}
      %Sometimes it might be useful to consider slightly different definition of the network.
      %Instead of studying an oriented graph with a positive flow function on it we might consider
      %an undirected graph with a skew-symmetric flow function on the edges.
      %Intuitively, the direction of the flow could be expressed either via the direction of the edge
      %or with the sign of the flow function, and these two definitions describe the same objects.
      %Formally there is a isomorphism between these two types of objects.
    %\end{remark}
    %\begin{definition}
      %Let $\net=(V,E,\flow)$ be a network -- an oriented graph with a positive flow function $\flow$ on it.
      %Consider an undirected graph $G=(V,E')$ such that $e=(vu)$ belongs to $E'$ iff
      %either $(vu) \in E$ or $(uv) \in E$.
      %Such undirected graph we will call the \it{frame} of the network $\net$.
      %Also define a function $\flowsgn$ on the $V \times V$:
      %\begin{align*}
        %\flowsgn(vu) = \flow(vu), \quad \text{if edge } (vu) \in E,\\
        %\flowsgn(vu) = -\flow(vu), \quad \text{if edge } (uv) \in E.
      %\end{align*}
      %Such function we will call \it{sign-flow} function.
    %\end{definition}
    %Regard the orientation $\onet = (\vec{B}(\fsys), \wtp, s, t)$ of the established network $\net(\fsys)$.
    \begin{remark}
      Pay your attention to the fact that the network $\net(\fsys)$
      depends only on the biorthogonal system $\fsys$ and not on the operator $T$.
      Only the constructed flow function $flow$ depends on the operator $T$.
    \end{remark}
    What can one say about the total flow in each of the vertex of the constructed network $\net(\fsys)$?
    Due to the trick we performed the total flow became zero in each of the vertices from the \emph{left} and the \emph{right} parts.
    The total flow $d(\source)$ in the $\source$ vertex is equal to the $\sum T_{l_k l_k}$, and the total flow in the
    $\sink$ vertex is now equal to the $\sum T_{r_k r_k}$.
    Now one can see that the network $\net(\fsys)$ is $\flow$-preserving if and only if the trace of the operator $T$ is equal to
    zero.
    \begin{definition}
      Consider a network $\net = (V, E, \wtp)$ and a flow function $\flow$ on it.
      We introduce a non-negative function $\|\flow\|$ which we call the \emph{mass} of the flow $\flow$.
      \[
        \|\flow\| := \sum_{e \in E} \left|\flow(e) \wtp(e)\right|.
      \]
      We allow it to be equal $+\infty$ as well.
    \end{definition}
    \begin{definition}
      If $\flowpos$ is an oriented flow on the oriented networks $\onet = (V,\vec{E},\wtp)$ 
        we can introduce the same term for the \emph{mass} of the flow:
      \[
        \|\flowpos\| := \sum_{e \in \vec{E}} \left|\flow(e) \wtp(e)\right|.
      \]
      Though in the oriented case the flow function is always positive
        so we are allowed to omite the modulus signs:
      \[
        \|\flowpos\| = \sum_{e \in \vec{E}} \flow(e) \wtp(e).
      \]
    \end{definition}
    \begin{theorem}
      \label{thm-graph-eq}
        Let $\net(\fsys) = B(\fsys, \wtp, s, t)$ be a B-class network constructed
          from the B-class system $\fsys = \seq{f}$.
        Then $\fsys$ admits a linear summation method if and only if
          the network $\net(\fsys)$ is $\flow$-preserving for any
          finite-mass flow $\flow$.
    \end{theorem}
    \begin{proof}
      First we briefly repeat the sufficiency proof we studied earlier.
      Suppose there is no summation method for the system $\seq{f}$.
      As we said before, it implies that there exists a trace class operator $T : \cal{H} \to \cal{H}$ with
      the trace equal to one, such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$.
      Using the operator $T$, we were able to define a flow function $\flow(T)$ on the network
      $\net(\fsys)$.
      One thing to check is that the flow we constructed has a finite mass.
      It easy follows from the condition that the operator matrix is finite band and has a finite trace.
      Finally, one can acknowledge the fact that this network does NOT preserve the flow, since
      $$
        d(s) + d(t) = \sum T_{l_k l_k} + \sum T_{r_k r_k} = Tr(T) = 1,
      $$
      thus $d(\sink) \neq -d(\source)$.
      We arrived to contradiction and the sufficiency is proved.

      Now suppose that the system $\fsys$ admits a linear summation method.
      Assume there is also a flow $\flow$ on the network $\net(\fsys)$ such that $d(\sink) + d(\source) \neq 0$.
      Now we are going to construct the operator $T$ with non-zero trace, which annihilates all the rank-one
      operators $f_n \otimes f^*_n$, thus coming to the contradiction with our initial assumption.
      First consider the edges incident to the $\source$ vertex.
      Having all the vertices already enumerated we will consider the vertices in the left part $v_{l_k}$.
      Recall that each vertex $v_i$ (except $\source$ and $\sink$) matches to the basis element $e_i$.
      Assign the diagonal elements of $T$:
      $$
        T_{l_k l_k} := \flow(l_k, \source) \wtp(l_k l_k) = \flow(l_k, \source) \quad k > 0.
      $$
      Now we repeat the same procedure for the right part of the graph $\net(\fsys)$, thus having
      $$
        T_{r_k r_k} := \flow(r_k, \sink) \wtp(r_k r_k) = \flow(r_k, \sink) \quad k > 0.
      $$
      Now consider two connected vertices $v_l$, $v_r$ from the left and right part
      respectively. Assign
      $$
        T_{lr} := \flowsgn(v_l, v_r) \wtp(v_l, v_r).
      $$
      Let all the other matrix elements of the operator matrix $T_{ij}$ be zero.
      Then observe that we got a finite-band operator matrix $T_{ij}$ with the sum of diagonal elements
      equal to one.
      Since the mass of the flow $\flow$ is finite, the $T_{ij}$ is an absolute summable sequence, considering that
        the $l^1$-norm of $T_{ij}$ is exactly the mass of $\flow$.
      Then the operator $T$ we obtained is compact.
      It acquires a finite non-zero trace, since $Tr(T) = d(\sink) + d(\source)$ which is not zero
        by the assumption we made.
      Due to the fact, that the flow was preserved at each vertex of the network $\net(\fsys)$,
        we see that the operator $T$ annihilates all the rank one operators $f_n \otimes f^*_n$,
        which leads to a contradiction.
    \end{proof}
    
  \subsection{B-class networks characterisation}
    Due to the theorem~\ref{thm-graph-eq} we intend to analyze the flows on the B-class network
      $\net(\fsys)$ in order to understand the conditions under which a linear
      summation method exists for $\fsys$.
    In this section we are not going to address the Hilbert space setup at all,
      instead we will use only the abstract objects of the graph theory
      we used throughout the previous section.
    Also it will be more convenient for us to study \emph{oriented} networks in this section unlike we
      did in the previous one.
    Remember some other notions from the graph theory:
    \begin{definition}
      Let $G$ be an oriented graph.
      A sequence of vertices $\{v_k\}_{k=1}^N$ is called a \emph{path} (simple path) if each consecutive vertices
        $v_k$ and $v_{k+1}$ are connected by an edge $\vec{e} = (v_k, v_{k+1})$ and no edges or vertices are repeated twice in the sequence.
    \end{definition}
    \begin{definition}
      Let $G$ be an oriented graph.
      A sequence of vertices $\{v_k\}_{k=1}^N$ is called a \emph{cycle} (simple cycle) if it is
        a path and there is an edge $\vec{e} = (v_N, v_1)$ connecting the last vertex to the first vertex of the sequence.
    \end{definition}
    \begin{definition}
      Let $G = (V, E)$ be an infinite (oriented) graph.
      An infinite path $r = \seq{v}$ is called a \emph{ray} iff
      $r$ is a path, meaning that the edge $\vec{e} = (v_k, v_{k+1})$ for each $k > 0$ is present in the graph $G$.
    \end{definition}

    The main result of this section is a following
    \begin{theorem}
      \label{ray-thm}
      Let $\onet = (\vec{G}, \wtp, s, t)$ be an oriented B-class network.
      Then there exist such a positive flow function $\flowpos: \vec{E} \to R^{+}$ that
      \begin{itemize}
        \item the flow $\flowpos$ has a finite mass,
        \item the network $\onet$ does not preserve the flow,
      \end{itemize}
        if and only if there exists a ray $r = \seq{v}$ ($=sv_2v_3\dots$)
        in the network $\onet$, which total length is bounded:
        \[
          \sum_{k=1}^\infty \wtp(v_k v_{k+1}) < \infty.
        \]
    \end{theorem}
    \begin{proof}
      Without loss of generality we might assume that $d(\sink) + d(\source)$ is precisely one.
      In order to make our proof easier we merge the $\source$ vertex with the $\sink$ vertex and call this a
        new $\source$ vertex.
      This way we obtain a network with a single source such that $d(\source) = 1$.
      Formally we are left without the $\sink$ vertex but we are going to choose any vertex $v \in V$ which
        is not equal to the new $\source$ and declare this $v$ a new $\sink$ vertex.
      All the vertices in the graph still preserve the flow after this procedure, except the $\source$ vertex
        which is now \emph{$\flowpos$-active} since its total flow $d(\source)$ equal to one.
        %the existence of the ray with a finite total length
        %in the transformed network is equivalent to the existence of such ray in the original network.
      \alex{todo}
      \noindent\textbf{Sufficiency}
      Suppose that there is a ray of a finite total length. 
      In that case we set the resulting flow function $\flowpos(v_k v_{k+1})$ to one, creating an elusive flow
        from the $\source$ to infinity. All the other edges will not carry any flow, hence the flow is preserved
        at each vertex but not preserved by the network $\onet$.

      \noindent\textbf{Necessity}
      Now let us turn to the more difficult part.
      In this part we are going to view this network as a rooted graph with the root at the $\source$ vertex.
      Consequently sometimes we will employ the term $\root$.
      For a start we get rid of all the non-zero flow cycles in the oriented graph $G$.
      Non-zero flow cycle is a cycle in the network such that non-zero flow circulates through this cycle,
      meaning that for each cycle's edge the flow along the edge is strictly greater than zero.
      In order to accomplish that we will present a sequence of the flows on the $\onet$.
      At each step $n \in \mathbb{N}$ we examine a subgraph $\vec{G}_n$ and present a flow function $\flowposn{n}$
        such that $\flowposn{n}$ is monotone: for any edge $e \in \vec{E}$ the following inequality holds:
      \[
        \flowposn{n+1}(e) \leq \flowposn{n}(e)
      \]
      for any positive integer $n$.
      The main property of the subflow $\flowposn{n}$ is that there will be no non-zero flow cycles in the induced subgraph
      $G_n$.
      We start with the flow $\flowposn{0}$ equal to the flow $\flowpos$.
      The first step $n = 1$ is trivial: the graph $\vec{G}_1$ contains only the root vertex.
      The flow $\flowposn{1}$ is equal to $\flowposn{0}$.
      At the step $n$ we consider the subgraph $\vec{G}_n = (V_n, \vec{E}_n) \subseteq \vec{G}$, where the vertices
        $V_n = {v_k}_{k=1}^n$ and the edges $E_n$ are the edges from $\vec{E}$ incident to the $V_n$.
      At the step $n$ suppose we have already established the flow function $\flowposn{n}: \vec{E}_{n} \to R^{+}$ for which
        all the inequalities above are satisfied.
      We are aiming to construct the flow function $\flowposn{n+1}$.
      Let $\cal{E}_0(e)$ be an other flow function  equal to the flow function $\flowposn{n}$
      Let there be a simple cycle $C_1$ in the graph $\vec{E}_n$ such that each edge $e \in C_1$ carries
        a strictly positive flow.
      At this point we can decrease the flow $\cal{E}_0$ on the edges of $C_1$ in such a way, that the total mass
        of the flow will not increase, and all the other properties will stay intact.
      Take the minimal value, the flow function $\cal{E}_0$
        attains on the edges of the cycle: $\displaystyle\min(C_1) = \min_{e \in C_1}\left(\cal{E}_0(e)\right)$.
      Consider a adjusted flow $\cal{E}_1$:
      \begin{equation*}
        \cal{E}_1(e) =
        \begin{cases}
          \cal{E}_0(e) - \min(C_1) \quad \text{if } e \in C_1,\\
          \cal{E}_0(e) \quad \text{otherwise}.
        \end{cases}
      \end{equation*}
      Since $C_1$ is a cycle, we reduced the flow on each edge by the same value,
        the $\cal{E}_1$ is indeed a flow function.
      After this procedure the positive flow cycle $C_1$ disappears,
        leaving us with a strictly lesser flow than we had before this step:
      \begin{align*}
        &\cal{E}_1(e) \leq \flowpos(e) \quad \forall e \in \vec{E}_{n+1},\\
        &\cal{E}_1(e) \leq \cal{E}_0(e) \quad \forall e \in \vec{E}_n.
      \end{align*}
      In this manner we remove all the simple positive-flow cycles from the finite graph $\vec{E}_n$.
      It is achievable since at each step we turn at least one edge into a zero-flow edge.
      Put $\flowposn{n+1}$ equal to the flow function $\cal{E}_K$ we got after we removed $K$ cycles from the flow graph $\vec{E}_{n+1}$.
      We have
      \begin{align*}
        &\flowposn{n+1}(e) \leq \flowpos(e) \quad \forall e \in \vec{G}_{n+1},\\
        &\flowposn{n+1}(e) \leq \flowposn{n}(e) \quad \forall e \in \vec{G}_n.
      \end{align*}
      Consider the preflow function $\preflow$ defined as a pointwise limit of $\flowposn{n}$:
      \[
        \preflow(e) = \lim_{n\to \infty}\flowposn{n}(e)
      \]
        for each edge $e \in \vec{E}$.
      Such limit exists since the $\flowposn{n}$ function is decreasing and bounded below.
      \begin{prop}
        The preflow $\preflow$ is a flow.
        Also $d_{\preflow}(\root) = d_{\flowpos}(\root)$.
      \end{prop}
      \begin{proof}
        First look at the non-root vertex $v \neq \root$.
        Since there are finite number of edges in $\vec{E}$ incident with $v$ the limit of
        $d_{\flowposn{n}}(v)$ is equal to $d_{\preflow}(v)$.
        The vertex $v$ is not a root, so $d_{\flowposn{n}}(v) = 0$ for any $n$ so the limit is zero as well.
        Conclusively, the function $\preflow$ is the flow on the network $\onet$.
        Now we discuss the root vertex.
        The quantity $d^{\preflow}(\root)$ is defined correctly.
        Indeed, each summand is positive and due to the monotonicity of $\flowposn{n}$ the series
          $d^{+}_{\preflow}(\root)$ and $d^{-}_{\preflow}(\root)$ absolutely converge.
        Since $d_{\flowposn{n}}(\root) \to \flowpos(\root)$ when $n$ tends to infinity,
          the limit $d_{\preflow}(\root)$ is equal to $d_{\flowpos}(\root)$ as well.
      \end{proof}
      \begin{prop}
        Consider the flow function $\preflow$ on the network $\onet$.
        Then there are no non-zero flow cycles of $\preflow$.
      \end{prop}
      \begin{proof}
        Assume the contrary: there is some cycle $C$ such that $\preflow(e) > 0$ for
          each edge $e \in C$.
        Obviously there exists such $n$ that the cycle $C$ lies within the graph $G_n$.
        Since on each step $k$ the flow $\flowposn{k}$ decreases, at the step $n$
          the cycle $C$ was a positive flow cycle as well: $\flowposn{n}(e) > 0$ for each edge $e \in C$.
        But at the end of the step $n$ due to our assumption there could be no positive flow cycles in $G_n$.
        That is the contradiction~--- there could be no such positive flow cycles $C$ in the network $\onet$.
      \end{proof}
      Suppose we had such flow in the first place, that is $\flowpos$ contains no positive flow cycles.
      Also we prune the edges of the network $\onet$ for which the flow $\flowpos$ is zero.
      Now we are going to have the following
      \begin{definition}
        The graph $G = (V, \vec{E},\wtp, \root)$ is a weighted directed graph with a positive
          length function $\wtp$ defined on $\vec{E}$ and a root vertex $\root \in V$.
        Let $\gpaths(u, v)$ be a set of paths from vertex $u$ to vertex $v$ in the graph $G$.
        Sometimes we will omit the first argument and then we refer to the paths from the root vertex
          $\gpaths(v) := \gpaths(\root, v)$.
        Also we could expand the function onto the vertices sets: $\gpaths(U,V)$ is a set of paths
          from the set of vertices $U$ to the set of vertices $V$ in the graph $G$.
        The function $\gfi: \gpaths \to \mathbb{R}^{+}$ is settled as follows:
        \[
          \gfi(p) := \sum_{e \in p} \wtp(e)
        \]
        for any path $w \in \gpaths(\operatorname{\operatorname{end}(p)})$, where $\operatorname{end}(p)$ is the last vertex in the path.
        Also we extend this function to take values on the set of the vertices $\gfi: V \to \mathbb{R}^{+}$ in this fashion:
        \[
          \gfi(v) := {\inf_{\gpaths(v)}} \gfi(p).
        \]
      \end{definition}
      \begin{remark}
        The introduced function $\gfi$ is in essence the distance function on the vertex set $V$.
        Let $\depth: V \to \mathbb{N}$ be a \emph{depth} function,--- defined at the vertex $v$ as the length of the shortest path connecting the root vertex with
          $v$.
        Our ambition in the following paragraphs is virtually to provide an estimate on the values of this function on the vertices
          located ''far'' from the root vertex $\root$, meaning for which the $\depth$ function is ''big''. \alex{todo reformulate}
      \end{remark}
      Here we are about to put up the main construction of the proof.
      But before that we scale our flow function $\flowpos$: suppose the total outgoing flow of the root vertex $\root$ is strictly greater than one:
        $d_{\flowpos}(\root) > 1$.
      In a few moments it will become apparent why we did so.
      We are going to define the finite subgraphs $G_n = (V_n, \vec{E}_n)$ of the network $\onet$ such that
        $G_{n} = G_{n-1} \cup L_n$ where $L_n$ is a set of vertices and edges from $\onet$ which we also name by
        the \emph{$n$-th layer} of the network $\onet$.
      \begin{note}
        Essentially we will be performing a breadth-first-search in the infinite graph $G$, so the $L_n$ is
          almost all the vertices located not deeper than $n$: $\depth(v) \leq n$ for each $v \in L_n$.
        We say ''almost all'' because we also have to deal with the possibly infinite degree of the root vertex, the case $n = 1$.
        Otherwise for $n > 1$ the $L_n$ will be all the outgoing edges and their ends of $L_{n-1}$, $L_{n+1}$ will be
          all the outgoing edges and their ends of $L_n$ and so on.
        \alex{here we need a picture}
      \end{note}
      Besides we are going to establish a sequence of the positive preflow functions $\flowposn{n}: \vec{E}_n \to \mathbb{R}^{+}$,
        pertaining the following properties:
        \begin{enumerate}[label=\textbf{P\arabic*}]
          \item \label{p1} $\flowposn{n}$ is increasing: one has $\flowposn{n+1}(e) \geq \flowposn{n}(e)$ for each $e \in \vec{E}_n, n > 0$,
          \item \label{p2} $\flowposn{n}$ is dominated by $\flowpos$: one has $\flowposn{n}(e) \leq \flowpos(e)$ for each $e \in \vec{E}_n, n> 0$,
          \item \label{p3} the total flow of $\flowposn{n}$ is equal to one at the root vertex: $d_{\flowposn{n}}(\root) = 1$,
          \item \label{p4} the total flow of $\flowposn{n}$ is equal to zero at any non-root vertex $v \in G_{n-1}\setminus \root$: $d_{\flowposn{n}}(v) = 0$ for any $n > 1$,
          \item \label{p5} the total flow of $\flowposn{n}$ of the vertex $v \in L_n$ is negative: $d_{\flowposn{n}}(v) = -d^{-}_{\flowposn{n}}(v) < 0$.
        \end{enumerate}
      Let $G_0$ be the trivial subgraph containing from the root vertex only.
      In the first step we are to build the \emph{finite} graph $G_1$.
      We choose such set of the edges $E_1 \subseteq \eout(\root)$ that the total flow on this set is equal to one:
      \[
        \sum_{e \in E_1} \flowpos(e) = 1.
      \]
      It is possible since we earlier requested a $\flowpos$ function such that its total outgoing flow in the root vertex
        $\root$ is strictly greater than one: $d^{+}_{G} > 1$.

      Then we define the \emph{first layer} $L_1$ as
      \[
        L_1 = E_1 \cup \ter(E_1).
      \]
      Along with the graph $G_1 = G_0 \cup L_1$ we appoint the preflow function $\flowposn{1}: E_1 \to \mathbb{R}^{+}$ in a trivial way:
      \[
        \flowposn{1}(e) = \flowpos(e).
      \]
      \begin{prop}
        The preflow $\flowposn{1}$ satisfies all of the declared properties from~\ref{p1}--\ref{p5}.
      \end{prop}
      \begin{proof}
        The only check we intend to clarify here is the check of the property~\ref{p5}.

        We included the ends of the $E_1$ edges without any additional edges.
        So each vertex in $L_1$ has only incoming edges which makes their total flow strictly negative (recall that we removed all zero-flow edges).
      \end{proof}
      \begin{note}
        We dealt with the generally infinite degree of the root vertex by abandoning some of the children of the root.
        We need $G_n$ to be finite since this way we could analyze the $\gfi$ function without trouble.
      \end{note}
      For each further step $n > 1$ the construction will be the same.
      Suppose that $G_{n-1}$, $L_{n-1}$ and the preflow function $\flowposn{n-1}$ are already established.
      Let us enlarge upon the outgoing edges of the vertex $v \in L_{n-1}$.
      Some of them might lead to some new vertices which do not belong to $G_{n-1}$.
      Such edges we will denominate by $\efor_n$:
      \[
        \efor_n = \Big\{ e = (uv) \mid u \in L_{n-1} \text{ and } v \notin G_{n-1}\Big\}.
      \]
      Others might lead to the already visited vertices of $G$, namely the ones residing in the graph $G_{n-1}$.
      Such edges we will address as the \emph{back} edges of $L_{n-1}$ and denominate them by $\eback_n$:
      \[
        \eback_n = \Big\{e = (us) \mid u \in L_{n-1} \text{ and } s \in G_{n-1}\Big\}.
      \]
      \begin{remark}
        Pay your attention that a \emph{back} edge could never lead to the root vertex since that
          would yield an existence of a positive flow cycle for the flow function $\flowpos$,
          which is impossible.
      \end{remark}
      Then we will have $L_n$ as the set of outgoing edges and their ends of the vertices in $L_{n-1}$, leading to the new vertices of $G$:
      \[
        L_n := \efor_n \cup \ter(\efor_n).
      \]
      Accordingly, we prescribe the graph $G_n$ as $G_n := G_{n-1} \cup L_n \cup \eback_n$.

      \noindent\textbf{Setting a preflow function.}\\
      \noindent Here we split the procedure in two steps.
      Take the preflow function $\cal{G}: E_n \to \mathbb{R}^{+}$ initially equal to $\flowposn{n-1}$:
      \[
        \cal{G}(e) = \flowposn{n-1} \quad \forall e \in E_{n-1},
      \]
      and zero otherwise.
      We are going to change it gradually in order to satisfy all the properties from~\ref{p1} to~\ref{p5}.
      \alex{here we so very need a picture}
      Notice how all the vertices except the root and the last layer $L_{n-1}$ are $\cal{G}$-preserving.
      The root is $\cal{G}$-deficient and the $n-1$ layer is currently $\cal{G}$-active.
      At the first step our desire is to expand this property onto the $L_{n-1}$.
      In order to do such expansion we will propagate the flow $\cal{G}$, incoming to the $n-1$ layer, one edge further.
      Namely, consider the vertex $u \in L_{n-1}$.
      Since $d_{\cal{G}}^{-}(u) \leq d_{\flowpos}^{-}(u)$ (incoming flow $\cal{G}$ is bounded above by the original flow $\flowpos$),
        we are able to set the flow $\cal{G}$ on the outgoing edges of $u$ in such a way that:
      \begin{enumerate}[label=\textbf{(\roman*)}]
        \item\label{posprop} each outgoing edge has a positive flow: $\cal{G}(e) > 0$ for any $e \in \eout(u)$,
        \item the $\cal{G}$ is still bounded from above: 
          $\cal{G}(e) \leq \flowpos(e) \quad \forall e \in \eout(u)$,
        \item the vertex $u$ becomes $\cal{G}$-preserving (meaning that $d^{\cal{G}}(u) = 0$).
      \end{enumerate}
      \begin{note}
        Literally, here we are pushing the flow out of the vertex $u \in L_{n-1}$ spreading it among all the outgoing edges
          $\eout_G(u)$.
        Since the preflow $\cal{G}$ is bounded above by the flow $\flowpos$ which is preserved at each vertex of the graph $G$,
          particularly, at each vertex of the graph $G_n$, it is trivial that such expansion exists.
      \end{note}
      So if we had no back edges, the function $\cal{G}$ would be our next preflow function $\flowposn{n}$, and this step would be accomplished,
        since all the properties~\ref{p1}--\ref{p5} would be complied by $\cal{G}$.
      However we ought to solve the problem we created while pushing the flow from the $(n-1)$-th layer via the back edges.
      Notice that the end vertices of such edges $\eback_{n}$ now became $\cal{G}$-active, since for such vertices
        the total incoming flow now exceeds the total outgoing flow.
      Thus we have reached the step number two, when we are going to carry out the \emph{relaxation} procedure in order to alleviate those $\cal{G}$-active
        vertices.

      \begin{definition}
        Denote $\gnpaths(\makebox[1ex]{$\cdot$}, \makebox[1ex]{$\cdot$}) := \cal{P}_{G_n}(\makebox[1ex]{$\cdot$},\makebox[1ex]{$\cdot$})$.
      \end{definition}
      Consider a $\cal{G}$-active vertex $s \in \ter(\eback_n)$ such that $d_{\cal{G}}^{-}(s) > d_{\cal{G}}^{+}(s)$.
      Let there exist such path $p \in \gnpaths(s, L_n)$, connecting the vertex $s$ and the $n$-th layer, that
        the preflow $\cal{G}$ could be increased along this path by some constant
        $\delta \leq d_{\cal{G}}^{-}(s) - d_{\cal{G}}^{+}(s) = -d_{\cal{G}}(s)$.
      \begin{definition}
        Such path $p$ will be referred as a \emph{$\cal{G}$-augmenting} path for the vertex $s$.
      \end{definition}
      Obviously for this path each edge $e \in p$ admits the inequality $\cal{G}(e) < \flowpos(e)$.
      This way, the possible $\delta$ does not exceed $\delta_{max}=\min\limits_{e \in p}(\flowpos(e) - \cal{G}(e))$.
      \begin{definition}
        The edge $e$ is called a \emph{$\cal{G}$-saturated} edge if $\cal{G}(e) = \flowpos(e)$.
      \end{definition}
      \begin{definition}
        The path $p$ is called \emph{$\cal{G}$-saturated} if there exists such an edge $e \in p$ that $e$ is $\cal{G}$-saturated.
      \end{definition}
      For each path $p \in \gnpaths(s, L_n)$ we raise the preflow $\cal{G}$ at every edge of the path $p$
      by $\delta > 0$.
      The described procedure we call as \emph{$\cal{G}$-relaxation} of the vertex $s$, strictly speaking, the \emph{$\cal{G}$-relaxation}
        of the vertex $s$ means reduction of the preflow $\cal{G}$ excess in the vertex $s$.
      Our purpose is to \emph{$\cal{G}$-relax} the vertex $s$, in other words transform it into a $\cal{G}$-preserving vertex.
      If $\delta_{max} \geq -d_{\cal{G}}(s)$ then pushing the flow along the path $p$ of the size precisely $-d_{\cal{G}}(s)$
        will be enough to make the vertex $s$ preserving the preflow $\cal{G}$.
      On the other hand if $\delta_{max} < -d_{\cal{G}}(s)$ then pushing the flow of the size $\delta_{max}$ along the path $p$ is not enough
        in order to make the vertex $\cal{G}$-preserving.
      In this case we push the flow $\delta$ along the path $p$ and look for the other augmenting paths in $\gnpaths(s, L_n)$.
      We will repeat the outlined procedure until we finally relax the vertex $s$.
      \begin{prop}
        The vertex $s$ will be $\cal{G}$-relaxed in a finite number of steps.
      \end{prop}
      \begin{proof}
        Firstly, we have a finite graph $G_{n}$, and so there are only a finite number of paths in the $\gnpaths(s, L_n)$.
        Secondly, each time we push the flow along the augmenting path $p$ either we successfully relax the vertex $s$
          or we saturate at least one edge, lying on the chosen path $p$.
        Since the number of the edges is finite the procedure halts exhausts all the edges after a finite number of steps.

        Suppose that the vertex $s$ is not yet $\cal{G}$-relaxed.
        Examine the set of vertices $V_s \subseteq G_n$ which are reachable by non-saturated paths from the vertex $s$
        Obviously $V_s \cap L_n = \emptyset$.
        Now observe the subgraph $U \subseteq G_n$:
        \[
          U := \bigcup \left\{p \in \gnpaths(s, V_s) \mid \text{$p$ is not $\cal{G}$-saturated})\right\},
        \]
        Such subgraph has no outgoing non-saturated edges in the graph $G_n$.
        It also does not have outgoing non-saturated edges in the whole graph $G$ since all the outgoing edges it had in $G$
          ought to have been appended to the graph $G_n$.
        Having a vertex $u \in V_s$ we certainly have that $d_{\cal{G}}(u) = d^{+}_{\cal{G}}(u) - d^{-}_{\cal{G}}(u) \leq 0$ because
          the only $\cal{G}$-deficient vertex in the graph $G_n$ is the root vertex $\root$ which is not in $U$ (we removed all positive-flow
          cycles).
        Also for the vertex $s$ itself we have a strict inequality $d_{\cal{G}}(s) < 0$.
        It is clear now that the quantity $D := \sum_{u \in U} d_{\cal{G}}(u)$ is strictly less than zero.
        On the other hand
        \[
        \begin{split}
          D &= \mathlarger\sum_{u \in U} \big(d^{+}_{\cal{G}}(u) - d^{-}_{\cal{G}}(u)\big)
          = \mathlarger{\smashoperator{\sum_{\eout_{G_n}(U)}}} \cal{G}(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \cal{G}(e) = \\
          &= \mathlarger{\smashoperator{\sum_{\eout_{G}(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \cal{G}(e)
            \geq \mathlarger{\smashoperator{\sum_{\eout_G(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \flowpos(e) \geq \\
          &\geq \mathlarger{\smashoperator{\sum_{\eout_G(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G}(U)}}} \flowpos(e) = 0.
        \end{split}
      \]
        So we deduced that $0 > D \geq 0$, and that is a contradiction.
      \end{proof}
      It follows that we could relax all the end vertices of the back edges in $\eback_n$.
      We study the evolved preflow function $\cal{G}$ we got after all the relaxations.
      \begin{prop}
        The properties~\ref{p1}--\ref{p5} are satisfied for the resulting preflow function $\cal{G}$ on the network $\onet_N = (G_n, \wtp, \root)$.
      \end{prop}
      \begin{proof}
        The monotonicity property~\ref{p1} is true since during the relaxation step $n$ we
          only increased the flow on the edges of the graph $G_n$.

        The boundness property~\ref{p2} is also true since we chose the flow values in such a way
          that the bound $\flowposn{n}(e) \leq \flowpos(e)$ holds for each edge $e\in G_n$.

        The root vertex was not be affected during the step $n > 1$, so~\ref{p3} holds.

        The flow $\cal{G}$ was redesigned in such fashion that each non-root vertex $v \in G_{n} \setminus 
          \left(L_n \cup \{\root\}\right)$ became $\cal{G}$-preserving.
        This checks the property~\ref{p4}.
        
        Finally, due to the first step property~\ref{posprop} and the fact that
        any vertex in $L_n$ has only incoming edges in the graph $G_n$, we prove the property~\ref{p5}.
      \end{proof}
      Conclusively, we set the preflow function $\flowposn{n}$ equal to the result flow $\cal{G}$.
      The flow construction is completed.
      Now we would like to introduce some simpler notations.
      \begin{definition}
        The function $\phi_n: G_n \to \mathbb{R}^{+}$ will stand for the distance function on the $n$-th graph $G_n$:
        \[
          \phi_n(v) := \phi_{G_n}(v).
        \]
      \end{definition}
      \begin{definition}
        The function $d_n: G_n \to \mathbb{R}$ will stand for the total flow function on the $n$-th graph $G_n$:
        \[
          d_n(v) := d_{\flowposn{n}}(v).
        \]
        The function $d^{-}_n: G_n \to \mathbb{R}^{+}$ will stand for the incoming flow function on the $n$-th graph $G_n$:
        \[
          d^{-}_n(v) := d^{-}_{\flowposn{n}}(v).
        \]
        The function $d^{+}_n: G_n \to \mathbb{R}^{+}$ will stand for the outgoing flow function on the $n$-th graph $G_n$:
        \[
          d^{+}_n(v) := d^{+}_{\flowposn{n}}(v).
        \]
      \end{definition}
      \begin{lemma}
        For each $G_n$ where $n > 1$ the following inequality remains true:
        \begin{equation}
          \label{main-ineq}
          \sum_{v\in L_n}d_{\flowposn{n}}^{-}(v) \phi_n(v) \leq \sum_{e \in E_n} \wtp(e) \flowpos(e).
        \end{equation}
      \end{lemma}
      \begin{proof}
        First denote the left hand side by $LS$
        \[
          LS := \sum\limits_{v \in L_n} d_n(v) \phi_n(v).
        \]
        Since $\phi_n(\root) = 0$ and for all vertices $u \in G_{n} \setminus \left(L_n \cup \{\root\}\right)$
          we have $d_n(u) = 0$ we could study the sum over the whole $G_n$ instead of $L_n$.

        Also recall that $d_n^{+}(v) = 0$ for each vertex $v \in L_n$, hence $d_n(v) = d_n^{-}(v)$ whenever $v$ is in the $n$-th layer.
          
        Next we regroup the summation in order to have a sum over the edges of $G_n$, not vertices:
        \begin{align*}
          LS = \sum\limits_{v \in L_n} d_n(v) \phi_n(v) = \sum\limits_{v \in V_n} d_n(v) \phi_n(v) =\\
          =\sum_{v \in V_n} \left(\sum_{\eout(v)} \flowposn{n}(e) - \sum_{\ein(v)}\flowposn{n}(e) \right) \phi_n(v)=\\
          =\sum_{(vu) \in E_n} \flowposn{n}(vu) \big(\phi_n(u) - \phi_n(v)\big).
        \end{align*}
        Let $(uv)$ be an edge in $E_n$. Recollect that
        \[
          \phi_n(u) = \inf_{p \in \gnpaths(u)} \phi_n(p) \leq \phi_n(v) + \wtp(vu).
        \]
        That implies
        \[
          LS\leq \sum_{(vu) \in E_n} \flowposn{n}(vu) \wtp(vu) = \sum_{e \in E_n} \flowposn{n}(e) \wtp(e).
        \]
        Due to the property~\ref{p2} which essentially says that the built flows $\flowposn{n}$ do not exceed the initial flow $\flowpos$ 
          we also acquire that
        \[
          LS\leq \sum_{e \in E_n} \flowposn{n}(e) \wtp(e) \leq \sum_{e \in E_n} \flowpos(e) \wtp(e).
        \]
        The inequality is proven.
      \end{proof}
      Due to this lemma the following fact turns out transparent
      \begin{prop}
        For each $n > 0$ there exist such vertex $r_n \in L_n$ that $\phi_n(r_n) \leq \|\flowpos\|$.
      \end{prop}
      \begin{proof}
        Consider the inequality we have just proven.
        Again we have $LS$ standing for the left hand side of the inequality~\eqref{main-ineq}.
        Remark that
        \[
          LS = \sum_{v \in L_n}d^{-}_n(v) \phi_n(v) \geq \min_{v \in L_n}\phi_n(v) \sum_{v \in L_n} d^{-}_n(v).
        \]
        Since $\sum\limits_{v \in L_n} d^{-}_n(v)$ is the total amount of the flow incoming to the deepest layer $L_n$, and the only
          active vertex in $G_n$ is the root, which produces the flow which size is precisely equal to $1$, the following is true:
        \[
          \sum_{v \in L_n} d^{-}_n(v) = d^{+}_n(\root) = 1.
        \]
        The latter yields
        \[
          LS \geq \min_{L_n} \phi_n(v).
        \]

        Furthermore we remark that the right hand side of~\eqref{main-ineq} denoted $RS$ satisfies the next inequality
        \[
          LS \leq RS := \sum_{e \in E_n} \wtp(e) \flowpos(e) \leq \|\flowpos\|.
        \]
        Seeing that $L_n$ contains a finite number of vertices, there exists such vertex $r_n \in L_n$ that
        \[
          \phi_n(r_n) \leq \|\flowpos\|.
        \]
      \end{proof}
      \begin{prop}
        There exists such a ray $R=(R_0, R_1, R_2,\dots)$, where $R_n \in L_n$, such that $\sum\limits_{k=1}^\infty \wtp(R_{k-1}R_k) < \infty$.
      \end{prop}
      \begin{note}
        The ray $R$ always starts with the root vertex $R_0 = \root$, since $L_0 = \{\root\}$.
      \end{note}
      \begin{proof}
        We will seek for the ray $R$ in the graph 
        \[
          \gstar = \bigcup G_n.
        \]
        Unlike $G$ this graph is locally finite which is a crucial property for our solution.
        Also we need a distance function in the graph $\gstar$:
        \[
          \phistar(v):=\phi_{\gstar}(v).
        \]
        Note that $\phi_n(v) \geq \phistar(v)$ for any $v \in G_n$ since $G_n$ is a subgraph of $\gstar$.
        Owing to the previous proposition there is always a vertex $r_n \in L_n$ that $\phi_n(r_n) \leq \|\flowpos\|$.
        Consider the set of vertices $U_n$:
        \[
          U_n:= \{u \in L_n \mid \phi_n(u) \leq \|\flowpos\|\}.
        \]
        Let $\cal{P}$ be a set of paths $p = (p_1,p_2, \dots)$, such that $p_k \in U_k$.
        Presume $\cal{P}$ consists only of finite paths.
        We are going to build a ray $R$ lying in the $\cal{P}$, arriving to a contradiction.
        Let us build $R$ consequtively.
        We will build $R$ in such a way that for every path $p_k:= (R_0, R_1, \dots R_k)$ there is an infinite number of paths 
          in $\cal{P}$ which start with $p_k$.
        
        We start from $k = 0$.
        Trivially, $R_0$ is set to the root vertex:
        \[
          R_0 := \root.
        \]
        Each $U_n$ is non-empty and if a vertex $u$ belongs to $U_n$ then there always exists
          a path $p_n$ which belongs to $\cal{P}$.
        So we have an infinite set of paths $\bigcup\limits_n p_n$ starting from the root vertex $\root$.
        
        Suppose we already have made the path $p_k:= (R_0, R_1,\dots R_{k-1})$. 
        By the assumption there is an infinite number of paths in $\cal{P}$ starting with $p_k$.
        Address these paths as $\cal{P}_k$.
        Let us look at the \emph{forward} edges $\efor(R_{k-1})$ of the vertex $R_{k-1} \in U_{k-1} \subseteq L_{k-1}$:
        \[
          \efor(R_{k-1}):=\left\{(R_{k-1} u) \mid u \in L_k\right\}.
        \]
        Now inspect the path $q \in \cal{P}_k \setminus p_k$ which has the prefix $p_k$:
        \[
          q:=(R_0,R_1,\dots,R_{k-1},q_k,q_{k+1} \dots).
        \]
        Evidently for such path we have the vertex $q_k$ being equal to be one of the end vertices of the edges $\efor(R_{k-1})$.
        Remember that the graph $\gstar$ is locally finite and in particular the degree of the vertex $R_{k-1}$ is finite.
        Moreover recall that the number of the paths such as $q$ itself (namely, $\cal{P}_k$) is infinite,
          as a result of the previous construction step.
        Consequently we are able to choose such $R_k \in \efor(R_{k-1})$ that the number of paths in $\cal{P}_k$ starting from
          the path $p_{k+1}:= (p_k, R_k)$ is infinite as well.
        The ray $R := (R_0, R_1 \dots) \in \cal{P}$ is constructed.
        The sum $\sum \wtp(R_k, R_{k+1}$ is bounded since the partial sums are bounded by the values of the $\phi_n$ function which are bounded
          by the definition of the $U_n$ classes.
      \end{proof}
      In the end we found a finite-length ray in the network $\onet$.
      Hence the necessity is proved as well as the theorem itself.
    \end{proof}
  \subsection{Application of the B-class networks criterion}
    \subsubsection{Application of the B-class networks criterion to the Azoff--Shehada example.}
      Let us begin with the exposition of the Azoff--Shehada~\cite{azoff} vector system.
      The AS system $\fsys_{AS}$ is given as follows:
      \begin{equation}
        \label{as-system}
        \begin{aligned}
          &f_1 = e_1 + a_2 e_2, \qquad &f_{2j}=e_{2j}, \quad&j \geq 1,&\\
          &f_{2j-1}=-a_{2j-1}e_{2j-2} + e_{2j-1} + a_{2j}e_{2j}, \qquad &\makebox[5em]{} \quad&j \geq 2,&\\
          &f^*_{2j}=-a_{2j}e_{2j-1}+e_{2j}+a_{2j+1}e_{2j+1}, \qquad &f^*_{2j-1}=e_{2j-1}, \quad&j \geq 1&
        \end{aligned}
      \end{equation}
        for some real parameters $a_n > 0$, where $n > 1$.
      The sequences $\{f_j\}$, $\{f^*_j\}$ are biorthogonal and both are complete in $\cal{H}$ (thus it is an $M$-basis).
      Also due to~\cite{katavolos} the next theorem is accurate
      \begin{theorem}
        \label{thm-katavolos}
        The following three cases fully resolve the $k$-completeness problem for the AS-system:
        \begin{enumerate}[label=(\alph*)]
          \item The system $\fsys_{AS}$ is $1$-complete (a strong $M$-basis) iff the following sequence
            \begin{equation*}
              \mu_n = \frac{a_{n-1} a_{n-3} \dots}{a_{n} a_{n-2} \dots }
            \end{equation*}
              does not belong to $l^2$,
          \item \label{pt2} $\fsys_{AS}$ admits a linear summation method if and only if the system is $2$-complete,
          \item \label{pt3} $\fsys_{AS}$ admits a linear summation method when and only when
            the sequence $\left\{1/a_n\right\}_{n=1}^\infty$ does not belong to $l^1$.
        \end{enumerate}
      \end{theorem}
      The first statement does not interest us for now.
      The third statement is criteria for a linear summation method existence.
      Now we would like to present another proof of the statement~\ref{pt3} of the theorem~\ref{thm-katavolos}:
      \begin{prop}
          The vector system $\fsys_{AS}$ admits a linear summation method when and only when
            the sequence $\left\{1/a_n\right\}_{n=1}^\infty$ does not belong to $l^1$.
          %theorems~\ref{thm-graph-eq} and~\ref{ray-thm}.
      \end{prop}
      \begin{proof}
        The AS system belongs to the B-class as we mentioned before.
        Here we will narrow our thinking to the AS system only: $\fsys := \fsys_{AS}$.
        Thus $\fsys$ is applicable to the theorem~\ref{thm-graph-eq}, which asserts
          that $\fsys$ admits a linear summation method if and only if
          the network $\net(\fsys)$ is $\flow$-preserving for any
          finite-mass flow $\flow$.
        We could reformulate the conclusion in the terms of \emph{oriented} networks.
        The system $\fsys$ admits a linear summation method if and only if
          the oriented network $\onet(\fsys)$ is $\flowpos$-preserving for any
          finite-mass flow $\flowpos$.
        After that we utilize the theorem~\ref{ray-thm}, which states that there exist such
          flow $\flowpos: \vec{E} \to R^{+}$ with a finite mass which is not preserved in
          the network $\onet(\fsys)$
          if and only if there exists a ray $r \subseteq \onet $ originating in the $\source$ vertex
          which total length is bounded:
          \[
            \sum_{k=1}^\infty \wtp(v_k, v_{k+1}) < \infty.
          \]
          Hence, the system does NOT admit a linear summation method when and only when there is such ray $r$
            with the properties specified up above.
          How does look the ray of a finite length in the network like $\onet(\fsys)$?
          It is obvious that it cannot include infinite number of the edges incident to the
            $\source$ and $\sink$ vertices, since such edges have the length exactly one.
          Now look at the outline of the network $\onet(\fsys)$ (~\ref{AS-net}).
          It clearly demonstrates that
            the existence of the finite-length ray in the network $\onet(\fsys)$ implies
            the finite length of the ray $R:=(e_1,e_2,e_3\dots)$ which is marked in the picture with the red color.
          However this ray has length equal to
          \[
            \sum \wtp(e_k, e_{k+1}) = \sum \frac{1}{|a_k|} = \|\frac{1}{a_k}\|_{l^1},
          \]
          which ends the proof immediately.
      \end{proof}
      Let us analyze the second statement of the theorem~\ref{thm-katavolos}.
      Essentially it says that whenever the AS system does not possess a linear summation method
        there is such an operator $T$ of rank $2$ that has non-zero trace and annihilates all the
        rank one operators $f_k \otimes f^*_k$.
      \pagebreak
      \begin{figure}
        \begin{center}
        \begin{tikzpicture}[thick,
                            every node/.style={draw,circle},
                            lnode/.style={draw,fill=gray},
                            rnode/.style={draw},
                            every fit/.style={ellipse,draw,inner sep=-1pt,text width=2cm},
                            ]
          %\draw[help lines,step=9mm,gray!70] (0,-6) grid (6,0);
          \node[fill=gray,draw, xshift=-3cm, yshift=-3.5cm] (source) {$s$};
          \begin{scope}[start chain=going below,node distance=7mm]
            \foreach \i in {1,3,5,7}
            \node[lnode,on chain] (l\i) [] {$e_{\i}$};
            \node[draw=none,on chain, yshift=7mm]{$\vdots$};
          \end{scope}
          \begin{scope}[xshift=3cm,yshift=-0.5cm,start chain=going below,node distance=7mm]
            \foreach \i in {2,4,6,8}
            \node[rnode,on chain] (r\i) [] {$e_\i$};
            \node[draw=none,on chain, yshift=7mm]{$\vdots$};
          \end{scope}
          \node[xshift=6cm,yshift=-3.5cm,draw] (sink) {$t$};

          % the set U
          %\node [fit=(l1) (l5),label=above:\emph{left}] {};
          % the set V
          %\node [fit=(r6) (r9),label=above:\emph{right}] {};

          % the edges
          \foreach [evaluate={\k=int(\i*2 + 1)}] \i in {0,...,3}
          \draw(source)--(l\k);
          \foreach [evaluate={\k=int(\i*2 + 2)}] \i in {0,...,3}
          \draw(sink)--(r\k);
          \draw (l1) -- (r2);
          \draw (r2) -- (l3);
          \draw (l3) -- (r4);
          \draw (r4) -- (l5);
          \draw (l5) -- (r6);
          \draw (r6) -- (l7);
          \draw (l7) -- (r8);
        \end{tikzpicture}
        \caption{The network $\net$ built based on the AS-system $\fsys_{AS}$} \label{AS-net}
        \end{center}
      \end{figure}

    \subsubsection{Application of the B-class networks criterion to the B-class vector systems}
      In this section our aim is to apply the knowledge we gathered in the previous section to
      the net $\net(\fsys)$, we created in the section~\ref{fsys2graphs}.
      \begin{theorem}
        \label{completeness-thm}
        Let $\fsys$ be a minimal sequence of vectors in the Hilbert space $\cal{H}$.
        Then $\fsys$ is $2$-complete when and only when $\fsys$ admits a linear summation method.
      \end{theorem}
      \begin{proof}
        The sufficiency is trivial~--- the $k$-completeness property is weaker the existence of the linear summation method
          for $\fsys$.\\
        \noindent\textbf{Necessity.}
        Pretend $\fsys$ does not admit a linear summation method.
        Let $\onet(\fsys) = (G, \wtp, s, t)$ be an orientation of the network $\net(\fsys)$.
        Applying the theorem~\ref{thm-graph-eq} and then the theorem~\ref{ray-thm} to the network $\onet(\fsys)$
          we recognize that there is such a ray $r \subseteq \onet$ taking its origin
          in the source vertex $\source$ which has a finite length.
        Suppose $r = \seq{r}$ such that $r_0 = \source$ and $r_k$ are some vertices in the graph $G$.
        Recall that in the theorem~\ref{ray-thm} in view of existence of the ray $r$ we were able to push
          a flow of the size one along this ray:
        \[
          \flow(r_k, r_{k+1}) = 1,
        \]
        so that the network became not $\flow$-preserving.
        Next we are going to reconstruct the operator $T$ from such flow $\flow$.

        Consider the basis vectors $e_{s_k}$ which correspond to the vertices $r_k$.
        Split the Hilbert space $\cal{H}$ in two smaller subspaces:
        \[
          \cal{H} = \cal{H}_1 \oplus \cal{H}_2,
        \]
        such that $\cal{H}_1 = \bigoplus\limits_k e_{s_k}$.
        So, virtually the operator $T$ is going to be zero on the $\cal{H}_2$:
        \[
          T\vert_{\cal{H}_2} \equiv 0.
        \]
        We will reuse the $e_k$ notation for the basis vectors $e_{s_k}$ (since we work now in the subspace $\cal{H}_1$
          such substitute is allowed).
        We are meaning to look for a two-dimensional operator in such a form:
        \begin{align*}
          &T_{11} = 1,\\
          &T_{k k+1} = \wtp(r_k, r_{k+1}) \flow(r_k, r_{k+1}) = \wtp(r_k, r_{k+1}),
        \end{align*}
        while the other elements of $T$ are set to zero.\\
        Owing to the theorem~\ref{thm-graph-eq} we know as fact that such operator $T$ is
          a trace class operator with trace equal to 1 and annihilates rank one operators $f_n \otimes f^{*}_n$.
    \end{proof}

\bigskip
\begin {thebibliography}{20}
    \bibitem{azoff}
    E.~\!Azoff, H.~\!Shehada,
    \emph{Algebras generated by mutually orthogonal idempotent operators}.
    J. Oper. Theory, 29 (1993), 2, 249--267.
    \bibitem{bbb} 
    A. Baranov, Yu. Belov, A. Borichev,
    \emph{Hereditary completeness for systems of exponentials and reproducing kernels},
    Adv. Math., 235 (2013), 1, 525--554.
    \bibitem{bbb1}
    A. Baranov, Yu. Belov, A. Borichev, 
    \emph{Spectral synthesis in de Branges spaces},
    Geom. Funct. Anal. (GAFA), 25 (2015), 2, 417--452.
    \bibitem{ad_preprint}
    A.D.~\!Baranov, D.V.~\!Yakubovich,
    \emph{Completeness and spectral synthesis of nonselfadjoint one-dimensional
    perturbations of selfadjoint operators}.
    arXiv:1212.5965 [math.FA]
    \bibitem{katavolos}
    A.~\!Katavolos, M.~\!Lambrou, M.~\!Papadakis,
    \emph{On some algebras diagonalized by $M$-bases of $\ell^2$}.
    Integr. Equat. Oper. Theory, 17 (1993), 1, 68--94.
    %\bibitem{wermer}
    %J.~\!Wermer,
    %\emph{On invariant subspaces of normal operators}.
    %Proc. Amer. Math. Soc., 3(1952), 2, 270--277.
    \bibitem{larson}
    D.~\!Larson, W.~\!Wogen,
    \emph{Reflexivity properties of $T\bigoplus0$}.
    J. Funct. Anal., 92 (1990), 448--467.
    %\bibitem{rotfeld}
    %В.В.~\!Пеллер,
    %\emph{Операторы Ганкеля и их приложения}.
    %Издательство РХД, Ижевск(2005).
    %N.K.~\!Nikol'skii,
    %\emph{Complete extensions of Volterra operators},
    %Izv. Akad. Nauk SSSR Ser. Mat 33(1969), 1349--1355. (Russian)

\end{thebibliography}
\vspace{1em}
\noindent{\bf Keywords:} minimal system, biorthogonal system, hereditary completeness, strong M-basis, summation method.

\end{document}
