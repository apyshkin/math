\documentclass[12pt,oneside,a4paper]{amsart}
\input{preamble}
%\usepackage{caption}
%\usepackage{tikz}
%\usepackage{tkz-berge}
%\usetikzlibrary{positioning, chains, fit, shapes, calc}
        %\tikzset{lnode/.style={auto, circle, draw,fill=gray!50},
                 %rnode/.style={auto, circle, draw},
                 %mnode/.style={auto, circle, draw, fill=gray!25},
                 %wnode/.style={sloped,above}}
\raggedbottom


\begin{document}
\title{Rank one density for a class of $M$-bases}
\author{Alexey Pyshkin}
\address{Chebyshev Laboratory, Saint Petersburg State University, 14th Line V.O. 29, Saint Petersburg 199178, Russia}
\address{Saint Petersburg Department of RAS, Steklov Math. Institute, Fontanka 27, Saint Petersburg 191023, Russia}
\address{Euler International Mathematical Institute, nab.\,Pesochnaya 10, Saint Petersburg 197022, Russia}

\subjclass{Primary 46A35}

\begin{abstract}
  In 1990s several papers studied a strong tridiagonal $M$-basis
    that did not possess rank one density property.
  We offer a new method for the study of more generic finite-band $M$-bases,
    employing a graph theory framework.
  We determine the necessary and sufficient conditions for rank one density property
    in this class of $M$-bases.
  Also we give some sufficient conditions concerning $k$ point density property.
\end{abstract}
\keywords{$M$-basis, rank one density, $k$ point density, hereditary completeness}
\email{aapyshkin@gmail.com}
\thanks{
      %Theorems~\ref{thm-main},~\ref{thm-graph-eq} and~\ref{ray-thm} were obtained
        The work was performed within the framework of the grant of the Government
          of the Russian Federation, agreement 08.11.2019 no.\,075-15-2019-1620.
        The research was also supported by «Native towns», a social investment program of PJSC «Gazprom Neft».
        %Theorem~\ref{thm-kpd} was obtained within the Russian Science Foundation grant no.\,20-61-46016.
        }
\maketitle
\section{Introduction}
  Consider a complete minimal vector system $\fsys = \seq{f}$ in an infinite-dimensional Hilbert space $\cal{H}$.
  The sequence is called \emph{minimal} if none of its elements can be approximated by the linear combinations of the others.
  The system $\fsys$ is complete and minimal if and only if it possesses a unique biorthogonal system $\fstarsys=\left\{f_n^*\right\}_{n=1}^\infty$.
  We say that $\fsys$ is an $M$-basis if $\fstarsys$ is complete as well.

  With any minimal system $\fsys$ we associate an algebra $\cal{A}$ of bounded operators 
  and its subalgebra $R_1(\cal{A})$ generated by the rank one operators in $\cal{A}$:
  \begin{align*}
    &\cal{A} = \{T\in B(\cal{H}) \mid Tf_n = \lambda_n f_n, \text{ for some } \lambda_n \in \mathbb{R}, n \geq 0\},\\
    &R_1(\cal{A}) = span\left\{f^*_n \otimes f_n\right\}_{n = 1}^\infty,
  \end{align*}
  where $f^*_n \otimes f_n$ is an operator which sends $x$ to $\inner{x}{f^*_n} f_n$ and
    $span$ denotes the linear span.
  We denote by $\lattice$ the lattice of invariant subspaces for operators in $\cal{A}$.


  In this paper we will need the following definitions.
  \begin{definition}[one point density property]
    \label{1pd}
    We say that the algebra $R_1(\cal{A})$ is \emph{one point dense} in the algebra $\cal{A}$ if for any $x \in \cal{H}$ and $\varepsilon > 0$
      there exists such $T\in R_1(\cal{A})$ that $||Tx - x|| < \varepsilon$.
  \end{definition}

  %\begin{remark}
    The definition is equivalent to $\fsys$ being a strong $M$-basis (see~\cite{katavolos}, Proposition 1.2, Remark 2):
    the system $\fsys$ is called a strong $M$-basis if for any $x\in\cal{H}$ we have $x \in \overline{span}\big\{\inner{x}{f^*_s}f_s\big\}$, where $\overline{span}$ denotes the closed linear span.
  %\end{remark}

  The next definition is a generalization of the previous one.
  \begin{definition}[$k$ point density property]
    \label{kpd}
    We say that the algebra $R_1(\cal{A})$ is \emph{$k$ point dense} in $\cal{A}$ (or that the algebra $\cal{A}$ has
      \emph{$k$ point density property}) if for any $x_1, x_2, \dots, x_k \in \cal{H}$ and $\varepsilon > 0$
      there exists such $T\in R_1(\cal{A})$ that $||Tx_s - x_s|| < \varepsilon$ for any $1 \leq s \leq k$.
  \end{definition}

  \begin{definition}[rank one density property]
    \label{r1d}
    We say that the algebra $\cal{A}$ has \emph{rank one density property} (or that the algebra $R_1(\cal{A})$
      is rank one dense in $\cal{A}$) if
      %the unit ball of the rank one subalgebra $R_1(\cal{A})$ is dense in the unit ball of $\cal{A}$ in the strong operator topology.
      $R_1(\cal{A})$ is dense in $\cal{A}$ in the ultraweak (or $\sigma$-weak) topology.
  \end{definition}
  We will say that the system $\fsys$ is \emph{rank one dense} (\emph{$k$ point dense})
    when rank one density ($k$ point density) holds for the algebra $\cal{A}$.

  %It is well known that the last definition~\ref{r1d} is equivalent to $R_1(\cal{A})$ being dense
    %in $\cal{A}$ in the ultraweak (or $\sigma$-weak) topology.
  %The rank one density property can be considered as a generalization of the notion of \emph{linear summation method}
    %for the system $\fsys$.
  %We say that the system $\fsys$ admits a linear summation method
    %if there exist $\alpha_{sn} \in \mathbb{C}, n \in \mathbb{N}, 0 < s < s_n$
    %such that for any $x \in \cal{H}$,
    %\[
      %\lim_{n \to \infty} \sum_s \alpha_{sn} \inner{x}{f^*_s}f_s = x.
    %\]
  %Clearly, the existence of the linear summation method implies rank one density property.

  Notice that rank one density property of an algebra implies $k$ point density property for any $k > 0$.
  On the other hand, two point density property ($k$ = 2) implies one point density property.
  But is it true that one point density implies rank one density?
  Is it true that $k$ point density for some $k > 1$ implies rank one density?

  It happens that the first question had been investigated for quite a long time, before it was settled.
  Long\-staff in~\cite{longstaff} studied the abstract subspace lattices and the corresponding operator algebras.
  Particularly, Longstaff proved that rank one density property of an algebra implies
    the complete distributivity of its lattice (see Raney~\cite{raney} for a definition).
  Later it was shown that the complete distributivity of a subspace lattice generated from an $M$-basis
    is equivalent to one point density of this basis (see~\cite{argyroslambrou} for a proof).
  In the same paper the following question was raised: does the complete distributivity of $\lattice$ imply rank one density property?
  The answer had been already known to be positive in the case of a totally ordered lattice~\cite{erdos}, and
    Longstaff had proved it for a finite-dimensional Hilbert space in~\cite{longstaff}.
  Later Laurie and Longstaff discovered that rank one density holds in the case of commutative subspace lattices~\cite{laurielongstaff}.

  However, the solution for the general case remained unknown until Larson and Wogen showed that the answer is negative (see~\cite{larson}).
  They constructed an example of a system $\fsys$ such that the lattice $\lattice$ generated from $\fsys$
    was completely distributive, but the corresponding algebra $\cal{A}$
    did not possess rank one density property.
  This system was also discussed by Argyros, Lambrou and Longstaff in the Addendum to~\cite{argyroslambrou}.
  We will refer to this particular example as to the Larson--Wogen system in this paper.
  \begin{example}[Larson--Wogen system $\fsys_{LW}$]
    \label{lw-sys}
    Fix an orthonormal basis $\{e_n\}_{n=1}^\infty$ in $\cal{H}$. For any $j > 0$ we define
    \begin{align*}
      &f_{2j-1}=-a_{2j-2}e_{2j-2} + e_{2j-1} + a_{2j-1}e_{2j}, \qquad &f_{2j}=e_{2j},\\
      &f^*_{2j}=-a_{2j-1}e_{2j-1}+e_{2j}+a_{2j}e_{2j+1}, \qquad &f^*_{2j-1}=e_{2j-1},
    \end{align*}
    where $a_0 = 0$ and for $k > 0$ the parameters $a_k$ are real and nonzero.\\
    For $a_{2k-1}= a_{2k} = 2^k$ the system $\fsys_{LW}$ is one point dense and not two point dense.
  \end{example}
  The given construction was remarkably simple and elementary, and appeared in several papers afterwards.
  This example was studied by Azoff and Shehada in~\cite{azoff}, regarding the reflexivity of $\lattice$, and also in~\cite{me}.
  In 1993 Katavolos, Lambrou and Papadakis in~\cite{katavolos} performed a deeper analysis of the density properties
    of this system and deduced that this system is two point dense if and only if it is rank one dense.

  Example~\ref{lw-sys} showed that one point density does not imply rank one density and
    in~\cite{larson} Larson and Wogen asked for some generic conditions on the $M$-basis
    for this to hold.
  It seems that not much progress has been made in this direction since then.
  The aim of this paper is to suggest a more general approach to rank one density property
    for a class of $M$-bases.
  We are going to study the aforementioned density properties for a class of systems that represents a natural generalization of the Larson--Wogen system.

  Our construction allows us to reformulate rank one density problem in terms of flows in infinite networks.

  In the next section we establish the notation and state the main theorem.
  In Section~\ref{sec:char} we work with the infinite networks and prove the main theorem.
  In Section~\ref{sec:kpd} we also analyze $k$ point density property in the same framework.

  Notice that we will proceed under the assumption that the underlying Hilbert space is real.
  This is important for our procedure and though the complex case can be approached in
    a similar manner, it is not trivial and we will not discuss the complex case further.
\bigskip
\section{From B-class systems to B-networks}
    \label{sec:refor}
    \label{fsys2graphs}
    We are interested in rank one density property of the system $\fsys = \seq{f}$
      in a separable real Hilbert space $\cal{H}$.
    Let $\seq{e}$ be an orthonormal basis in $\cal{H}$.
    Let $\fstarsys = \{f_n^{*}\}_{n=1}^\infty$ be a biorthogonal system to the original system $\seq{f}$.
    We will use notation $f_{ns}$ for $\inner{f_n}{e_s}$ and similarly $f^*_{ns}$ for $\inner{e_s}{f^*_n}$.
    \begin{definition}
      We say that the system $\fsys$ belongs to the \emph{B-class} whenever the following conditions are satisfied:
      \begin{enumerate}[label=\textbf{C\arabic*}]
        \item \label{c1} both $\fsys$ and $\fstarsys$ are complete (or $\fsys$ is an $M$-basis);
        \item \label{c2} either $f_n = e_n$ or $f^*_n = e_n$ for any $n > 0$;
        \item \label{c3} $f_{nn} = f^*_{nn} = 1$ for any $n > 0$;
        \item \label{c4} $f_{ns} = -f^*_{sn}$ for any $n, s > 0, n \neq s$;
        \item \label{c5} the matrices $\{f_{ns}\}$ and $\{f^*_{ns}\}$ are both finite-band,
            meaning that there exists $B \in \mathbb{N}$ such that $f_{ns} = f^*_{ns} = 0$, when $\lvert n - s \rvert > B$.
          We will call such smallest $B$ the \emph{band width} of the system $\fsys$.
      \end{enumerate}
    \end{definition}
    \begin{prop}
      The definition given above guarantees the biorthogonality of $\seq{f}$ and $\{f^*_n\}_{n=1}^\infty$.
    \end{prop}
    \begin{proof}
      Consider the set of indices $N = \left\{n \in \mathbb{N} \mid f_n = e_n \right\}$.
      The property~\ref{c4} yields that $f_{ns}$ is equal to zero whenever $s$ is not in $N \cup \{n\}$:
      \[
        \inner{f_n}{e_s} = -\inner{e_n}{f^*_s} = -\inner{e_n}{e_s} = 0.
      \]
      Similarly, $f^*_m$ is orthogonal to $e_s$ for all $s$ in $N \setminus \{m\}$.
      We also have
      \[
        \inner{f_n}{f^*_m} = \sum_{s} f_{ns} f_{ms}^*.
      \]
      It follows from above that each summand on the right side is equal to zero whenever $s \neq n, m$.
      If $n \neq m$, we get
      \[
        \inner{f_n}{f^*_m} = f_{nn} f^*_{mn} + f_{nm} f^*_{mm}
        = f^*_{mn} + f_{nm} = 0.
      \]
      Otherwise, if $n = m$, we get $\inner{f_n}{f^*_m} = 1$ due to the conditions~\ref{c2} and~\ref{c3}.
    \end{proof}
    \begin{remark}
      Notice that for the biorthogonality we need only the properties~\ref{c2} --~\ref{c4}.
    \end{remark}
    The B-class systems is the main subject of this section.
    It is a natural extension of the Larson--Wogen system (see Example~\ref{lw-sys}).

    Next, a B-class system $\fsys$ can be associated with a
      locally-finite weighted bipartite graph $B(\fsys) = (V, E, \wt)$, where $\wt$ is a
      nonzero real-valued function on $V\times V$ such that $\wt(v, u) = -\wt(u, v)$.

    For any index $r$ we construct a vertex in the first part of the bipartite graph.
    Evidently, for such indices $r$ the condition $f_r = e_r$ holds due to the definition of the B-class systems.
    On the other hand, for each index $l$ such that $f^*_l = e_l$ we put the vertex $v_l$ in the other part of the bipartite graph.
    We will call the first part from now on the \emph{right} part of the graph $B(\fsys)$ and the second part
      will be referred as the \emph{left} part of the graph $B(\fsys)$.
    From this point forward, $v_l$ and $v_r$ in a similar setup will denote the verices from the left and right part correspondingly.

    We put an edge between two vertices $v_l$ and $v_r$ from the left and right parts respectively,
      whenever the scalar product $f_{lr}$ is not zero.

    We set the weight function $\wt$ on the edge $(v_l v_r)$ as
    \begin{equation}
      \label{def-wt}
      \wt(v_l, v_r) = f_{lr}, \qquad \wt(v_r, v_l) = -\wt(v_l, v_r) = f_{rl}^*.
    \end{equation}
    We put $\wt(u, v) = 0$ if $u$ and $v$ are not connected by an edge (or, equivalently, $f_{lr} = 0$).
    In what follows we will often write $\wt_{lr}$ instead of $\wt(v_l, v_r)$.

    Since the Hilbert space is infinite-dimensional, the graph is infinite as well.
    However, due to the finite-band condition~\ref{c5}, the vertices of the graph are of a finite degree (the degree does not
      exceed $2B$, where $B$ is the band width of $\fsys$).
    %\begin{remark}
      %Note that there might be several systems for a single weighted bipartite graph $B$.
    %\end{remark}
    %\begin{remark}
      %Observe that both parts of the constructed bipartite graph contain an infinite number of vertices, because
        %the system $\fsys$ is an $M$-basis.
    %\end{remark}
    %You can see the bipartite graph built from the Larson--Wogen system in the Figure~\ref{lw-bgraph}.

    \medskip
    Below we formulate the main theorem.
    \begin{theorem}
      \label{thm-main}
      The B-class system $\fsys$ is rank one dense if and only if
        for any infinite path $\seq{r}$ without self-intersections in the bipartite graph $B(\fsys)$
        we have
        \[
          \sum_{n=1}^\infty\lvert\wt(r_n, r_{n+1})\rvert^{-1} = \infty.
        \]
    \end{theorem}
    Notice that the bipartite graph $B(\fsys_{LW})$, associated with the Larson--Wogen system~\eqref{lw-sys},
      consists only of a single infinite path.
    Therefore, we can apply Theorem~\ref{thm-main} to $\fsys_{LW}$, thus reestablishing
      the known result from the paper~\cite{katavolos}.
    \begin{corol}
      The system $\fsys_{LW}$ admits rank one density property if and only if
        the sequence $\left\{a_n^{-1}\right\}_{n=1}^\infty$ does not belong to $\ell^1$.
    \end{corol}

    Though it remains unclear for us whether there is an $M$-basis which is two point dense but not three point dense,
      even for B-class systems, we are going to prove the following theorem in Section~\ref{sec:kpd}.
    \begin{theorem}
      \label{thm-kpd}
      Let $\fsys$ be a B-class system which has a band width equal to $B$.
      If $\fsys$ is $4B - 2$ point dense then it is rank one dense.
    \end{theorem}
    %\begin{figure}
      %\begin{center}
      %\begin{tikzpicture}[thick,
                          %every node/.style={draw},
                          %%every fit/.style={ellipse,draw,inner sep=-1pt,text width=1cm},
                          %]

        %\begin{scope}[start chain=going below,node distance=12mm]
          %\foreach [evaluate={\k=int(\i*2 + 1)}] \i in {0,...,3}
          %\node[lnode,on chain] (l\k) [label=left: $v_{\k}$] {$e_{\k}$};
          %\node[draw=none,on chain, yshift=7mm]{$\vdots$};
        %\end{scope}
        %\begin{scope}[xshift=4cm,yshift=-0.7cm,start chain=going below,node distance=12mm]
          %\foreach [evaluate={\k=int(\i*2 + 2)}] \i in {0,...,3}
          %\node[rnode,on chain] (r\k) [label=right: $v_{\k}$] {$e_\k$};
          %\node[draw=none,on chain, yshift=7mm]{$\vdots$};
        %\end{scope}

        %% the set U
        %%\node [fit=(l1) (l5),label=above:\emph{left}] {};
        %% the set V
        %%\node [fit=(r6) (r9),label=above:\emph{right}] {};

        %% the edges
        %\begin{scope}[wnode]
          %\foreach [evaluate={\l=int(\i*2 + 1);\r=int(\i*2 + 2)}] \i in {0,...,3}
          %\draw (l\l) to node[draw=none, color=black] {\footnotesize $\mathrm{w}_{\l\r}=a_{\r}$} (r\r);
          %\foreach [evaluate={\l=int(\i*2 + 3);\r=int(\i*2 + 2)}] \i in {0,...,2}
          %\draw (l\l) to node[draw=none,color=black] {\footnotesize $\mathrm{w}_{\r\l}=a_{\l}$} (r\r);
        %\end{scope}
      %\end{tikzpicture}
      %\caption{The bipartite graph $B(\fsys_{LW})$ } \label{lw-bgraph}
      %\end{center}
    %\end{figure}

    \medskip
    \subsection{Rank one density property for B-class}
      Suppose we have a B-class system $\fsys=\seq{f}$.
      %Our purpose is to analyze two point density property of $\fsys$.
      %Before we pursue that, we need to investigate the conditions under which the B-class system is rank one dense.
      We intend to reformulate rank one density problem for the B-class systems in terms of infinite networks.

      Recall that the system $\seq{f}$ is rank one dense
        if and only if there is no trace class operator $T: \cal{H} \to \cal{H}$ with the trace equal to one
        that belongs to the annihilator of the rank one subalgebra $R_1(\cal{A})$, which is equivalent to
        $\inner{Tf_n}{f_n^*} = 0$ for any $n$
        (see Theorem 2.2 of~\cite{katavolos} for details).

      Suppose that there is an operator $T$ such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$.
      There are two cases: either $f^*_n = e_n$ or $f_n = e_n$.
      In the first case the condition $\inner{Tf_n}{f_n^*} = 0$ turns into
      \begin{equation}
          \label{left-eqn}
          \sum_j T_{nj} f_{nj} = 0,
      \end{equation}
      and in the second case it is equivalent to
      \begin{equation}
          \label{right-eqn}
          \sum_j T_{jn} f^*_{nj} = 0,
      \end{equation}
      where $T_{ij} = \inner{Te_j}{e_i}$.

      Now consider an auxiliary function $\flowsgn: V \times V \to \mathbb{R}$ defined as follows
      \begin{align*}
        &\flowsgn(v_l, v_r) = T_{lr} f_{lr} = T_{lr} \wt_{lr},\\
        &\flowsgn(v_r, v_l) = T_{lr} f^*_{rl} = T_{lr} \wt_{rl},
      \end{align*}
      and equal to zero on the other pairs of vertices.
      Observe that $\flowsgn$ is a skew-symmetric function.
      Moreover, two equalities~\eqref{left-eqn} and~\eqref{right-eqn} correspond to the \emph{left} and \emph{right}
        parts of the bipartite graph $B(\fsys)$ respectively.
      It follows that the condition $\inner{Tf_n}{f_n^*} = 0$ could be reduced to
      \begin{equation}
        \label{almost-flow-eqn}
        \sum_{u \in V} \flowsgn(v, u) + T_{vv} = 0
      \end{equation}
        for each vertex $v$ in the graph $B(\fsys)$.
      \begin{remark}
        Observe that the function $\flowsgn$ defined on the graph $B(\fsys)$ resembles
          a \emph{flow} defined on the edges of the graph $B(\fsys)$.
        One might also see that the equation~\eqref{almost-flow-eqn} describes the total flow (sum of the outgoing flows and incoming flows) 
          for each vertex $v$ in the graph $B(\fsys)$.
        In order to formalize this observation we are going to build a flow
          after a few changes are made to the graph $B(\fsys)$.
      \end{remark}

    \medskip
    \subsection{Preliminaries on flows and networks}
      Before we proceed we are going to introduce a few basic definitions.
      \begin{definition}
        \emph{Network} $\net$ is a quadruple $(G, \len, \source, \sink)$, where $G = (V, E)$ is a weighted graph without
        self-loops and multiple edges
        with a positive length function $\len$ on $E$ and two vertices $\source, \sink \in V$, which
        we will call \emph{source} and \emph{sink} of the network respectively.

        Analogously, we can define an \emph{oriented network} $\onet$ which is
          a quadruple $(\vec{G}, \len, \source, \sink)$, where
          $\vec{G} = (V, \vec{E})$ is an oriented weighted graph with
          a positive length function $\len$ on $\vec{E}$ and two vertices $\source, \sink \in V$, which
          we will call the \emph{source} and the \emph{sink} of the oriented network respectively.
      \end{definition}
      \begin{remark}
        Notice that the oriented graph is a directed graph without bidirected edges,
          i.e. $(uv)$ or $(vu)$ is not contained in $E$.
      \end{remark}
      \begin{definition}
        For a network $\net$ a skew-symmetric function
          $\flow: V \times V \to \mathbb{R}$ is called a \emph{pseudo-flow}.
      \end{definition}
      \begin{definition}
        For an oriented network $\onet$ a \emph{positive} function
          $\flowpos: \vec{E} \to \mathbb{R}^{+}$ is called a \emph{pseudo-flow}.
      \end{definition}
      \begin{remark}
        There is a natural mapping between pseudo-flows defined on networks and pseudo-flows defined on oriented networks.
          Namely, for a pseudo-flow $\flowposplus$ defined on an oriented network $\onet = (V, \vec{E}, \len, \source, \sink)$
          one can consider a skew-symmetric function
          $\flow: V \times V \to \mathbb{R}$,
        \begin{align*}
          \flow(u, v)=
          \begin{cases}
            \flowposplus(e) \qquad \text{if } e = (uv) \in \vec{E},\\
            -\flowposplus(e) \qquad \text{if } e = (vu) \in \vec{E}, \\
            0 \qquad \text{otherwise}.
          \end{cases}
        \end{align*}
          Then the function $\flow$ is a pseudo-flow defined on the network $\net = (V, E, \len, \source, \sink)$, where $V$, $\len$, $\source$ and $\sink$ are the same
          as in $\onet$ and $E = \{(uv) \mid (uv) \text{ or } (vu) \in \vec{E}\}$.

        Conversely, suppose we have a network $\net = (V, E, \len, \source, \sink)$ and $\flow$ is a pseudo-flow defined
          for $\net$.
        Then we can define the oriented network $\onet = (V, \vec{E}, \len, \source, \sink)$, where $V$, $\len$, $\source$ and $\sink$
          are the same, and $\vec{E} = \{(uv) \mid (uv) \in E, \, \flow(u, v) > 0 \}.$
        This way only one of the edges $(uv)$ and $(vu)$ are present in the graph $\vec{G} = (V, \vec{E})$,
          so $\vec{G}$ is an oriented graph and $\onet$ is an oriented network.
        The function $\flowposplus: E \to \mathbb{R}^{+}$ is defined in the following way:
          for any edge $e =(uv) \in \vec{E}$ we have $\flowposplus(e) = \flow(u,v)$.
        By definition, $\flowposplus$ is a pseudo-flow defined for the oriented network $\onet$.
      \end{remark}

      \begin{definition}
        Let $G = (V, \vec{E})$ be an oriented graph.
        For each vertex $v \in V$ we define $\ein_G(v)$ as the set of incoming edges
          and $\eout_G(v)$ as the set of outgoing edges in the graph $G$.
        We will omit the graph from the notation whenever it is clear from the context.
        For the set of vertices $V_0$ we denote
        \begin{align*}
          &\ein(V_0) = \big\{(uv)\in \vec{E} \mid u \in V \setminus V_0, v \in V_0\big\},\\
          &\eout(V_0) = \big\{(vu) \in \vec{E} \mid u \in V\setminus V_0, v \in V_0\big\}.
        \end{align*}
        For the subgraph $G_0 = (V_0, \vec{E}_0) \subseteq G$ we use the same notation.
        \begin{align*}
          &\ein(G_0) = \big\{(uv)\in \vec{E}_0 \mid u \in V \setminus V_0, v \in V_0\big\},\\
          &\eout(G_0) = \big\{(vu) \in \vec{E}_0 \mid u \in V\setminus V_0, v \in V_0\big\}.
        \end{align*}
        For each edge $e=(uv) \in \vec{E}$ we will write %by $\init(e)$ the starting vertex $u$ and
          $\ter(e)$ for the ending vertex $v$.
        Set $\ter(\vec{E}_0) = \big\{\ter(e) \mid e\in \vec{E}_0\big\}$.
          %&\init(E_0) = \big\{\init(e) \mid e\in E_0\big\},\\
      \end{definition}
      \begin{definition}
        Let $\flow$ be a pseudo-flow defined on the network $\net$.
        Then $d^{+}(v)$ will stand for the sum of the pseudo-flows \emph{leaving} the vertex $v$ and
        $d^{-}(v)$ will stand for the sum of the pseudo-flows \emph{entering} $v$:
        \begin{align*}
          &d^{+}_{\flow}(v) = \sum_{\flow(v, u) > 0} \flow(v,u),\\
          &d^{-}_{\flow}(v) = \sum_{\flow(u, v) > 0} \flow(u,v).
        \end{align*}
        Let $d_{\flow}(v)$ be equal to $d^{+}_{\flow}(v) - d^{-}_{\flow}(v)$.
        We will refer to this value as a \emph{total flow} of the vertex $v$.
        The vertex $v$ is called \emph{$\flow$-active} if $d(v) < 0$,
          \emph{$\flow$-deficient} if $d(v) > 0$ and
          \emph{$\flow$-preserving} if $d(v) = 0$, meaning that the total incoming flow
          is equal to the total outgoing flow of the vertex $v$.
      \end{definition}
      For a pseudo-flow defined on an oriented network we can define these functions in a similar manner.
      \begin{align*}
        &d^{+}_{\flowpos}(v) = \sum_{(vu) \in \eout(v)} \flowpos(v, u),\\
        &d^{-}_{\flowpos}(v) = \sum_{(uv) \in \ein(v)} \flowpos(u, v),\\
        &d_{\flowpos}(v) = d^{+}_\flowpos(v) - d^{-}_\flowpos(v).
      \end{align*}
      \begin{definition}
        \label{flow-dfn}
        We will call the pseudo-flow $\flow$ a \emph{flow} if
          for any $v \in V$ the total flow is correctly defined
          (meaning that the corresponding sum converges absolutely),
          and for any $v \in V \setminus \{\source, \sink\}$ the total flow is zero: $d(v) = 0$.
      \end{definition}
      \begin{definition}
        \label{flow-preserving-dfn}
        For a network $\net$ and a flow $\flow$ we will say that the network $\net$ \emph{preserves}
          the flow $\flow$ if the total flows $d(\sink)$, $d(\source)$ are finite
          and $d(\sink) = -d(\source)$.
      \end{definition}
      \begin{remark}
        In simple words this property suggests that the total flow coming out of the source is equal to the total flow
          coming into the sink.
        Note that in the case when the underlying graph $G$ is finite, the network $\net$ always preserves the flow.
        It is the infinite case that is of interest.
      \end{remark}
      The definitions~\ref{flow-dfn} and~\ref{flow-preserving-dfn} are the same for the oriented networks.

      %\bigskip
      %\begin{remark}
        %The flow functions defined on networks and the positive flow functions on oriented networks
          %are interchangeable and describe the same objects.
        %The notion of the direction of the positive flow over the particular edge $(uv)$ of the oriented network
          %is incorporated into the sign of the flow on the same edge $(uv)$ of the non-oriented network.
      %\end{remark}

    \medskip
    \subsection{B-network construction}
      \begin{definition}
        Consider a network $\net = (G, \len, \source, \sink)$ such that
          the degree of each vertex in $V \setminus \{\source, \sink\} $ is finite,
          and the length of each edge incident to source or to sink is equal to one.
        Also we demand that the vertices $\source$ and $\sink$ are connected by a finite path.
        We will call such network a \emph{B-network}.
      \end{definition}

      In this section we build up a B-network from the graph $B(\fsys)$ and associate a flow $\flow$ on this network with 
        an arbitrary trace class operator $T$ which annihilates the rank one subalgebra $R_1(\cal{A})$.
      We will see later that this map is a bijection.
      Namely, we plan to construct the network $\net(\fsys) = (V, E, \len, \source, \sink)$,
        with the length function $\len: E \to \mathbb{R}^{+}$ and a real skew-symmetric flow $\flow: V \times V \to \mathbb{R}$.
      Firstly, we incorporate all the vertices and edges from the graph $B(\fsys)$ into the network $\net(\fsys)$.
      We set the flow and the length functions on the edge $(v_l v_r)$ as follows:
      \begin{align*}
        &\flow(v_l, v_r) = T_{lr} f^*_{rl},\\
        &\flow(v_r, v_l) = T_{lr} f_{lr} = -\flow(v_l, v_r),\\
        &\len(v_l v_r) = \lvert \wt(v_l, v_r) \rvert^{-1} =  \lvert f_{lr}\rvert^{-1}.
      \end{align*}
      \begin{remark}
        On this kind of edges the flow $\flow$ agrees with the function $\flowsgn$
          we examined a few paragraphs before.
      \end{remark}

      Now we add two new vertices: the source vertex $\source$ and the sink vertex $\sink$ to the constructed graph.
      For each vertex $v_l$ from the left part of the graph we connect it with the vertex $\source$ with the edge $(\source v_l)$
        and assign the flow to the newly constructed edge.
      \begin{align*}
        &\flow(v_l, \source) = -\flow(\source, v_l) = T_{ll}.
      \end{align*}
      We set the length equal to one for such edges: $\len(\source v_l) = 1$.
      As we added the edges $(\source v_l)$, the flow became \emph{preserved} at each vertex of the left part of the network $\net(\fsys)$.

      Likewise, for any vertex $v_r$ from the right part of the graph we add a new edge $(v_r \sink)$
        and set the flow $\flow$ equal to:
      \begin{align*}
        &\flow(v_r, \sink) = -\flow(\sink, v_r) =  T_{rr}.
      \end{align*}
      Again, we set $\len(v_r \sink) = 1$ for any $k$.

      The network $\net(\fsys)$ is obviously a B-network.
      The defined function $\flow$ is a flow, since for each vertex the total flow is correctly defined,
        and each of the vertices except $\source$ and $\sink$ preserves $\flow$ due to~\eqref{almost-flow-eqn}.
      %\begin{remark}
        %Sometimes it might be useful to consider slightly different definition of the network.
        %Instead of studying an oriented graph with a positive flow on it we might consider
        %an undirected graph with a skew-symmetric flow on the edges.
        %Intuitively, the direction of the flow could be expressed either via the direction of the edge
        %or with the sign of the flow , and these two definitions describe the same objects.
        %Formally there is a isomorphism between these two types of objects.
      %\end{remark}
      \begin{remark}
        Note that the network $\net(\fsys)$ depends only on the biorthogonal system $\fsys$ and not on the operator $T$.
        Only the flow $\flow$ depends on the operator $T$.
      \end{remark}
      What can be said about the total flow in each of the vertices of the constructed network $\net(\fsys)$?
      Due to the trick we performed, the total flow became zero in each of the vertices from the left and the right parts.
      The total flow $d(\source)$ in the source vertex is equal to $-\sum T_{ll}$, and the total flow in the
        sink vertex is now equal to $-\sum T_{rr}$.
      Now one can see that the network $\net(\fsys)$ is $\flow$-preserving if and only if the trace of the operator $T$ is equal to zero.
      \begin{definition}
        Consider a network $\net = (V, E, \len, \source, \sink)$ and a flow $\flow$ on it.
        We write $\lvert\flow\rvert$ for the \emph{mass} of the flow $\flow$:
        \[
          \lvert\flow\rvert = \sum_{e \in E} \lvert\flow(e) \len(e)\rvert.
        \]
        For the flow $\flowpos$ on the oriented network we will use the same notation.
        %We allow it to be equal $+\infty$ as well.
      \end{definition}
      %\begin{definition}
        %If $\flowpos$ is an oriented flow on the oriented network $\net = (V,\vec{E},\len, \source, \sink)$,
          %we can introduce the same term for the \emph{mass} of the flow:
        %\[
          %\lvert\flowpos\rvert = \sum_{e \in \vec{E}} \lvert\flowpos(e) \len(e)\rvert.
        %\]
        %Though in the oriented case the flow is always positive,
          %so we are allowed to omit the modulus signs:
        %\[
          %\lvert\flowpos\rvert = \sum_{e \in \vec{E}} \flowpos(e) \len(e).
        %\]
      %\end{definition}
      \begin{theorem}
        \label{thm-graph-eq}
          Let $\net(\fsys) = B(\fsys, \len, \source, \sink)$ be a B-network constructed
            from the B-class system $\fsys = \seq{f}$.
          Then $\fsys$ is rank one dense if and only if
            the network $\net(\fsys)$ is $\flow$-preserving for any finite-mass flow $\flow$.
      \end{theorem}
      \begin{proof}
        Suppose that the system $\seq{f}$ is not rank one dense.
        As we mentioned before, it implies that there exists a trace class operator $T: \cal{H} \to \cal{H}$ with
          the trace equal to one, such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$.
        Using the operator $T$, we were able to define a flow $\flow$ on the network $\net(\fsys)$.
        The constructed flow has a finite mass because the operator matrix of $T$ is finite-band and $T$ is of trace class.
        Finally, the network $\net(\fsys)$ does not preserve the flow since
        \[
          d(\source) + d(\sink) = -\sum_{l} T_{ll} -\sum_{r} T_{rr} = -Tr(T) = -1,
        \]
        thus $d(\sink) \neq -d(\source)$.

        Conversely, suppose that the system $\fsys$ is rank one dense.
        Assume that there is also a flow $\flow$ on the network $\net(\fsys)$ such that $d(\sink) + d(\source) \neq 0$.
        Firstly, consider the edges incident to the source vertex.
        Having all the vertices already enumerated we will consider the vertices in the left part $v_{l}$.
        Recall that each vertex $v_i$ (except source and sink) corresponds to the basis element $e_i$.
        Assign the diagonal elements of $T$:
        \[
          T_{ll} = \flow(v_l, \source) \len(v_l v_l) = \flow(v_l, \source), \quad l > 0.
        \]
        Similarly for the right part:
        \[
          T_{rr} = \flow(v_r, \sink) \len(v_r v_r) = \flow(v_r, \sink), \quad r > 0.
        \]
        Now consider two connected vertices $v_l$, $v_r$ from the left and right part respectively.
        Let $T_{lr} = \flow(v_l, v_r) \len(v_l  v_r)$,
        and all the other elements of the operator matrix $T_{ij}$ be zero.
        Then observe that we obtained a finite-band operator matrix $T_{ij}$.
        Since the mass of the flow $\flow$ is finite, $T_{ij}$ is a summable sequence, considering that
          the $\ell^1$-norm of $T_{ij}$ is exactly the mass of $\flow$.
        Then the operator $T$ has a finite nonzero trace, since $Tr(T) = -d(\sink) - d(\source) \neq 0$.
        The flow $\flow$ is preserved at each vertex of the network $\net(\fsys)$, so due to~\eqref{almost-flow-eqn}
          the operator $T$ annihilates all the rank one operators in $R_1(\cal{A})$.
        Thus, the operator $T$ belongs to the annihilator of $R_1(\cal{A})$ but its trace is not zero,
          which is a contradiction to rank one density property.
      \end{proof}

  \bigskip
  \section{B-networks characterisation}
    \label{sec:char}
    Due to Theorem~\ref{thm-graph-eq}, we are able to analyze the flows on the B-network
      $\net(\fsys)$ in order to understand the conditions under which $\fsys$ is rank one dense.
    In this section we are not going to address the Hilbert space framework at all,
      instead we will use only the graph theory objects we introduced in the previous section.
    It will be more convenient for us to study the \emph{oriented} networks in this section unlike we
      did in the previous one.
    Consequently, the graphs, edges and networks are presumed to be oriented unless said otherwise.

    Next we introduce a few more notions of the graph theory.
    \begin{definition}
      Let $G = (V, E)$ be an oriented graph.
      A sequence of vertices $\{v_n\}_{n=1}^N$ is called a \emph{path} if each pair of consecutive vertices
        $v_n$ and $v_{n+1}$ are connected by an edge $(v_n v_{n+1})$ and no edges or vertices are repeated twice in the sequence.
      The path is called a \emph{ray} when $N$ is equal to infinity.
    \end{definition}
    \begin{definition}
      Let $G$ be an oriented graph.
      A finite sequence of vertices $\{v_n\}_{n=1}^N$ is called a \emph{cycle} (or a simple cycle) if it is
        a path and there is an edge $e = (v_N v_1)$ connecting the last vertex to the first vertex of the sequence.
    \end{definition}

    The main result of this section is Theorem~\ref{ray-thm}.
    \begin{theorem}
      \label{ray-thm}
      Let $\net = (G, \len, \source, \sink)$ be an oriented B-network.
      Then a positive flow $\flowpos: E \to \mathbb{R}^{+}$ such that
      \begin{enumerate}[label=\textup{(\alph*)}]
        \item the flow $\flowpos$ has a finite mass,
        \item the network $\net$ does not preserve the flow,
      \end{enumerate}
      exists if and only if there exists a ray $r = \seq{r}$ in the network $\net$, taking its start at the vertex $\source$,
        with a finite total length:
      \[
        \sum_{n=1}^\infty \len(r_n r_{n+1}) < \infty.
      \]
    \end{theorem}
    The rest of this section is devoted to the proof of this theorem.

    We start with providing an equivalent variant of this theorem.
    %\begin{remark}
      %\label{inner-ray-rmk}
      %Notice that the definition of the B-network implies that the weight of any edge
        %incident to the source or the sink vertices is equal to one.
      %The ray $r$ has a finite length and thus it follows that only a finite number of edges $(r_k r_{k+1})$ could
        %be incident either to the source or to sink vertices.
      %This way the existence of the ray $r$ suggests that there also exists a ray $r^* \in V \setminus \left\{\source, \sink\right\}$.
    %\end{remark}
      Without loss of generality we might assume that $d(\sink) + d(\source) = 1$.
      To simplify the proof, we consider a modified network $\net' = (G', \source', \source')$.
      Namely, we merge the source vertex $\source$ with the sink vertex $\sink$ and call this a new source vertex $\source'$.
      This way we obtain a network $\net'$ with a single source such that $d(\source') = 1$.
      In that case the graph $G'$ is a rooted graph with the root at the vertex $\source'$.
      From now on we will employ the term \emph{root vertex} and denote it by $\root = \source'$.

      %Formally we set the sink vertex in the modified network to be the same as the source vertex: $\sink'=\source'$.
      The flow $\flowpos$ as well as the length function $\len$ stays exactly the same (being defined on the edges set $E'$).
      All the vertices in the graph continue preserving the flow after this procedure, except for the vertex $\root$,
        which is now \emph{$\flowpos$-deficient} since its total flow $d(\root)$ is equal to one.
      Thus $\net'$ is a network with a function $\flowpos$ being a flow as required.
      Obviously, the mass of the flow does not change since we did not change the lengths of the edges.
      Furthermore, the network $\net'$ does not preserve the flow $\flowpos$ by construction.

      It is clear that $\net'$ contains a finite length ray starting at the vertex $\root$ if and only if the original network $\net$ contains a finite length ray starting at the vertex $\source$.

      Therefore, we will be proving the following version of Theorem~\ref{ray-thm}.
      \begin{theorem}
        \label{ray-thm-reformulation}
        Let $\net = (G, \len, \source, \sink)$ be an oriented B-network such that $\source = \sink$.
        Then a positive finite-mass flow $\flowpos: E \to \mathbb{R}^{+}$ such that
          $\net$ does not preserve $\flowpos$ (it means that $d(\source) \neq 0$)
          exists if and only if there exists a ray $r = \seq{r}$
          which has a finite total length and starts at $\source$.
      \end{theorem}
      First, we will prove the converse implication.
      Suppose that there is a ray of a finite total length $r=(r_1 r_2 \dots)$.
      We set $\flowpos(r_n r_{n+1}) = 1$, creating a flow which escapes
        from $\source$ to infinity.
      All the other edges will not carry any flow (set $\flowpos = 0$), hence the flow is preserved
        at each vertex but not preserved by the whole network $\net$.

      The most difficult part of the proof is to find a finite-length ray
        given there is a non-preserving $\flowpos$ on $\net$.

      \medskip
      \subsection{Eliminating the positive flow cycles}
        For a start we get rid of all the positive flow cycles of the flow $\flowpos$ in the oriented network $\net$.
        \emph{A positive flow cycle} is a cycle $C$ in $G$ such that a positive flow circulates along $C$,
          meaning that for each edge $e \in C$ we have $\flowpos(e) > 0$.
        In order to accomplish that, we will present a sequence of the flows $\seq{\flowpos}$,
          defined on the network $\net$.
        At each step $n \in \mathbb{N}$ we examine a finite subgraph $G_n \subset G$ and present a flow $\flowposn{n}: E \to \mathbb{R}^{+}$
          such that $\flowposn{n}$ is monotone: for any edge $e \in E$ we have $\flowposn{n+1}(e) \leq \flowposn{n}(e)$.
        The main property of the flow $\flowposn{n}$ is that there will be no positive flow cycles in the induced subgraph
        $G_n$.
        We start with the flow $\flowposn{0}:E \to \mathbb{R}^+$ equal to $\flowpos$.
        %\[
          %\flowposn{0}(e) = \flowpos(e), \quad e \in E.
        %\]
        The first step $n = 1$ is trivial: the graph $G_1$ contains only the root vertex, and
          the flow $\flowposn{1}$ is equal to $\flowposn{0}$ at any edge $e \in E$.
        %\[
          %\flowposn{1}(e) = \flowposn{0}(e), \quad e \in E.
        %\]

        In order to proceed we enumerate all vertices in the network $V = \left\{v_s\right\}_{s=1}^\infty$.
        At the step $n$ we consider the subgraph $G_n = (V_n, E_n) \subset G$, where $V_n$ is defined as $\left\{v_s\right\}_{s=1}^n$
          and the edge set $E_n$ consists of the edges from $E$ with both endpoints lying in $V_n$.

        Suppose we have already established the flow $\flowposn{n}: E \to \mathbb{R}^{+}$.
        We are aiming to construct the flow $\flowposn{n+1}: E \to \mathbb{R}^{+}$.

        Define the flow function $\cal{E}_0(e): E \to \mathbb{R}^{+}$ as $\cal{E}_0(e) = \flowposn{n}(e).$
        Let $C_1$ be a simple cycle in the graph $G_{n + 1}$ such that each edge $e \in C_1$ carries
          a positive flow: $\cal{E}_0(e) > 0$.
        At this point we can decrease the flow $\cal{E}_0$ on the edges of $C_1$ so that the cycle $C_1$
          ceases being a positive flow cycle, total mass of the flow does not increase, and all the other properties stay intact.
        Denote by $\min(C_1)$ the minimal value the flow $\cal{E}_0$ attains on the edges of $C_1$.
            %\min(C_1) = \min_{e \in C_1}\left(\cal{E}_0(e)\right).
        Consider an adjusted flow $\cal{E}_1$.
        \begin{equation*}
          \cal{E}_1(e) =
          \begin{cases}
            \cal{E}_0(e) - \min(C_1) \quad \text{if } e \in C_1,\\
            \cal{E}_0(e) \quad \text{otherwise}.
          \end{cases}
        \end{equation*}
        Since $C_1$ is a cycle, we reduced the flow $\cal{E}_0$ in each edge by the same value,
          so $\cal{E}_1$ is indeed a flow.
        After this procedure the positive flow cycle $C_1$ disappears,
          leaving us with a lesser flow than we had before this step: $\cal{E}_1(e) \leq \cal{E}_0(e)$ for any $e \in E_{n+1}.$
        In this manner we remove all the positive flow cycles from the finite graph $G_{n + 1}$.
        It is achievable since at each step we turn at least one edge of $G_{n + 1}$
          into a zero-flow edge (such edge $e$ that $\cal{E}_0(e) = 0$).

        Suppose we removed $K$ positive flow cycles in total from the graph $G_{n + 1}$.
        Then set the flow $\flowposn{n+1}$ equal to the final flow $\cal{E}_K$: $\flowposn{n+1} = \cal{E}_K.$
        We have $\flowposn{n+1}(e) \leq \flowposn{n}(e) \leq \flowpos(e)$ for each edge $e \in E$.

        Now set $\preflow(e) = \lim\limits_{n \to \infty} \flowposn{n}(e)$ for each $e \in E$.
        The described pointwise limit exists since for each edge $e$ the sequence $\{\flowposn{n}(e)\}_{n=1}^\infty$ is decreasing and bounded below.
        \begin{prop}
          The function $\preflow: E \to \mathbb{R}^+$ is a flow such that $d_{\preflow}(\root) = d_{\flowpos}(\root)$.
          The graph $G$ contains no positive flow cycles of $\preflow$.
        \end{prop}
        \begin{proof}
          Obviously, for each $n$ the function $\flowposn{n}$ is a flow since we do not affect the total flow each time we remove a positive flow cycle.

          Now we need to obtain the same for the limit case.
          Firstly, look at the non-root vertex $v$.
          Since there are a finite number of edges in $E$ incident with $v$, the limit of
            a finite sum $d_{\flowposn{n}}(v)$ is equal to $d_{\preflow}(v)$.
          The vertex $v$ is not a root, so $d_{\flowposn{n}}(v) = 0$ for any $n$, and so the limit $d_{\preflow}(v)$ is equal to zero as well.
          Consequently, the function $\preflow$ is a flow in the network $\net$.

          Secondly, consider the root vertex $\root$.
          It may have an infinite degree.
          Notice that
          \[
            d_{\flowposn{n}}(\root) \overset{\mathit{def}}{=} \sum_{\eout(\root)} \flowposn{n}(e) - \sum_{\ein(\root)} \flowposn{n}(e).
          \]
          Since the sequence $\{\flowposn{n}(e)\}_{n=1}^\infty$ is decreasing and bounded from below,
            the quantity $d_{\preflow}(\root)=\sum_{\eout(\root)} \preflow(e) - \sum_{\ein(\root)} \preflow(e)$ is defined correctly.
          Since $d_{\flowposn{n}}(\root)$ is equal to $d_\flowpos(\root)$ for any $n$ due to the given algorithm, we have
          \[
            d_\preflow(\root) = \lim_{n \to \infty} d_{\flowposn{n}}(\root) = d_\flowpos(\root).
          \]
          Now we prove the second part of the proposition.
          To obtain a contradiction, suppose that there is a cycle $C$ such that $\preflow(e) > 0$ for
            each edge $e \in C$.
          Clearly, there exists such $n$ that the cycle $C$ lies within the graph $G_n$.
          Since at each step we reduced the flow, at the step $n$
            the cycle $C$ was a positive flow cycle as well: $\flowposn{n}(e) > 0$ for each edge $e \in C$.
          That is a contradiction.
        \end{proof}

        Now we can assume that $\flowpos$ contained no positive flow cycles in the first place.
        Also we remove the edges of the network $\net$ for which the flow $\flowpos$ equals zero.

      \medskip
      \subsection{Subgraphs construction}
        We are going to need a few definitions in order to proceed with the proof of the theorem.
        \begin{definition}
          Let $G = (V, E,\len, \root)$ be a weighted directed graph with a positive
            length function $\len$ defined on $E$ and a root vertex $\root \in V$.
          Then $\gpaths(u, v)$ denotes the set of paths from the vertex $u$ to the vertex $v$ in the graph $G$.
          Sometimes we will omit the first argument, and in that case we will refer to the paths from the root vertex
            $\gpaths(v) = \gpaths(\root, v)$.
          Furthermore, we expand this notion onto the vertices sets: $\gpaths(U,V)$ is the set of paths
            from the set of vertices $U$ to the set of vertices $V$ in the graph $G$.
          We write $\gpaths$ for the set of all paths in the graph $G$.
        \end{definition}
        \begin{definition}
          \label{def-dist-fun}
          The distance function $\gfi: \gpaths \to \mathbb{R}^{+}$ is given by $\gfi(p) = \sum_{e \in p} \len(e)$.
          We extend this function to take values on the set of the vertices $V \setminus \{\root\}$ as well,
            $\gfi(v) = \displaystyle\inf_{p \in \gpaths(v)} \gfi(p).$
          We will assume that $\gfi(\root) = 0$.
        \end{definition}

        Our goal in the following paragraphs is to provide an estimate on the values of the distance function $\gfi$ on any vertex $v$
          located ''far'' from $\root$, namely for any integer $N > 0$ we are to provide $M > 0$ such that
          for any $v$ satisfying $\displaystyle\inf_{p \in \gpaths(v)} \#\left\{ e \mid e \in p\right\} > N$,
          one has $\gfi(v) < M$, where the symbol $\#$ denotes the number of elements in the set.
        In order to do that we will build a sequence of flows defined
          on the finite subgraphs of $G$ approximating the flow $\cal{F}$.

        The construction is based on the breadth-first search in the infinite graph $G$.
        We are going to define \emph{finite} subgraphs $G_n = (V_n, E_n)$ of the network $\net$ such that $G_{n-1} \subset G_{n}$ for each $n > 1$.
        We denote by $L_n$ the vertex set difference $V_n \setminus V_{n-1}$.
        Besides, we are going to establish a sequence of the positive functions $\flowposn{n}: E_n \to \mathbb{R}^{+}$,
          pertaining the following properties.
        \begin{enumerate}[label=\textbf{P\arabic*}]
          \item \label{p1} $\flowposn{n+1}(e) \geq \flowposn{n}(e)$ for each $e \in E_n$;
          \item \label{p2} $\flowposn{n}(e) \leq \flowpos(e)$ for each $e \in E_n$;
          \item \label{p3} for the root vertex one has $d_{\flowposn{n}}(\root) = 1$;
          \item \label{p4} for any non-root $v \in G_{n-1}$ one has $d_{\flowposn{n}}(v) = 0$, for any $n > 1$;
          \item \label{p5} for each vertex $v \in L_n$ one has $d_{\flowposn{n}}(v) = -d^{-}_{\flowposn{n}}(v) < 0$.
        \end{enumerate}
      \medskip
      \subsection{Constructing \texorpdfstring{$G_n$}{Gn} and \texorpdfstring{$L_n$}{Ln}}
        Let $G_0$ be the subgraph containing the root vertex only: $V_0 = \left\{ \root \right\}$.

        The procedure of constructing $G_n$, $\flowposn{n}$ from $G_{n-1}$, $\flowposn{n-1}$
          is a little different for $n = 1$, since the root vertex degree is allowed to be infinite.
        Because of that we will deal with the case $n = 1$ separately.

        We multiply the flow function $\flowpos$ by some constant so that $d^{+}_{\flowpos}(\root) > 1$.
        At the first step we build the graph $G_1$ and the flow $\flowposn{1}$.
        We choose a \emph{finite} set of the edges
          $E_1 \subseteq \eout(\root)$ such that $\sum_{e \in E_1} \flowpos(e) \geq 1$.
        It is possible since $d^{+}_{\flowpos}(\root) > 1$.

        Then we define the \emph{first layer} $L_1$ as the end vertices of $E_1$: $L_1 = \ter(E_1)$, and accordingly
          $V_1 = V_0 \cup L_1$.
        Along with the graph $G_1 = (V_1, E_1)$ we set the function $\flowposn{1}: E_1 \to \mathbb{R}^{+}$
        \[
          \flowposn{1}(e) = \frac{\flowpos(e)}{\sum_{e\in E_1}{\flowpos(e)}}, \quad e \in E_1.
        \]
        \begin{prop}
          The function $\flowposn{1}$ satisfies all of the properties~\ref{p1}--\ref{p5}.
        \end{prop}
        \begin{proof}
          The properties~\ref{p1}--\ref{p4} are trivial to check.

          We included the ends of $E_1$ edges without any additional edges.
          Thus each vertex in $L_1$ has only incoming edges, which makes their
            total flow strictly negative (recall that we removed all zero-flow edges).
          Thus~\ref{p5} holds as well.
        \end{proof}
        \begin{remark}
          We dealt with the possibly infinite degree of the root vertex by abandoning some of the children of the root.
          We need $G_n$ to be finite in order to analyze the function $\gfi$.
        \end{remark}

        Now we go on with the general case $n > 1$.
        Suppose that $G_{n-1}$, $L_{n-1}$ and the function $\flowposn{n-1}$ are already defined for some $n > 1$.
        Consider the outgoing edges of the vertex $v \in L_{n-1}$.
        Some of them might lead to some new vertices, which do not belong to $G_{n-1}$.
        Such edges will be referred to as $\efor_n$,
        \[
          \efor_n = \Big\{ e = (uv) \mid u \in L_{n-1} \text{ and } v \notin G_{n-1}\Big\}.
        \]
        Other edges might lead to the already visited vertices of $G$, namely the ones residing in the graph $G_{n-1}$.
        Such edges we will address as the \emph{back} edges of $L_{n-1}$ and denote them by $\eback_n$,
        \[
          \eback_n = \Big\{e = (us) \mid u \in L_{n-1} \text{ and } s \in G_{n-1}\Big\}.
        \]
        \begin{remark}
          Note that \emph{back} edge could never lead to the root vertex since that
            would yield an existence of a positive flow cycle for the flow $\flowpos$.
        \end{remark}
        Finally, we set $G_n$ and $L_n$.
        \begin{align*}
          &L_n = \ter(\efor_n),\\
          &G_n = (V_{n-1} \cup L_n, E_{n-1} \cup \eback_n \cup \efor_n).
        \end{align*}

      \medskip
      \subsection{\texorpdfstring{$n$}{n}-th step: setting \texorpdfstring{$\flowposn{n}$}{Fn}}
        Here we want to go from the flow $\flowposn{n-1}$ to $\flowposn{n}$.
        Consider the function $\cal{G}: E_n \to \mathbb{R}^{+}$.
        \begin{align*}
          &\cal{G}(e) = \flowposn{n-1}, \quad e \in E_{n-1},\\
          &\cal{G}(e) = 0, \quad e \in E_n \setminus E_{n-1}.
        \end{align*}
        We divide the $n$-th step in two parts.
        It is our plan to extend $\cal{G}$ further onto $E_n$ (part one) and then change it gradually in order
          to satisfy all the properties~\ref{p1}--~\ref{p5} (part two).
        Then we will set $\flowposn{n}$ to $\cal{G}$.

        Notice that all the vertices except the root and the last layer $L_{n-1}$ are $\cal{G}$-preserving.
        The root is $\cal{G}$-deficient and the $(n-1)$-th layer is currently $\cal{G}$-active.
        We first change the flow in the vertices $L_{n-1}$ in order to make them preserve the flow $\cal{G}$.
        For this purpose, we propagate the flow $\cal{G}$, incoming to the $(n-1)$-th layer, one edge further.

        Namely, consider the vertex $u \in L_{n-1}$.
        By~\ref{p2} we have $d_{\cal{G}}^{-}(u) \leq d_{\flowpos}^{-}(u) = d_{\flowpos}^{+}(u)$,
          so we are able to set the flow $\cal{G}$ on the outgoing edges of $u$ in the following way:
        \begin{enumerate}[label=\textbf{(\roman*)}]
          \item\label{posprop} each outgoing edge has a positive flow: $\cal{G}(e) > 0$ for any $e \in \eout(u)$;
          \item $\cal{G}$ is still bounded from above: $\cal{G}(e) \leq \flowpos(e)$ for any $e \in \eout(u)$;
          \item the vertex $u \in L_{n-1}$ becomes $\cal{G}$-preserving.
        \end{enumerate}
        \begin{remark}
          Literally, here we are pushing the flow out of the vertex $u \in L_{n-1}$ and spreading it among all the outgoing edges
            $\eout_{G_n}(u) = \eout_G(u)$.
          Since $\cal{G}$ is bounded above by the flow $\flowpos$, which is preserved at each vertex of the graph $G$,
            particularly, at the vertex $u$, it is trivial that such an expansion exists.
        \end{remark}
        If we had no back edges, the function $\cal{G}$ would be the next function $\flowposn{n}$, and this step would be accomplished,
          since all the properties~\ref{p1}--\ref{p5} would be complied by $\cal{G}$.
        However, the flow pushed from the $(n-1)$-th layer across the back edges made some of the vertices in $G_{n-1}$ \emph{not} flow-preserving.
        Namely, the end vertices of such edges $\eback_{n}$ now became $\cal{G}$-active, since for such vertices
          the total incoming flow now exceeds the total outgoing flow.
        %\alex{a figure of a back edge making some inner vertex non-preserving, unite with the figure of n-th layer?}
        Finally, we have reached the step number two of the $\flowposn{n}$ construction.
        We are going to carry out the \emph{relaxation} procedure in order to alleviate the flow excess in those $\cal{G}$-active vertices.

          %Denote $\gnpaths(\makebox[1ex]{$\cdot$}, \makebox[1ex]{$\cdot$}) = \cal{P}_{G_n}(\makebox[1ex]{$\cdot$},\makebox[1ex]{$\cdot$})$.
        For simplicity of notation we continue to write $\gnpaths$ instead of $\cal{P}_{G_n}$.
        Consider a $\cal{G}$-active vertex $s \in \ter(\eback_n)$ such that $d_{\cal{G}}^{-}(s) > d_{\cal{G}}^{+}(s)$.
        \begin{definition}
          A path $p \in \gnpaths(s, L_n)$ is referred as a \emph{$\cal{G}$-augmenting} path for the vertex $s$
            if $\delta_{max}=\min\limits_{e \in p}(\flowpos(e) - \cal{G}(e)) > 0$.
        \end{definition}
        The latter means that $\cal{G}$ can be increased along this path by some constant $\delta \leq \delta_{max}$
          in such a fashion that $\cal{G}(e)$ does not exceed the flow $\flowpos(e)$ for each $e \in p$.
        Obviously, for a $\cal{G}$-augmenting path $p$ one has $\cal{G}(e) < \flowpos(e)$ for each $e \in p$.
%            $\delta \leq d_{\cal{G}}^{-}(s) - d_{\cal{G}}^{+}(s) = -d_{\cal{G}}(s)$.
        \begin{definition}
          The edge $e$ is called a \emph{$\cal{G}$-saturated} edge if $\cal{G}(e) = \flowpos(e)$.
          The path $p$ is called \emph{$\cal{G}$-saturated} if there exists such an edge $e \in p$ that $e$ is $\cal{G}$-saturated.
        \end{definition}
        For each path $p \in \gnpaths(s, L_n)$ we are going to raise the function $\cal{G}$ at every edge of the path $p$
        by some $\delta > 0$.
        We call the described procedure \emph{relaxation} of the vertex $s$.
        Strictly speaking, the {relaxation}
          of the vertex $s$ is a reduction of the excess of the flow $\cal{G}$ in the vertex $s$.
        Our purpose is to relax the vertex $s$, transforming it into a $\cal{G}$-preserving vertex.

        On one hand, if $\delta_{max} \geq -d_{\cal{G}}(s)$, then \emph{pushing} the flow precisely $-d_{\cal{G}}(s)$ along the path $p$
          is enough to make the vertex $s$ preserving $\cal{G}$, where
          \emph{pushing} the flow $C \in \mathbb{R}$ along the path $p$ means raising the flow $\cal{G}$ at each edge $e \in p$:
          $\cal{G}(e) \to \cal{G}(e) + C$.

        On the other hand, if $\delta_{max} < -d_{\cal{G}}(s)$, then pushing the flow $\delta_{max}$ along the path $p$ is not enough
          in order to make the vertex $\cal{G}$-preserving.
        In this case we push the flow $\delta_{max}$ along the path $p$ and look for the other augmenting paths in $\gnpaths(s, L_n)$.
        We will repeat the outlined procedure until we finally relax the vertex $s$.
        \begin{prop}
          Any vertex $s$ will be $\cal{G}$-relaxed in a finite number of steps.
        \end{prop}
        \begin{proof}
          Firstly, we have a finite graph $G_{n}$, and so there are only a finite number
            of paths in $\gnpaths(s, L_n)$.
          Secondly, each time we push the flow along the augmenting path $p$ either we successfully relax the vertex $s$
            or we saturate at least one edge lying on the chosen path $p$.
          Since the number of the edges is finite, the procedure halts after a finite number of steps.

          Thus, it happened that there are no augmenting paths in $\gnpaths(s, L_n)$.
          Examine the set of vertices $S \subseteq G_n$ that are reachable by non-saturated paths from the vertex $s$.
          We have $S \cap L_n = \emptyset$, hence $S \subseteq G_{n-1}$.
          Now consider the subgraph
            \[
              U = \bigcup\big\{p \in \gnpaths(s, S) \mid \text{$p$ is not $\cal{G}$-saturated}\big\}.
            \]
          Similarly, the subgraph $U$ does not contain any vertices from $L_n$.

          We will show that any edge $e \in \eout_G(U)$ is saturated.
          Due to the absence of the positive flow cycles, the root vertex is not in $U$.
          Since for each non-root vertex in $G_{n-1}$ we included every outgoing edge into $G_n$,
            the edge $e$ belongs to $G_n$.
          If $e$ is not saturated, then its ending vertex $\ter(e)$ lies in $S$.
          Therefore, the edge $e$ belongs to $U$.
          We arrived to a contradiction, so the edge $e$ is saturated.

          For a vertex $u \in S$ we see that $d_{\cal{G}}(u) = d^{+}_{\cal{G}}(u) - d^{-}_{\cal{G}}(u) \leq 0$,
            because the only $\cal{G}$-deficient vertex in the graph $G_n$ is the root vertex $\root$, which is not in $U$.
          Also for the vertex $s$ itself we have a strict inequality $d_{\cal{G}}(s) < 0$ since it is not relaxed by our assumption.
          It is clear now that the quantity $D = \sum_{u \in U} d_{\cal{G}}(u)$ is strictly less than zero.
          On the other hand,
          \[
            \begin{split}
              D &= \mathlarger\sum_{u \in U} \Big(d^{+}_{\cal{G}}(u) - d^{-}_{\cal{G}}(u)\Big)
              = \mathlarger{\smashoperator{\sum_{\eout_{G_n}(U)}}} \cal{G}(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \cal{G}(e)  \\
              &= \mathlarger{\smashoperator{\sum_{\eout_{G}(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \cal{G}(e)
                \overset{\ref{p2}}{\geq} \mathlarger{\smashoperator{\sum_{\eout_G(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \flowpos(e) \\
                &\overset{G_n \subset G} \geq \mathlarger{\smashoperator{\sum_{\eout_G(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G}(U)}}} \flowpos(e) = 0.
            \end{split}
          \]
          Thus we deduce that $0 > D \geq 0$, and that is a contradiction.
        \end{proof}
        It follows that we can relax all the vertices in $\eback_n$.
        Conclusively, we set the function $\flowposn{n}$ equal to $\cal{G}$ that we got after the relaxations.
        \begin{prop}
          The properties~\ref{p1}--\ref{p5} are satisfied for the resulting $\flowposn{n}$ on the network $\net_n = (G_n, \len, \root)$.
        \end{prop}
        \begin{proof}
          The monotonicity property~\ref{p1} is true since during the relaxation step we
            only increased the flow on the edges of the graph $G_n$.

          The boundedness property~\ref{p2} is also true since we chose the flow values in such a way
            that the bound $\flowposn{n}(e) \leq \flowpos(e)$ holds for each edge $e\in G_n$.

          The root vertex was not affected during the step $n > 1$, so~\ref{p3} holds.

          The flow $\cal{G}$ was redesigned in such a fashion that each non-root vertex $v$ in $G_{n} \setminus 
            \left(L_n \cup \{\root\}\right)$ became $\cal{G}$-preserving.
          This checks the property~\ref{p4}.

          Finally, due to the property~\ref{posprop} and the fact that
          any vertex in $L_n$ has only incoming edges in the graph $G_n$, the property~\ref{p5} holds.
        \end{proof}
        The flow construction is completed.

        \medskip
        \subsection{Estimates on the constructed \texorpdfstring{$\flowposn{n}$}{Fn}}
          For abbreviation, let $\phi_n$ stand for the distance function $\phi_n(v) = \phi_{G_n}(v)$
            from Definition~\ref{def-dist-fun}.
          Likewise, we define the functions $d_n$, $d^{-}_n$, $d^{+}_n$.
          \begin{lemma}
            For each $G_n$, $n > 1$,
            \begin{equation}
              \label{main-ineq}
              \sum_{v\in L_n}d_{n}^{-}(v) \phi_n(v) \leq \sum_{e \in E_n} \len(e) \flowpos(e).
            \end{equation}
          \end{lemma}
          \begin{proof}
            Set
            \[
              LS = \sum_{v \in L_n} d_n^{-}(v) \phi_n(v) =
                  -\sum_{v \in L_n} d_n(v) \phi_n(v) =
                  -\sum_{v \in V_n} d_n(v) \phi_n(v).
            \]
            In the first equality we used the fact that $d_n^{-}(v) = d_n(v)$ for $v \in L_n$ and
              the last equality holds since $\phi_n(\root) = 0$ and $d_n(v) = 0$
              for any $v \in V_{n} \setminus \left(L_n \cup \{\root\}\right)$,

            Next we regroup the summation in order to have a sum over the edges of $G_n$, not vertices.
            Recall that $d_n^{+}(v) = 0$ for each vertex $v \in L_n$,
              hence $d_n(v) = -d_n^{-}(v)$ whenever $v$ is in the $n$-th layer.
            \begin{align*}
              LS = \sum_{v \in V_n} d_n^{-}(v) \phi_n(v) = -\sum\limits_{v \in V_n} d_n(v) \phi_n(v)\\
              =-\sum_{v \in V_n} \left(\sum_{\eout(v)} \flowposn{n}(e) - \sum_{\ein(v)}\flowposn{n}(e) \right) \phi_n(v)\\
              =\sum_{(vu) \in E_n} \flowposn{n}(vu) \big(\phi_n(u) - \phi_n(v)\big).
            \end{align*}
            For any $(vu) \in E_n$ we have $\phi_n(u) \leq \phi_n(v) + \len(vu).$
            Therefore,
            \[
              LS\leq\sum_{(vu) \in E_n} \flowposn{n}(vu) \len(vu)= \sum_{e \in E_n} \flowposn{n}(e) \len(e) \overset{\ref{p2}}{\leq} \sum_{e \in E_n} \flowpos(e) \len(e).
            \]
            Inequality~\eqref{main-ineq} is proved.
          \end{proof}

          In what follows we prove that there is a vertex in any layer such that its root-distance is bounded by the mass of the flow.
          \begin{prop}
            \label{prop36}
            For each $n > 0$ there exists a vertex $r_n \in L_n$ such that $\phi_n(r_n) \leq \lvert\flowpos\rvert$.
          \end{prop}
          \begin{proof}
            We continue to write $LS$ for the left hand side of the inequality~\eqref{main-ineq}.
            Then
            \[
              LS = \sum_{v \in L_n}d^{-}_n(v) \phi_n(v) \geq \min_{v \in L_n}\phi_n(v) \sum_{v \in L_n} d^{-}_n(v).
            \]
            Since $\sum_{v \in L_n} d^{-}_n(v)$ is the total amount of the flow incoming to the deepest layer $L_n$, and the only
              non-preserving vertex in $G_n$ is the root, which produces the flow with size equal to $1$, we have $\sum_{v \in L_n} d^{-}_n(v) = d^{+}_n(\root) = 1.$
            Consequently, $LS \geq \min\limits_{v \in L_n} \phi_n(v).$

            Furthermore, combining the latter with~\eqref{main-ineq}, one gets
              \[
              \min_{L_n} \phi_n(v) \leq \sum_{e \in E_n} \len(e) \flowpos(e) \leq \lvert\flowpos\rvert.
              \]
            Since $L_n$ contains a finite number of vertices, there exists a vertex $r_n \in L_n$ such that
              $\phi_n(r_n) \leq \lvert\flowpos\rvert.$
          \end{proof}
          \begin{prop}
            There exists a ray $r=(r_1 r_2\dots)$ in the network $\net$ such that $\sum\limits_{n=1}^\infty \len(r_n r_{n+1}) < \infty$.
          \end{prop}
          \begin{proof}
            We will look for the ray $r$ in the graph $\gstar = \bigcup G_n.$
            We abbreviate $\phi_{\gstar}(v)$ to $\phistar$.
            Consider a path $p$, starting at the root, such that $\phistar(p) \leq \lvert\flowpos\rvert$.
            Denote this set of such paths by $\cal{P}^*$.

            For each $n > 0$ we are going to present a vertex $r_n$ such that there are an infinite number of paths
              in $\cal{P}^*$ starting with $(r_1 r_2 \dots r_n)$.

            At the first step we set $r_1 = \root$.
            By proposition~\ref{prop36}, for each layer $L_n$ there is a vertex $v_n \in L_n$ such that
              $\phi_n(v_n) \leq \lvert\flowpos\rvert$.
            Since $\phistar(v_n) \leq \phi_n(v_n)$, and there are an infinite number of layers,
              $\cal{P}^*$ contains an infinite number of paths.

            Now assume we have already constructed the path $p_n = (r_1 r_2\dots r_n)$ such that
              there are an infinite number of paths in $\cal{P}^*$ starting with the path $p_n$.
            The graph $\gstar$ is locally finite and in particular the degree of $r_n$ is finite.
            Since the number of the paths from $\cal{P}^*$ starting with $p_n$ is infinite by the assumption,
              we are able to choose $r_{n+1} \in \eout_{G^*}(r_n)$ such that the number of paths in $\cal{P}^*$ starting from the path $p_{n+1}= (p_n r_{n + 1})$ is infinite as well.

            We constructed the ray $r = (r_1 r_2 \dots) \subseteq \gstar$.
            The total length of the ray $\sum \len(r_n r_{n+1})$ is finite
              since the partial sums are bounded by $\lvert \flowpos \rvert$.
          \end{proof}
          We found a finite-length ray in the network $\net$.
          Hence, the implication is proved as well as Theorem~\ref{ray-thm} itself.

      \medskip
      \subsection{Main theorem}
        Now we present the proof of Theorem~\ref{thm-main} using Theorems~\ref{thm-graph-eq} and~\ref{ray-thm}.
        \begin{proof}[Proof of Theorem~\ref{thm-main}]
          The system $\fsys$ belongs to B-class, so we can apply Theorem~\ref{thm-graph-eq}, which asserts
            that $\fsys$ admits rank one density property if and only if
            the corresponding network $\net(\fsys)$ is $\flow$-preserving for any
            finite-mass flow $\flow$.
          We rephrase the last conclusion in terms of \emph{oriented} networks.
          The system $\fsys$ admits rank one density property if and only if
            the oriented network $\net(\fsys)$ is $\flowpos$-preserving for any
            finite-mass flow $\flowpos$.
          After that we utilize Theorem~\ref{ray-thm}, which states that there exists such
            flow $\flowpos: E \to \mathbb{R}^{+}$ with a finite mass that is not preserved in
            the network $\net(\fsys)$, if and only if there exists a ray $r^{*} \subseteq \net$, originating in the vertex $\source$,
            whose total length is finite $\sum_{n=1}^\infty \len(r^{*}_n r^{*}_{n+1}) < \infty$.
          Combining these two statements we get that $\fsys$ is \emph{not} rank one dense if and only if
            there is a finite-length ray $r^*$ in the network $\net(\fsys)$.
          It is obvious that $r^*$ cannot include infinite number of the edges incident to the vertices
            $\source$ and $\sink$, since such edges have the length exactly one.
          Therefore, such $r^*$ exists in $\net(\fsys)$ if and only if there is a ray $r=\seq{r}$ in the original bipartite graph $B(\fsys)$ such that
            the series $\sum_{n=1}^\infty\lvert\len(r_n r_{n+1})\rvert$ converges.
          The theorem is proved.
        \end{proof}
        %\begin{figure}
          %\begin{center}
          %\begin{tikzpicture}[thick,
                              %every node/.style={draw,circle},
                              %%every fit/.style={ellipse,draw,inner sep=-1pt,text width=2cm},
                              %]
            %%\draw[help lines,step=9mm,gray!70] (0,-6) grid (6,0);
            %\node[fill=gray,draw, xshift=-3cm, yshift=-3.5cm] (source) {$s$};
            %\begin{scope}[start chain=going below,node distance=7mm]
              %\foreach \i in {1,3,5,7}
              %\node[lnode,on chain] (l\i) [] {$e_{\i}$};
              %\node[draw=none,on chain, yshift=7mm]{$\vdots$};
            %\end{scope}
            %\begin{scope}[xshift=3cm,yshift=-0.5cm,start chain=going below,node distance=7mm]
              %\foreach \i in {2,4,6,8}
              %\node[rnode,on chain] (r\i) [] {$e_\i$};
              %\node[draw=none,on chain, yshift=7mm]{$\vdots$};
            %\end{scope}
            %\node[xshift=6cm,yshift=-3.5cm,draw] (sink) {$t$};

            %% the set U
            %%\node [fit=(l1) (l5),label=above:\emph{left}] {};
            %% the set V
            %%\node [fit=(r6) (r9),label=above:\emph{right}] {};

            %% the edges
            %\foreach [evaluate={\k=int(\i*2 + 1)}] \i in {0,...,3}
            %\draw(source)--(l\k);
            %\foreach [evaluate={\k=int(\i*2 + 2)}] \i in {0,...,3}
            %\draw(sink)--(r\k);
            %\draw (l1) -- (r2);
            %\draw (r2) -- (l3);
            %\draw (l3) -- (r4);
            %\draw (r4) -- (l5);
            %\draw (l5) -- (r6);
            %\draw (r6) -- (l7);
            %\draw (l7) -- (r8);
          %\end{tikzpicture}
          %\caption{The network $\net$ built for the LW-system $\fsys_{LW}$} \label{LW-net}
          %\end{center}
        %\end{figure}

    \bigskip
    \section{The \texorpdfstring{$k$}{k} point density property for B-class}
      \label{sec:kpd}
      In this section we investigate the connection between $k$ point density property and
        rank one density property in the context of B-class systems.

      We are going to use the idea from~\cite{me} to get a reformulation for $k$ point density property.
      \begin{prop}
        \label{prop-vec-est}
        The system $\fsys$ is not $k$ point dense if and only if there exist vector sequences
          $\{u_n\}_{n=1}^\infty$ and $\{v_n\}_{n=1}^\infty$ in $\ell^2 (\mathbb{R}^k)$ such that
        \begin{align*}
          &\sum_{n=1}^\infty \inner{u_n}{v_n}_{\mathbb{R}^k} \neq 0,\\
          &\inner{u_l}{v_l + \sum_{r \in B_R} f_{lr} v_r}_{\mathbb{R}^k} = 0 \quad \text{for any $l \in B_L$},\\
          &\inner{v_r}{u_r + \sum_{l \in B_L} f_{rl}^* u_l}_{\mathbb{R}^k} = 0 \quad \text{for any $r \in B_R$},
        \end{align*}
        where $B_L$ and $B_R$ denote the set of indices corresponding to the left and right parts of the graph $B(\fsys)$ respectively.
      \end{prop}
      \begin{proof}
        The system $\fsys$ is not $k$ point dense if and only if there exists a $k$-rank operator $T = \sum_{s=1}^k y^s \otimes x^s$, where $x^s, y^s \in \cal{H}$, such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$ and $Tr(T) \neq 0$.

        Consider the following vectors in $\mathbb{R}^k$:
        \begin{align*}
          v_n = (x^1_n, x^2_n, \dots, x^k_n),\qquad
          u_n = (y^1_n, y^2_n, \dots, y^k_n),
        \end{align*}
          where $x^s_n = \inner{x^s}{e_n}$ and $y^s_n = \inner{y^s}{e_n}$.
        Then $T_{nm} = \sum_{s=1}^k  x^s_n y^s_m = \inner{v_n}{u_m}_{\mathbb{R}^k}$ for any $n, m$.
        According to~\eqref{almost-flow-eqn}, the condition $\inner{Tf_n}{f^*_n} = 0$ can be rewritten as
          $\inner{u_l}{v_l + \sum_r f_{lr} v_r} = 0$
        when the index $n=l$ belongs to $B_L$, and
          $\inner{v_r}{u_r - \sum_l f_{lr} u_l} = 0$
        when the index $n=r$ belongs to $B_R$.
        It is also clear that
          $Tr(T) = \sum_{n=1}^\infty \inner{u_n}{v_n}_{\mathbb{R}^k}$. 
      \end{proof}
      If we put $z_r = v_r$, $z_r^*=u_r$, $r \in B_R$, and $z_l = u_l$, $z^*_l=v_l$, and $l \in B_L$, we have the following corollary.
      \begin{corol}
        \label{corol:kpd}
        The system $\fsys$ is not $k$ point dense if and only if each vertex $v$ in the graph $B(\fsys)$ can be
          equipped with two vectors $z_v$, $z_v^*$ in $\mathbb{R}^k$ such that
          \begin{itemize}
            \item $\{z_v\}_{v \in V}, \{z_v^*\}_{v \in V} \in \ell^2(\mathbb{R}^k)$, \\
            \item $\sum\limits_{v\in V} \inner{z_v}{z_v^*}_{\mathbb{R}^k} \neq 0$, \\
            \item $\inner{z_v}{z_v^* + \sum\limits_{v \sim x} z_x \wt_{vx}} = 0$ for any $v \in V$,
          \end{itemize}
          where $v \sim x$ means that there is an edge between the vertices $v$ and $x$, and
          $\wt_{vx}$ is the weight function defined on the edges of $B(\fsys)$ in~\eqref{def-wt}.
      \end{corol}

      Now we prove the main result of this section.
      \begin{proof}[Proof of Theorem~\ref{thm-kpd}]
        Suppose that $\fsys$ is not rank one dense.
        According to Theorem~\ref{thm-main}, there is an infinite ray $\seq{r}$ in the bipartite
          graph $B(\fsys)$ such that the series $\sum\lvert\wt_n\rvert^{-1}$ converges.
        Here and below we write $\wt_n$ for $\wt(r_n, r_{n + 1})$.

        We are going to present vector sequences $\{z_v\}_{v \in V}$, $\{z^*_v\}_{v \in V}$ such that all three conditions in Corollary~\ref{corol:kpd} hold.
        For each vertex $v \not \in \seq{r}$,
          we set the corresponding pair of vectors $z_v$, $z^*_v$ to zero.

        In what follows we will construct the vectors $z_{r_n}$, $z_{r_n}^*$.
        For abbreviation, we continue to write $z_n$ and $z_n^*$ for $z_{r_n}$ and $z_{r_n}^*$ correspondingly.
        We set
        \[
          z_1=(\lvert\wt_1\rvert^{-0.5}, 0, 0, \dots), \qquad z^*_1 = (-\lvert\wt_1\rvert^{0.5}, 0, 0, \dots).
        \]
        For $n > 1$ we set $z^*_n$ to zero.

        We define the values $M_n = \max(\lvert\wt_{n-1}\rvert^{-0.5}, \lvert\wt_n\rvert^{-0.5})$
          for $n > 1$; notice that $M_{n - 1} M_n \geq \lvert\wt_{n - 1}\rvert^{-1}$ for $n > 1$.
        Also we set $M_1 = \lvert\wt_1\rvert^{-0.5}$.

        Let $V_n$ denote the subspace $span\{z_m \mid m < n - 1 \text{ and } r_m \sim r_n\}$.
        For $n \leq 2$ we will assume that $V_n$ is a trivial subspace.
        The vertex $r_n$ has degree at most $2B$ and is connected to the vertices $r_{n-1}$ and $r_{n+1}$.
        It follows that the dimension of $V_n$ is at most $2B - 2$.

        For each $n > 1$ we will choose $z_n$ such that all of $z_n$ satisfy the following conditions:
        \begin{enumerate}[label=\textup{(\alph*)}]
          \item \label{kpd:c1} $M_n \leq \lvert z_n \rvert \leq 4 M_n$,
          \item \label{kpd:c2} for $n > 1$ we have $\wt_{n-1}\inner{z_n}{z_{n - 1}} = 1$,
          \item \label{kpd:c3} $z_n$ is orthogonal to $V_n$,
          \item \label{kpd:c4} for any non-trivial $V_{n + 1}$ the angle between $z_n$ and $V_{n + 1}$
              is at least $\pi/6$.
        \end{enumerate}

        We argue by induction that such sequence $\seq{z}$ exists.
        Remember that $z_1$ is already set, and the conditions~\ref{kpd:c1}--\ref{kpd:c4} hold for $z_1$.
        Now suppose that $z_{n - 1}$ is already chosen.
        We are going to find a vector $z$ which satisfies the conditions~\ref{kpd:c2} and~\ref{kpd:c3}.

        Consider $U_1 = \{z \in \mathbb{R}^{4B-2}\, \big| \, \inner{z}{z_{n-1}}\wt_{n-1} = 1\}$.
        The dimension of the affine subspace $U_1$ is equal to $4B - 3$.
        First consider the case when $V_n$ is trivial. We will choose $z$ as any vector from $U_1$
          and set the length of $z$ to $2 M_n$.

        Now assume that $V_n$ is not trivial.
        Then consider the subspace $U_2 = V_n^\bot$, its dimension is at least $2B$.

        Due to~\ref{kpd:c4}, the angle between $z_{n - 1}$ and $V_n$ is at least $\pi / 6$.
        Then the angle between $z_{n - 1}$ and $U_2$ is at most $\pi / 3$.
        The subspace $U_1 \cap U_2$ is not empty since the angle between $z_{n-1}$ and $U_2$ is not $\pi / 2$.
        Moreover, the dimension of $U_1 \cap U_2$ is at least $2B - 1$.

        Consider a vector $z \in U_1 \cap U_2$.
        We know that the angle between $z$ and $z_{n-1}$ is at most $\pi / 3$,
          so $\lvert \inner{z}{z_{n-1}} \rvert \geq \lvert z \rvert \lvert z_{n-1}\rvert  \cos(\pi / 3)$.
        On the other hand, $\lvert\wt_{n-1}\rvert \lvert \inner{z}{z_{n-1}} \rvert = 1$, which implies
          that $\lvert z\rvert \leq 2 \lvert z_{n-1} \wt_{n-1}\rvert^{-1}$.
        It follows that $\lvert z\rvert \leq 2 \lvert  M_{n-1} \wt_{n-1}\rvert^{-1}
          \leq 2 M_n$, since $M_n M_{n-1} \geq \lvert \wt_{n-1} \rvert^{-1}$.

        Thus, there exists a vector $z \in U_1 \cap U_2$ such that $\lvert z\rvert \leq 2 M_n$.
        By definition it satisfies~\ref{kpd:c2} and~\ref{kpd:c3}.

        Now consider a unit vector $\zeta \in \mathbb{R}^{4B - 2}$
          such that $\zeta$ is orthogonal to the linear subspace $V$ generated by
          $z_{n-1}$, $V_{n}$, $V_{n + 1}$.
        Since the dimension of $V_n$ is at most $2B - 2$,
          the subspace $V$ has dimension at most $1 + (2B - 2) + (2B - 2) = 4B - 3$.
        In $\mathbb{R}^{4B - 2}$ such unit vector $\zeta$ exists.
        If the angle between $\zeta$ and $z$ is more than $\pi/2$ then choose $\zeta = -\zeta$.

        Let the vector $z' \in V$ be the projection of $z$ on the subspace $V$.
        For $z'$ the conditions~\ref{kpd:c2} and~\ref{kpd:c3} still hold as well as the upper bound
          $\lvert z'\rvert \leq \lvert z\rvert \leq 2 M_n$.
        Let us show that the vector $z_n = z' + 2 M_n \zeta$ satisfies all the conditions.
        Notice that $\lvert z_n \rvert \geq 2 M_n \geq M_n$ and $\lvert z_n \rvert \leq 4 M_n$,
          which is exactly~\ref{kpd:c1}.
        The conditions~\ref{kpd:c2} and~\ref{kpd:c3} remain true because $\zeta$ is chosen to be orthogonal to $z_{n - 1}$ and to $V_n$.
        The last condition holds since $\lvert z'\rvert \leq \lvert z \rvert \leq 2 M_n$ and we added the vector $2M_n \zeta$
          where $\zeta \perp z'$.
        The angle between $\lvert z_n\rvert$ and $V_{n+1}$ will be at least $\pi / 4 > \pi / 6$.
        \smallskip

        The constructed sequence $\seq{z}$ belongs to $\ell^2({\mathbb{R}^k})$
          since $\lvert z_n \rvert \leq 4M_n$ and the sequence $\seq{M}$ is square summable.
        Hence, the sequences $\seq{z}$ and $\{z_n^*\}_{n=1}^\infty$ satisfy the first condition of Corollary~\ref{corol:kpd}.

        Recall that $\wt(u, v) = -\wt(v, u)$.
        Due to the condition~\ref{kpd:c3}, the vector $z_n$ is orthogonal to all
          $z_m$ where $\lvert m - n \rvert > 1$ and $r_m \sim r_n$.
        In the case of $n > 1$ we have $z_n^* = 0$, and the third condition of Corollary~\ref{corol:kpd} is equivalent to the equations
        \[
          -\wt_{n - 1} \inner{z_n}{z_{n-1}} + \wt_n \inner{z_n}{z_{n+1}} = 0, \quad n > 1,
        \]
        which are true by~\ref{kpd:c2}.

        In the case of $n = 1$, the third condition of the corollary can be rewritten as
        \[
        \inner{z_1}{z_1^*} + \wt_1 \inner{z_1}{z_2} = -1 + \wt_1 \inner{z_1}{z_2} = 0,
        \]
        which is again true by~\ref{kpd:c2}.

        The second condition of Corollary~\ref{corol:kpd} holds as well, since 
        \[ 
          \sum_{n=1}^\infty \inner{z_n}{z^*_n}_{\mathbb{R}^k} = -1.
        \]

        Finally, Corollary~\ref{corol:kpd} applied to the graph $B(\fsys)$ and the sequences $\seq{z}$ and $\{z_n^*\}_{n=1}^\infty$ implies that the system $\fsys$ is not $4B - 2$ point dense.
      \end{proof}
      \begin{remark*}
        In the graph theory terms it follows that if the maximal degree of $B(\fsys)$ is equal to $d$,
          then $2d - 2$ point density implies rank one density of $\fsys$.
      \end{remark*}
  \bigskip
  \section{Questions}
    First, we are interested whether the estimate $4B - 2$ in Proposition~\eqref{prop-vec-est} can be improved.
    Secondly, we would like to know if Theorem~\ref{thm-main} holds for a larger class of $M$-bases, for instance, whether the condition of
      local finiteness of the graph $B(\fsys)$ or the condition~\ref{c5} could be dropped from the definition of B-class systems.
    Finally, it is of interest whether there is an elementary generalization of our approach to the case of a complex Hilbert space.

  \bigskip
  \section{Acknowledgements}
    The author wishes to express his gratitude to Professor Dmitry Yakubovich for suggesting
      the construction of $M$-bases using the bipartite graphs.
    The author gratefully acknowledges the many helpful suggestions of
      Professor Anton Baranov during the preparation of the paper.
    The author wishes to express his thanks to the referee for numerous corrections and useful comments during
      the peer review process.

\begin {thebibliography}{20}
  \bibitem{argyroslambrou}
    S.~\!Argyros, M.~\!Lambrou and W.E.~\!Longstaff,
    \emph{Atomic Boolean Subspace Lattices and Applications to the Theory of Bases},
    Memoirs. Amer. Math. Soc., No. 445 (1991).

  \bibitem{azoff}
    E.~\!Azoff, H.~\!Shehada,
    \emph{Algebras generated by mutually orthogonal idempotent operators},
    J. Oper. Theory, 29 (1993), 2, 249--267.

  %\bibitem{bbb}
    %A.~\!Baranov, Y.~\!Belov and A.~\!Borichev,
    %\emph{Hereditary completeness for systems of exponentials and reproducing kernels},
    %Adv. Math., 235 (2013), 1, 525--554.

  %\bibitem{bbb1}
    %A.~\!Baranov, Y.~\!Belov and A.~\!Borichev,
    %\emph{Spectral synthesis in de Branges spaces},
    %Geom. Funct. Anal. (GAFA), 25 (2015), 2, 417--452.

  %\bibitem{ad_preprint}
    %A.D.~\!Baranov, D.V.~\!Yakubovich,
    %\emph{Completeness and spectral synthesis of nonselfadjoint one-dimensional
    %perturbations of selfadjoint operators},
    %Advances in Mathematics, 302 (2016), 740--798;

  \bibitem{erdos}
    J.A.~\!Erdos,
    \emph{Operators of finite rank in nest algebras},
    J. London Math. Soc., 43 (1968), 391--397.

  \bibitem{review}
    J.A.~\!Erdos,
    \emph{Basis theory and operator algebras},
    In: A.~\!Katavolos (ed.), Operator Algebras and Application, Kluwer Academic Publishers, 1997, 209--223.

  \bibitem{katavolos}
    A.~\!Katavolos, M.~\!Lambrou and M.~\!Papadakis,
    \emph{On some algebras diagonalized by $M$-bases of $\ell^2$},
    Integr. Equat. Oper. Theory, 17 (1993), 1, 68--94.

  \bibitem{larson}
    D.~\!Larson, W.~\!Wogen,
    \emph{Reflexivity properties of $T\bigoplus0$},
    J. Funct. Anal., 92 (1990), 448--467.

  \bibitem{laurielongstaff}
    C.~\!Laurie, W.~\!Longstaff,
    \emph{A note on rank one operators in reflexive algebras},
    Proc. Amer. Math. Soc., 89 (1983), 293--297.

  \bibitem{longstaff}
    W.E.~\!Longstaff,
    \emph{Operators of rank one in reflexive algebras},
    Canadian J. Math., 27 (1976), 19--23.

  \bibitem{raney}
    G.N.~\!Raney,
    \emph{Completely distributive complete lattices},
    Proc. Amer. Math. Soc. 3 (1952), 677--680.

  \bibitem{me}
    A.~\!Pyshkin
    \emph{On the $k$ point density problem for band-diagonal $M$-bases},
    Operators and Matrices (2020), Vol. 14 Number 2, 455--468.


% \bibitem{nikolski}
    %N.K.~\!Nikol'skii,
    %\emph{Complete extensions of Volterra operators},
    %Izv. Akad. Nauk SSSR Ser. Mat 33(1969), 1349--1355. (Russian)
\end{thebibliography}
\end{document}
