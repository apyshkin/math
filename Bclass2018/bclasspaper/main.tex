\documentclass[12pt,oneside,a4paper]{amsart}
\input{preamble}
%\usepackage{caption}
%\usepackage{tikz}
%\usepackage{tkz-berge}
%\usetikzlibrary{positioning, chains, fit, shapes, calc}
        %\tikzset{lnode/.style={auto, circle, draw,fill=gray!50},
                 %rnode/.style={auto, circle, draw},
                 %mnode/.style={auto, circle, draw, fill=gray!25},
                 %wnode/.style={sloped,above}}
\raggedbottom


\begin{document}
\title{The rank one density for a class of $M$-bases}
\author{Alexey Pyshkin}
\address{Chebyshev Laboratory, Saint Petersburg State University, 14th Line V.O. 29, Saint Petersburg 199178, Russia}
\address{Saint Petersburg Department of RAS, Steklov Math. Institute, Fontanka 27, Saint Petersburg 191023, Russia}
\address{Euler International Mathematical Institute, nab.\,Pesochnaya 10, Saint Petersburg 197022, Russia}

\subjclass{Primary 46A35}

\begin{abstract}
  In 1990s several papers studied a strong tridiagonal $M$-basis
    that did not possess the rank one density property.
  We offer a new method for the study of more generic finite-band $M$-bases,
    employing a graph theory framework.
  We determine the necessary and sufficient conditions for the rank one density property
    in this class of $M$-bases.
  Also we give some sufficient conditions concerning the $k$ point density property.
\end{abstract}
\keywords{$M$-basis, rank one density, $k$ point density, hereditary completeness}
\email{aapyshkin@gmail.com}
\thanks{Theorems~\ref{thm-main},~\ref{thm-graph-eq} and~\ref{ray-thm} were obtained within the framework of
          the grant of the Government of the Russian Federation, agreement 08.11.2019 no.\,075-15-2019-1620.\\
        Theorem~\ref{thm-kpd} was obtained within the Russian Science Foundation grant no.\,20-61-46016.
       % The research was also supported by «Native towns», a social investment program of PJSC «Gazprom Neft».
        }
\maketitle
\section{Introduction}
  Consider a complete minimal vector system $\fsys = \seq{f}$ in an infinite-dimensional Hilbert space $\cal{H}$.
  The sequence is called \emph{minimal} if none of its elements can be approximated by the linear combinations of the others.
  The system $\fsys$ is complete and minimal if and only if it possesses a unique biorthogonal system $\fstarsys=\left\{f_n^*\right\}_{n=1}^\infty$.
  We say that $\fsys$ is an $M$-basis if $\fstarsys$ is complete as well.

  With any minimal system $\fsys$ we associate a subalgebra $\cal{A}$ of $B(\cal{H})$,
  \[
    \cal{A} = \{T\in B(\cal{H}): Tf_n = \lambda_n f_n, \text{ for some } \lambda_n \in \mathbb{R}, n \geq 0\},
  \]
    while $R_1(\cal{A})$ will stand for the algebra generated by rank one operators of $\cal{A}$.
  We denote by $\lattice$ the lattice of invariant subspaces for operators in $\cal{A}$.
  

  In this paper we will need the following definitions.
  \begin{definition}[one point density property]
    \label{1pd}
    We say that the algebra $R_1(\cal{A})$ is \emph{one point dense} in the algebra $\cal{A}$ if for any $x \in \cal{H}$ and $\varepsilon > 0$
      there exists such $T\in \cal{A}$ that $||Tx - x|| < \varepsilon$.
  \end{definition}

  %\begin{remark}
    The definition is equivalent to $\fsys$ being a strong $M$-basis (see~\cite{katavolos}):
    the system $\fsys$ is called a strong $M$-basis if for any $x\in\cal{H}$ we have $x \in \overline{span}\big(\inner{x}{f^*_s}f_s\big)$, where
      $\overline{span}$ denotes the closed linear span.
  %\end{remark}

  The next definition is a generalization of the previous one.
  \begin{definition}[$k$ point density property]
    \label{kpd}
    We say that the algebra $R_1(\cal{A})$ is \emph{$k$ point dense} in $\cal{A}$ (or that the algebra $\cal{A}$ has
      \emph{$k$ point density property}) if for any $x_1, x_2, \dots, x_k \in \cal{H}$ and $\varepsilon > 0$
      there exists such $T\in \cal{A}$ that $||Tx_s - x_s|| < \varepsilon$ for any $1 \leq s \leq k$.
  \end{definition}

  \begin{definition}[rank one density property]
    \label{r1d}
    We say that the algebra $\cal{A}$ has \emph{the rank one density property} (or that the algebra $R_1(\cal{A})$
      is rank one dense in $\cal{A}$) if
      %the unit ball of the rank one subalgebra $R_1(\cal{A})$ is dense in the unit ball of $\cal{A}$ in the strong operator topology.
      $R_1(\cal{A})$ is dense in $\cal{A}$ in the ultraweak (or $\sigma$-weak) topology.
  \end{definition}
  We will say that the system $\fsys$ is \emph{rank one dense} (\emph{$k$ point dense})
    when the rank one density (the $k$ point density) holds for the algebra $\cal{A}$.

  %It is well known that the last definition~\ref{r1d} is equivalent to $R_1(\cal{A})$ being dense
    %in $\cal{A}$ in the ultraweak (or $\sigma$-weak) topology.
  %The rank one density property can be considered as a generalization of the notion of \emph{linear summation method}
    %for the system $\fsys$.
  %We say that the system $\fsys$ admits a linear summation method
    %if there exist $\alpha_{sn} \in \mathbb{C}, n \in \mathbb{N}, 0 < s < s_n$
    %such that for any $x \in \cal{H}$,
    %\[
      %\lim_{n \to \infty} \sum_s \alpha_{sn} \inner{x}{f^*_s}f_s = x.
    %\]
  %Clearly, the existence of the linear summation method implies the rank one density property.

  Notice that the rank one density property~\eqref{r1d} implies the $k$ point density property~\eqref{kpd} for any $k > 0$.
  On the other hand the two point density property ($k$ = 2) implies the one point density property~\eqref{1pd}.
  But is it true that $\eqref{1pd}$ implies $\eqref{r1d}$?
  Is it true that~\eqref{kpd} for some $k > 1$ implies~\eqref{r1d}?

  It happens that the first question had been investigated for quite a long time, before it was settled.
  Long\-staff in~\cite{longstaff} studied the abstract subspace lattices and the corresponding operator algebras.
  Particularly, Longstaff proved that the rank one density property implies
    the complete distributivity of its lattice (see Raney~\cite{raney} for a definition).
  It is now a well-known fact that for a subspace lattice generated from an $M$-basis
    the complete distributivity of its lattice is equivalent to
    the property~\eqref{1pd} (see~\cite{argyroslambrou} for a proof).
  In the same paper the following question was raised: does the complete distributivity of $\lattice$ imply the rank one density property?
  The answer had been already known to be positive in the case of a totally ordered lattice~\cite{erdos}, and
    Longstaff had proved it for a finite-dimensional Hilbert space in~\cite{longstaff}.
  Later Laurie and Longstaff discovered that the rank one density holds in the case of commutative subspace lattices~\cite{laurielongstaff}.

  However, the solution for the general case remained unknown until Larson and Wogen showed that the answer is negative (see~\cite{larson}).
  They constructed an example of a vector system $\fsys$ such that the lattice $\lattice$ generated from $\fsys$
    was completely distributive, but the corresponding algebra $\cal{A}$
    did not possess the rank one density property.
  This system was also discussed by Argyros, Lambrou and Longstaff in the Addendum to~\cite{argyroslambrou}.
  We will refer to this particular example as to the Larson--Wogen vector system in this paper.
  \begin{example}[Larson--Wogen system $\fsys_{LW}$]
    \label{lw-sys}
    Fix an orthonormal basis $\{e_n\}_{n=1}^\infty$ in $\cal{H}$. For any $j > 0$ we define
    \begin{align*}
      &f_{2j-1}=-a_{2j-2}e_{2j-2} + e_{2j-1} + a_{2j-1}e_{2j}, \qquad &f_{2j}=e_{2j},\\
      &f^*_{2j}=-a_{2j-1}e_{2j-1}+e_{2j}+a_{2j}e_{2j+1}, \qquad &f^*_{2j-1}=e_{2j-1},
    \end{align*}
    where $a_0 = 0$ and for $k > 0$ the parameters $a_k$ are real and nonzero.\\
    For $a_{2k-1}= a_{2k} = 2^k$ the system $\fsys_{LW}$ is a one point dense and not two point dense.
  \end{example}
  The given construction was remarkably simple and elementary, and appeared in several papers afterwards.
  This example was studied by Azoff and Shehada in~\cite{azoff}, regarding the reflexivity of $\lattice$, and also in~\cite{me}.
  In 1993 Katavolos, Lambrou and Papadakis in~\cite{katavolos} performed a deeper analysis of the density properties
    of this vector system and deduced that this system is two point dense if and only if it is rank one dense.

  Example~\ref{lw-sys} showed that the one point density does not imply the rank one density and
    in~\cite{larson} Larson and Wogen asked for some generic conditions on the $M$-basis
    for this to hold.
  It seems that not much progress has been made in this direction since then.
  The aim of this paper is to suggest a more generic approach to the rank one density property
    for an arbitrary $M$-basis.
  We are going to study the aforementioned density properties for a class of vector systems that represents a natural generalization of the Larson--Wogen vector system.
  Our construction allows us to reformulate the rank one density problem in terms of flows in infinite networks.

  In the next section we establish the notation and state the main theorem.
  In Section~\ref{sec:char} we work with the infinite networks and prove the main theorem.
  In Section~\ref{sec:kpd} we also analyze the $k$ point density property in the same framework.

  Notice that we will proceed under the assumption that the underlying Hilbert space is real.
  This is important for our procedure and though the complex case can be approached in
    a similar manner, it is not trivial and we will not discuss the complex case further.
\bigskip
\section{From B-class vector systems to B-networks}
    \label{sec:refor}
    \label{fsys2graphs}
    We are interested in the rank one density property of the vector system $\fsys = \seq{f}$
      in a separable real Hilbert space $\cal{H}$.
    Suppose that $\cal{H}$ has an orthonormal basis $\seq{e}$.
    Let $\fstarsys = \{f_n^{*}\}_{n=1}^\infty$ be a biorthogonal system to the original system $\seq{f}$.
    We will use notation $f_{ns}$ for $\inner{f_n}{e_s}$ and similarly $f^*_{ns}$ for $\inner{e_s}{f^*_n}$.
    \begin{definition}
      We say that the vector system $\fsys$ belongs to the \emph{B-class} whenever the following conditions are satisfied:
      \begin{enumerate}[label=\textbf{C\arabic*}]
        \item \label{c1} both $\fsys$ and $\fstarsys$ are complete (or $\fsys$ is an $M$-basis);
        \item \label{c2} either $f_n = e_n$ or $f^*_n = e_n$ for any $n > 0$;
        \item \label{c3} $f_{nn} = f^*_{nn} = 1$ for any $n > 0$;
        \item \label{c4} $f_{ns} = -f^*_{sn}$ for any $n, s > 0, n \neq s$;
        \item \label{c5} the matrices $\{f_{ns}\}$ and $\{f^*_{ns}\}$ are both finite-band,
            meaning that $f_{ns} = f^*_{ns} = 0$, when $\lvert n - s \rvert \leq B$ for some $B \in \mathbb{N}$.
          We will call such smallest $B$ the \emph{band width} of the system $\fsys$.
      \end{enumerate}
    \end{definition}
    \begin{prop}
      The definition given above guarantees the biorthogonality of $f_n$ and $f^*_n$.
    \end{prop}
    \begin{proof}
      Consider the set of indices $N = \left\{n \in \mathbb{N} \mid f_n = e_n \right\}$.
      The property~\ref{c4} yields that $f_{ns}$ is equal to zero whenever $s$ is not in $N \cup {n}$:
      \[
        \inner{f_n}{e_s} = -\inner{e_n}{f^*_s} = -\inner{e_n}{e_s} = 0.
      \]
      Similarly, $f^*_m$ is orthogonal to $e_s$ for all $s$ in $N \setminus {m}$.
      We also have
      \[
        \inner{f_n}{f^*_m} = \sum_{s} f_{ns} f_{ms}^*.
      \]
      It follows from above that each summand on the right side is equal to zero whenever $s \neq n, m$.
      If $n \neq m$, we get
      \[
        \inner{f_n}{f^*_m} = f_{nn} f^*_{mn} + f_{nm} f^*_{mm}
        = f^*_{mn} + f_{nm} = 0.
      \]
      Otherwise, if $n = m$, we get $\inner{f_n}{f^*_m} = 1$ due to the conditions~\ref{c2} and~\ref{c3}.
    \end{proof}
    The B-class vector systems is the main subject of this section.
    It is a natural extension of the Larson--Wogen system (see Example~\ref{lw-sys}).

    Furthermore, a B-class vector system $\fsys$ can be associated with a
      locally-finite weighted bipartite graph $B(\fsys) = (V, E, \wt)$, where $\wt$ is a
      nonzero real-valued function on $V\times V$ such that $\wt(v, u) = -\wt(u, v)$.

    For each index $l > 0$ such that $f^*_l = e_l$ we put the vertex $v_l$ in the first part of the bipartite graph.
    We will call this part from now on the \emph{left} part of the graph $B(\fsys)$.
    For any other index $r > 0$ we construct a vertex in the other part of the graph.
    Evidently, for such indices $r > 0$ the condition $f_r = e_r$ holds due to the definition of the B-class vector systems.
    The second part of the graph will be referred as the \emph{right} part of the graph $B(\fsys)$.
    We put an edge between two vertices $v_l$ and $v_r$ from the left and right parts respectively,
      whenever the scalar product $f_{lr}$ is not zero.
    We set the weight function $\wt$ on the edge $(v_l v_r)$ as $\wt_{lr} = f_{lr}$.
    Next we set $\wt_{rl} = -\wt_{lr}$.
    Recall that for such two vertices we have $f_{lr}$ = $-f^*_{rl}$, so $\wt_{rl} = f^*_{rl}$.
    Since the Hilbert space is infinite-dimensional, the graph is infinite as well.
    However, due to the finite-band condition~\ref{c5}, the vertices of the graph are of a finite degree (the degree does not
      exceed $2B - 1$, where $B$ is the band width of $\fsys$).
    %\begin{remark}
      %Note that there might be several vector systems for a single weighted bipartite graph $B$.
    %\end{remark}
    %\begin{remark}
      %Observe that both parts of the constructed bipartite graph contain an infinite number of vertices, because
        %the system $\fsys$ is an $M$-basis.
    %\end{remark}
    %You can see the bipartite graph built from the Larson--Wogen system in the Figure~\ref{lw-bgraph}.

    \medskip
    Below we pose the main theorem.
    \begin{theorem}
      \label{thm-main}
      The B-class system $\fsys$ is rank one dense if and only if
        for any infinite path $\seq{r}$ in the bipartite graph $B(\fsys)$
        the series
        \[
          \sum_{n=1}^\infty\lvert\wt(r_n, r_{n+1})\rvert^{-1}
        \]
        diverges.
    \end{theorem}
    Notice that the bipartite graph $B(\fsys_{LW})$, associated with the Larson--Wogen system~\eqref{lw-sys},
      consists only of a single ray.
    Therefore, we can apply Theorem~\ref{thm-main} to $\fsys_{LW}$, thus reestablishing
      the known fact from the papers~\cite{katavolos},~\cite{larson} and~\cite{argyroslambrou}.
    \begin{corol*}
      The system $\fsys_{LW}$ admits the rank one density property if and only if
        the sequence $\left\{1/a_n\right\}_{n=1}^\infty$ does not belong to $\ell^1$.
    \end{corol*}
    %\begin{figure}
      %\begin{center}
      %\begin{tikzpicture}[thick,
                          %every node/.style={draw},
                          %%every fit/.style={ellipse,draw,inner sep=-1pt,text width=1cm},
                          %]

        %\begin{scope}[start chain=going below,node distance=12mm]
          %\foreach [evaluate={\k=int(\i*2 + 1)}] \i in {0,...,3}
          %\node[lnode,on chain] (l\k) [label=left: $v_{\k}$] {$e_{\k}$};
          %\node[draw=none,on chain, yshift=7mm]{$\vdots$};
        %\end{scope}
        %\begin{scope}[xshift=4cm,yshift=-0.7cm,start chain=going below,node distance=12mm]
          %\foreach [evaluate={\k=int(\i*2 + 2)}] \i in {0,...,3}
          %\node[rnode,on chain] (r\k) [label=right: $v_{\k}$] {$e_\k$};
          %\node[draw=none,on chain, yshift=7mm]{$\vdots$};
        %\end{scope}

        %% the set U
        %%\node [fit=(l1) (l5),label=above:\emph{left}] {};
        %% the set V
        %%\node [fit=(r6) (r9),label=above:\emph{right}] {};

        %% the edges
        %\begin{scope}[wnode]
          %\foreach [evaluate={\l=int(\i*2 + 1);\r=int(\i*2 + 2)}] \i in {0,...,3}
          %\draw (l\l) to node[draw=none, color=black] {\footnotesize $\mathrm{w}_{\l\r}=a_{\r}$} (r\r);
          %\foreach [evaluate={\l=int(\i*2 + 3);\r=int(\i*2 + 2)}] \i in {0,...,2}
          %\draw (l\l) to node[draw=none,color=black] {\footnotesize $\mathrm{w}_{\r\l}=a_{\l}$} (r\r);
        %\end{scope}
      %\end{tikzpicture}
      %\caption{The bipartite graph $B(\fsys_{LW})$ } \label{lw-bgraph}
      %\end{center}
    %\end{figure}

    \medskip
    \subsection{The rank one density property for B-class}
      Suppose we have a B-class vector system $\fsys=\seq{f}$.
      %Our purpose is to analyze the two point density property of $\fsys$.
      %Before we pursue that, we need to investigate the conditions under which the B-class system is rank one dense.
      We intend to demonstrate a reformulation of the rank one density problem for
        the B-class vector systems in terms of infinite networks.

      Recall that the system $\seq{f}$ is rank one dense
        if and only if there is no trace class operator $T: \cal{H} \to \cal{H}$ with the trace equal to one
        that belongs to the annihilator of the rank one subalgebra $R_1(\cal{A})$: one has $\inner{Tf_n}{f_n^*} = 0$ for any $n$
        (see Theorem 2.2 of~\cite{katavolos} for details).

      Suppose that there is an operator $T$ such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$.
      There are two cases: either $f^*_n = e_n$ or $f_n = e_n$.
      In the first case the condition $\inner{Tf_n}{f_n^*} = 0$ turns into
      \begin{equation}
          \label{left-eqn}
          \sum_j T_{nj} f_{nj} = 0,
      \end{equation}
      and in the second case it is equivalent to
      \begin{equation}
          \label{right-eqn}
          \sum_j T_{jn} f^*_{nj} = 0.
      \end{equation}

      Now consider an auxiliary function $\flowsgn: V \times V \to \mathbb{R}$ defined as follows
      \begin{align*}
        &\flowsgn(v_l, v_r) = T_{lr} f_{lr} = T_{lr} \wt_{lr},\\
        &\flowsgn(v_r, v_l) = T_{lr} f^*_{rl} = T_{lr} \wt_{rl}.
      \end{align*}
      Observe that $\flowsgn$ is a skew-symmetric function.
      Moreover, two equalities~\eqref{left-eqn} and~\eqref{right-eqn} correspond to the \emph{left} and \emph{right}
        parts of the bipartite graph $B(\fsys)$ respectively.
      It follows that the condition $\inner{Tf_n}{f_n^*} = 0$ could be reduced to a simpler one:
      \begin{equation}
        \label{almost-flow-eqn}
        \sum_{u \in V} \flowsgn(v, u) + T_{vv} = 0
      \end{equation}
        for each vertex $v$ in the graph $B(\fsys)$.
      \begin{remark}
        Observe that the function $\flowsgn$ defined on the graph $B(\fsys)$ resembles
          a \emph{flow} defined on the edges of the graph $B(\fsys)$.
        One might also see that the equation~\eqref{almost-flow-eqn} describes the total flow (sum of the outgoing flows and incoming flows) 
          for each vertex $v$ in the graph $B(\fsys)$.
        In order to formalize this observation we are going to build a flow
          after a few changes are made to the graph $B(\fsys)$.
      \end{remark}

    \medskip
    \subsection{Flows and networks preliminaries}

      Before we proceed we are going to introduce a few basic definitions.
      \begin{definition}
        \emph{Network} $\net$ is a quadruple $(G, \len, \source, \sink)$, where $G = (V, E)$ is a weighted graph
        with a positive length function $\len$ on $E$ and two vertices $\source, \sink \in V$, which
        we will call \emph{source} and \emph{sink} of the network respectively.
      \end{definition}
      By graph here we always mean a graph without loops and multiple edges.
      \begin{definition}
        The skew-symmetric function $\flow: V \times V \to \mathbb{R}$ is called a \emph{pseudo-flow}.
      \end{definition}
      \begin{definition}
        Let $G = (V, \vec{E})$ be an oriented graph.
        For each vertex $v \in V$ we take $\ein_G(v)$ as the set of incoming edges
          and $\eout_G(v)$ as the set of outgoing edges in the graph $G$.
        We will omit the graph from the notation whenever it is clear from the context.
        For the set of vertices $V_0$ we denote
        \begin{align*}
          &\ein(V_0) = \big\{(uv)\in E \mid u \in V \setminus V_0, v \in V_0\big\},\\
          &\eout(V_0) = \big\{(vu) \in E \mid u \in V\setminus V_0, v \in V_0\big\}.
        \end{align*}
        For the subgraph $G_0 = (V_0, \vec{E}_0) \subseteq G$ we use the same notation.
        \begin{align*}
          &\ein(G_0) = \big\{(uv)\in \vec{E}_0 \mid u \in V \setminus V_0, v \in V_0\big\},\\
          &\eout(G_0) = \big\{(vu) \in \vec{E}_0 \mid u \in V\setminus V_0, v \in V_0\big\}.
        \end{align*}
        For each edge $e=(uv) \in \vec{E}$ we will write %by $\init(e)$ the starting vertex $u$ and
          $\ter(e)$ for the ending vertex $v$.
        Set $\ter(\vec{E}_0) = \big\{\ter(e) \mid e\in \vec{E}_0\big\}$.
          %&\init(E_0) = \big\{\init(e) \mid e\in E_0\big\},\\
      \end{definition}
      \begin{definition}
        Let $\net = (G, \len, \source, \sink)$ be a network, and $\flow$ be a pseudo-flow.
        Then $d^{+}(v)$ will stand for the sum of the pseudo-flows \emph{leaving} the vertex $v$ and
        $d^{-}(v)$ will stand for the sum of the pseudo-flows \emph{entering} $v$:
        \begin{align*}
          &d^{+}_{\flow}(v) = \sum_{\flow(vu) > 0} \flow(v,u),\\
          &d^{-}_{\flow}(v) = \sum_{\flow(uv) > 0} \flow(u,v).
        \end{align*}
        Let $d_{\flow}(v)$ be equal to $d^{+}_{\flow}(v) - d^{-}_{\flow}(v)$.
        We will refer to this value as a \emph{total flow} of the vertex $v$.
        The vertex $v$ is called \emph{$\flow$-active} if $d(v)$ is less than zero,
          \emph{$\flow$-deficient} if $d(v)$ is greater than zero and
          \emph{$\flow$-preserving} if $d(v)$ is precisely zero, meaning that the total incoming flow
          is equal to the total outgoing flow of the vertex $v$.
      \end{definition}
      \begin{definition}
        \label{flow-dfn}
        Given a network $\net = (V, E, \len, \source, \sink)$ and a pseudo-flow $\flow$ we will call $\flow$ a
          \emph{flow} if for any $v \in V$ the total flow is correctly defined (meaning that the corresponding sum converges absolutely),
          and for any $v \in V \setminus \{\source, \sink\}$ the total flow is zero: $d(v) = 0$.
      \end{definition}
      \begin{definition}
        \label{flow-preserving-dfn}
        For a network $\net = (G, \len, \source, \sink)$ and a flow $\flow$ we will say
          that the network $\net$ \emph{preserves} the flow $\flow$ if the total flows $d(\sink)$, $d(\source)$ are finite
          and $d(\sink) = -d(\source)$.
      \end{definition}
      \begin{remark}
        In simple words this property suggests that the total flow coming out of the source is equal to the total flow
          coming into the sink.
        Note that in the case when the graph $G$ is finite, the network $\net$ always preserves the flow.
        It is the infinite case that is of interest.
      \end{remark}
      \begin{definition}
        \emph{Oriented network} $\onet$ is a quadruple $(\vec{G}, \len, \source, \sink)$, where
          $\vec{G} = (V, \vec{E})$ is an oriented weighted graph with
          a positive length function $\len$ on $\vec{E}$ and two vertices $\source, \sink \in V$, which
          we will call the \emph{source} and the \emph{sink} of the oriented network respectively.
      \end{definition}
      Now we define the flow functions on the oriented networks in the similar manner we defined on the non-oriented networks.
      \begin{align*}
        &d^{+}_{\flowpos}(v) = \sum_{e \in \eout(v)} \flowpos(e),\\
        &d^{-}_{\flowpos}(v) = \sum_{e \in \ein(v)} \flowpos(e),\\
        &d_{\flowpos}(v) = d^{+}_\flowpos(v) - d^{-}_\flowpos(v).
      \end{align*}
      Sometimes we will omit the flow from the notation.
      The definitions~\ref{flow-dfn} and~\ref{flow-preserving-dfn} are the same for the oriented networks.
      \bigskip

      Suppose $\net = (V, E, \len, \source, \sink)$ is a network and $\flow$ is a skew-symmetric function defined
        on $\net$.
      Naturally, we might instead consider an oriented network $\onet = (V, \vec{E}, \len, \source, \sink)$ and a
        positive flow $\flowposplus: \vec{E} \to \mathbb{R}^{+}$, where $V$, $\source$, $\sink$ and $\len$ are the same.
      We assign a direction to the edge $(uv)$ as follows:
        $(uv) \in \vec{E}$ if $\flow(u, v) > 0$, and $(vu) \in \vec{E}$ otherwise.
      This way only one of the edges $(uv)$ and $(vu)$ is present in the graph $\vec{G} = (V, \vec{E})$.
      Also we set the positive flow $\flowposplus: E \to \mathbb{R}^{+}$ so that
        for any edge $(uv) \in \vec{E}$ we have $\flowposplus(u v) = \flow(u,v)$.
      %\begin{definition}
        %The oriented network $\onet$ is called an \emph{orientation} of the network $\net$.
        %For the positive flow $\flowpos$ we will exploit the same term:
          %$\flowpos$ is an \emph{orientation} of the flow $\flow$.
      %\end{definition}
      \begin{remark}
        The flow functions on the networks and the positive flow functions on the oriented networks
          are interchangeable and describe the same object.
        The notion of the direction of the positive flow over the particular edge $(uv)$ of the oriented network
          is incorporated into the sign of the flow on the same edge $(uv)$ of the non-oriented network.
      \end{remark}

    \medskip
    \subsection{B-network construction}
      \begin{definition}
        Consider a network $\net = (G, \len, \source, \sink)$ such that
          the degree of each vertex in $V \setminus \{\source, \sink\} $ is finite,
          and the length of each edge incident to source or to sink is equal to one.
        Also we demand that the vertices $\source$ and $\sink$ are connected by a finite path.
        We will call such network a \emph{B-network}.
      \end{definition}

      In this section we build up a B-network from the graph $B(\fsys)$ and associate a flow $\flow$ on this network with 
        an arbitrary trace class operator $T$ which annihilates the rank one subalgebra $R_1(\cal{A})$.
      We will see later that this association is a bijection.
      Namely, we plan to construct the network $\net(\fsys) = (V, E, \len, \source, \sink)$,
        with the length function $\len: E \to \mathbb{R}^{+}$ and a real skew-symmetric flow $\flow: V \times V \to \mathbb{R}$.
      Firstly, we incorporate all the vertices and edges from the graph $B(\fsys)$ into the network $\net(\fsys)$.
      We set the flow and the length functions on the edge $e = (v_l v_r)$ as follows:
      \begin{align*}
        &\flow(v_l, v_r) = T_{lr} f^*_{rl},\\
        &\flow(v_r, v_l) = T_{lr} f_{lr} = -\flow(v_l, v_r),\\
        &\len(e) = \lvert \wt(v_l, v_r) \rvert^{-1} =  \lvert f_{lr}\rvert^{-1}.
      \end{align*}
      \begin{remark}
        Evidently on this kind of edges the flow $\flow$ agrees with the function $\flowsgn$
          we examined a few paragraphs before.
      \end{remark}

      Now we add two new vertices: the source vertex $\source$ and the sink vertex $\sink$ to the constructed graph.
      For each vertex $v_l$ from the left part of the graph we connect it with the vertex $\source$ with the edge $e_l = (\source v_l)$
        and assign the flow to the newly constructed edge.
      \begin{align*}
        &\flow(v_l, \source) = -\flow(\source, v_l) = T_{ll}.
      \end{align*}
      We set the length equal to one for such edges: $\len(e_l) = 1$.
      As we added the edges $\seq{e}$, the flow became \emph{preserved} at each vertex of the left part of the network $\net(\fsys)$.

      Likewise, for any vertex $v_r$ from the right part of the graph we add a new edge $e_r=(v_r \sink)$
        and set the flow $\flow$ equal to:
      \begin{align*}
        &\flow(v_r, \sink) = -\flow(\sink, v_r) =  T_{rr}.
      \end{align*}
      Again, we have $\len(e_r) = 1$ for any $k$.

      The network $\net(\fsys)$ is obviously a B-network.
      The defined function $\flow$ is a flow, since for vertex the total flow is correctly defined,
        and each of the vertices preserves $\flow$ due to~\eqref{almost-flow-eqn}.
      %\begin{remark}
        %Sometimes it might be useful to consider slightly different definition of the network.
        %Instead of studying an oriented graph with a positive flow on it we might consider
        %an undirected graph with a skew-symmetric flow on the edges.
        %Intuitively, the direction of the flow could be expressed either via the direction of the edge
        %or with the sign of the flow , and these two definitions describe the same objects.
        %Formally there is a isomorphism between these two types of objects.
      %\end{remark}
      \begin{remark}
        Note that the network $\net(\fsys)$ depends only on the biorthogonal system $\fsys$ and not on the operator $T$.
        Only the flow $\flow$ depends on the operator $T$.
      \end{remark}
      What can be said about the total flow in each of the vertex of the constructed network $\net(\fsys)$?
      Due to the trick we performed, the total flow became zero in each of the vertices from the left and the right parts.
      The total flow $d(\source)$ in the source vertex is equal to $\sum T_{ll}$, and the total flow in the
        sink vertex is now equal to $\sum T_{rr}$.
      Now one can see that the network $\net(\fsys)$ is $\flow$-preserving if and only if the trace of the operator $T$ is equal to zero.
      \begin{definition}
        Consider a network $\net = (V, E, \len, \source, \sink)$ and a flow $\flow$ on it.
        We write $\lvert\flow\rvert$ for the \emph{mass} of the flow $\flow$:
        \[
          \lvert\flow\rvert = \sum_{e \in E} \lvert\flow(e) \len(e)\rvert.
        \]
        For the flow $\flowpos$ on the oriented network we will use the same notation.
        %We allow it to be equal $+\infty$ as well.
      \end{definition}
      %\begin{definition}
        %If $\flowpos$ is an oriented flow on the oriented network $\net = (V,\vec{E},\len, \source, \sink)$,
          %we can introduce the same term for the \emph{mass} of the flow:
        %\[
          %\lvert\flowpos\rvert = \sum_{e \in \vec{E}} \lvert\flowpos(e) \len(e)\rvert.
        %\]
        %Though in the oriented case the flow is always positive,
          %so we are allowed to omit the modulus signs:
        %\[
          %\lvert\flowpos\rvert = \sum_{e \in \vec{E}} \flowpos(e) \len(e).
        %\]
      %\end{definition}
      \begin{theorem}
        \label{thm-graph-eq}
          Let $\net(\fsys) = B(\fsys, \len, \source, \sink)$ be a B-network constructed
            from the B-class system $\fsys = \seq{f}$.
          Then $\fsys$ is rank one dense if and only if
            the network $\net(\fsys)$ is $\flow$-preserving for any finite-mass flow $\flow$.
      \end{theorem}
      \begin{proof}
        Suppose that the system $\seq{f}$ is not rank one dense.
        As we mentioned before, it implies that there exists a trace class operator $T: \cal{H} \to \cal{H}$ with
          the trace equal to one, such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$.
        Using the operator $T$, we were able to define a flow $\flow$ on the network $\net(\fsys)$.
        The constructed flow has a finite mass because the operator matrix of $T$ is finite-band and $T$ has a finite trace.
        Finally, the network $\net(\fsys)$ does not preserve the flow since
        \[
          d(\source) + d(\sink) = \sum_{l} T_{ll} + \sum_{r} T_{rr} = Tr(T) = 1,
        \]
        thus $d(\sink) \neq -d(\source)$.
        The necessity is proved.

        Suppose that the system $\fsys$ is rank one dense.
        Assume that there is also a flow $\flow$ on the network $\net(\fsys)$ such that $d(\sink) + d(\source) \neq 0$.
        Firstly, consider the edges incident to the source vertex.
        Having all the vertices already enumerated we will consider the vertices in the left part $v_{l}$.
        Recall that each vertex $v_i$ (except source and sink) matches to the basis element $e_i$.
        Assign the diagonal elements of $T$:
        \[
          T_{ll} = \flow(v_l, \source) \len(v_l v_l) = \flow(v_l, \source), \quad l > 0.
        \]
        Similarly for the right part:
        \[
          T_{rr} = \flow(v_r, \sink) \len(v_r v_r) = \flow(v_r, \sink), \quad r > 0.
        \]
        Now consider two connected vertices $v_l$, $v_r$ from the left and right part respectively.
        Let $T_{lr} = \flow(v_l, v_r) \len(v_l  v_r)$,
        and all the other elements of the operator matrix $T_{ij}$ be zero.
        Then observe that we obtained a finite-band operator matrix $T_{ij}$ with the sum of diagonal elements equal to one.
        Since the mass of the flow $\flow$ is finite, $T_{ij}$ is a summable sequence, considering that
          the $\ell^1$-norm of $T_{ij}$ is exactly the mass of $\flow$.
        Then the operator $T$ has a finite nonzero trace, since $Tr(T) = d(\sink) + d(\source)$, which is not zero
          by the assumption we made.
        Due to the fact~\eqref{almost-flow-eqn} that $\flow$ is preserved at each vertex of the network $\net(\fsys)$,
          we can see that the operator $T$ annihilates all the rank one operators $R_1(\cal{A})$,
          which is a contradiction to the rank one density property.
      \end{proof}

  \bigskip
  \section{B-networks characterisation}
    \label{sec:char}
    Due to Theorem~\ref{thm-graph-eq}, we are able to analyze the flows on the B-network
      $\net(\fsys)$ in order to understand the conditions under which $\fsys$ is rank one dense.
    In this section we are not going to address the Hilbert space framework at all,
      instead we will use only the graph theory objects we introduced in the previous section.
    It will be more convenient for us to study the \emph{oriented} networks in this section unlike we
      did in the previous one.
    Consequently, the graphs, edges and networks are presumed to be oriented unless said otherwise.

    Next we introduce a few more notions of the graph theory.
    \begin{definition}
      Let $G = (V, E)$ be an oriented graph.
      A sequence of vertices $\{v_n\}_{n=1}^N$ is called a \emph{path} if each pair of consecutive vertices
        $v_n$ and $v_{n+1}$ are connected by an edge $(v_n v_{n+1})$ and no edges or vertices are repeated twice in the sequence.
      The path is called a \emph{ray} when $N$ is equal to infinity.
    \end{definition}
    \begin{definition}
      Let $G$ be an oriented graph.
      A finite sequence of vertices $\{v_n\}_{n=1}^N$ is called a \emph{cycle} (or a simple cycle) if it is
        a path and there is an edge $e = (v_N v_1)$ connecting the last vertex to the first vertex of the sequence.
    \end{definition}

    The main result of this section is Theorem~\ref{ray-thm}.
    \begin{theorem}
      \label{ray-thm}
      Let $\net = (G, \len, \source, \sink)$ be an oriented B-network.
      Then a positive flow $\flowpos: E \to \mathbb{R}^{+}$ such that
      \begin{enumerate}[label=(\alph*)]
        \item the flow $\flowpos$ has a finite mass,
        \item the network $\net$ does not preserve the flow,
      \end{enumerate}
      exists if and only if there exists a ray $r = \seq{r}$ in the network $\net$, taking its start in the vertex $\source$,
        with a finite total length:
      \[
        \sum_{n=1}^\infty \len(r_n r_{n+1}) < \infty.
      \]
    \end{theorem}
    %\begin{remark}
      %\label{inner-ray-rmk}
      %Notice that the definition of the B-network implies that the weight of any edge
        %incident to the source or the sink vertices is equal to one.
      %The ray $r$ has a finite length and thus it follows that only a finite number of edges $(r_k r_{k+1})$ could
        %be incident either to the source or to sink vertices.
      %This way the existence of the ray $r$ suggests that there also exists a ray $r^* \in V \setminus \left\{\source, \sink\right\}$.
    %\end{remark}
    \begin{proof}
      Without loss of generality we might assume that $d(\sink) + d(\source) = 1$.
      To simplify the proof, we consider a modified network $\net' = (G', \source', \source')$.
      Namely, we merge the source vertex $\source$ with the sink vertex $\sink$ and call this a new source vertex $\source'$.
      This way we obtain a network $\net'$ with a single source such that $d(\source') = 1$.
      In that case the graph $G'$ is a rooted graph with the root at the vertex $\source'$.
      From now on we will employ the term \emph{root vertex} and denote it by $\root = \source$.

      %Formally we set the sink vertex in the modified network to be the same as the source vertex: $\sink'=\source'$.
      The flow $\flowpos$ as well as the length function $\len$ stays exactly the same (being defined on the edges set $E'$).
      All the vertices in the graph continue preserving the flow after this procedure, except for the source vertex $\source'$,
        which is now \emph{$\flowpos$-active} since its total flow $d(\source')$ is equal to one.
      Thus $\net'$ is a network with a function $\flowpos$ being a flow as required.
      Obviously, the mass of the flow does not change since we did not change the lengths of the edges.
      Furthermore, the network $\net'$ does not preserve the flow $\flowpos$ by construction.

      It is clear that $\net'$ contains a finite length ray starting on the vertex $s'$ if and only if the original network $\net$ contains a finite
        length ray starting on the vertex $s$.

      Therefore, we will be proving the following version of Theorem~\ref{ray-thm}.
      \begin{theorem*}
        Let $\net = (G, \len, \source, \sink)$ be an oriented B-network such that $\source = \sink$.
        Then a positive finite-mass flow $\flowpos: E \to \mathbb{R}^{+}$ such that
          $\net$ does not preserve $\flowpos$ (it means that $d(\source) \neq 0$)
          exists if and only if there exists a ray $r = \seq{r}$ which has a finite total length and starts on $\source$.
      \end{theorem*}
      First we prove the necessity.
      Suppose that there is a ray of a finite total length $r=(r_1 r_2 \dots)$.
      In that case we set the resulting flow $\flowpos(r_n r_{n+1})$ to one, creating a flow which escapes
        from $\source$ to infinity.
      All the other edges will not carry any flow, hence the flow is preserved
        at each vertex but not preserved by the whole network $\net$.
      The necessity is proved, now we turn to the sufficiency.
      \smallskip
      \subsection{Eliminating the positive flow cycles}
        For a start we get rid of all the positive flow cycles in the oriented graph $G$.
        \emph{A positive flow cycle} is a cycle $C$ in $G$ such that positive flow circulates along $C$,
          meaning that for each edge $e \in C$ we have $\flowpos(e) > 0$.
        %You can see an example of positive flow cycle in the Figure~\ref{positive-flow}.
        %\include{fig-pos-flow-cycle}
        In order to accomplish that, we will present a sequence of the flows $\flowposn{n}$, defined on the network $\net$.
        At each step $n \in \mathbb{N}$ we examine a finite subgraph $G_n \subset G$ and present a flow $\flowposn{n}: \net \to \mathbb{R}^{+}$
          such that $\flowposn{n}$ is monotone: for any edge $e \in E$ we have $\flowposn{n+1}(e) \leq \flowposn{n}(e)$.
        The main property of the flow $\flowposn{n}$ is that there will be no positive flow cycles in the induced subgraph
        $G_n$.
        We start with the flow $\flowposn{0}:\net \to \mathbb{R}^+$ equal to the flow $\flowpos$.
        %\[
          %\flowposn{0}(e) = \flowpos(e), \quad e \in E.
        %\]
        The first step $n = 1$ is trivial: the graph $G_1$ contains only the root vertex, and
          the flow $\flowposn{1}$ is equal to $\flowposn{0}$ at any edge $e \in E$.
        %\[
          %\flowposn{1}(e) = \flowposn{0}(e), \quad e \in E.
        %\]

        In order to proceed we enumerate all vertices in the network $V = \left\{v_s\right\}_{s=1}^\infty$.
        At the step $n$ we consider the subgraph $G_n = (V_n, E_n) \subset G$, where $V_n$ is defined as $\left\{v_s\right\}_{s=1}^n$
          and the edge set $E_n$ consists of the edges from $E$ incident to $V_n$.

        Suppose we have already established the flow $\flowposn{n}: \net \to \mathbb{R}^{+}$ for which
          all the inequalities above are satisfied.
        We are aiming to construct the flow $\flowposn{n+1}$.

        Define the flow function $\cal{E}_0(e): \net \to \mathbb{R}^{+}$ as $\cal{E}_0(e) = \flowposn{n}(e).$
        Let $C_1$ be a simple cycle in the graph $G_n$ such that each edge $e \in C_1$ carries
          a positive flow: $\cal{E}_0(e) > 0$.
        At this point we can decrease the flow $\cal{E}_0$ on the edges of $C_1$ so that the cycle $C_1$
          ceases being a positive flow cycle, total mass of the flow does not increase, and all the other properties stay intact.
        Denote by $\min(C_1)$ the minimal value the flow $\cal{E}_0$ attains on the edges of $C_1$.
            %\min(C_1) = \min_{e \in C_1}\left(\cal{E}_0(e)\right).
        Consider an adjusted flow $\cal{E}_1$.
        \begin{equation*}
          \cal{E}_1(e) =
          \begin{cases}
            \cal{E}_0(e) - \min(C_1) \quad \text{if } e \in C_1,\\
            \cal{E}_0(e) \quad \text{otherwise}.
          \end{cases}
        \end{equation*}
        Since $C_1$ is a cycle, we reduced the flow $\cal{E}_0$ in each edge by the same value,
          so $\cal{E}_1$ is indeed a flow.
        After this procedure the positive flow cycle $C_1$ disappears,
          leaving us with a lesser flow than we had before this step: $\cal{E}_1(e) \leq \cal{E}_0(e)$ for any $e \in E_n.$
        In this manner we remove all the positive flow cycles from the finite graph $G_n$.
        It is achievable since at each step we turn at least one edge into a zero-flow edge (such edge $e$ that $\cal{E}_0(e) = 0$).

        Suppose we removed $K$ positive flow cycles in total from the graph $G_n$.
        Then set the flow $\flowposn{n+1}$ equal to the final flow $\cal{E}_K$: $\flowposn{n+1} = \cal{E}_K.$
        We have $\flowposn{n+1}(e) \leq \flowposn{n}(e) \leq \flowpos(e)$ for each edge $e \in E$.

        Now set $\preflow(e) = \lim\limits_{n \to \infty} \flowposn{n}(e)$ for each $e \in E$.
        The described pointwise limit exists since for each edge $e$ the sequence $\{\flowposn{n}(e)\}_{n=1}^\infty$ is decreasing and bounded below.
        \begin{prop}
          The preflow $\preflow$ is a flow such that $d_{\preflow}(\root) = d_{\flowpos}(\root)$.
          The graph $G$ contains no positive flow cycles of $\preflow$.
        \end{prop}
        \begin{proof}
          Obviously, for each $n$ the function $\flowposn{n}$ is a flow since we do not affect the total flow each time we remove a positive flow cycle.

          Now we need to obtain the same for the limit case.
          Firstly, look at the non-root vertex $v \neq \root$.
          Since there are a finite number of edges in $E$ incident with $v$, the limit of
            a finite sum $d_{\flowposn{n}}(v)$ is equal to $d_{\preflow}(v)$.
          The vertex $v$ is not a root, so $d_{\flowposn{n}}(v) = 0$ for any $n$, and so the limit $d_{\preflow}(v)$ is equal to zero as well.
          Consequently, the function $\preflow$ is a flow in the network $\net$.

          Secondly, consider the root vertex $\root$.
          It may have an infinite degree.
          Notice that
          \[
            d_{\flowposn{n}}(\root) \overset{\mathit{def}}{=} \sum_{\eout(\root)} \flowposn{n}(e) - \sum_{\ein(\root)} \flowposn{n}(e).
          \]
          Since the sequence $\{\flowposn{n}(e)\}_{n=1}^\infty$ is decreasing and bounded from below,
            the quantity $d_{\preflow}(\root)=\sum_{\eout(\root)} \preflow(e) - \sum_{\ein(\root)} \preflow(e)$ is defined correctly.
          Because $d_{\flowposn{n}}(\root)$ is equal to $d_\flowpos(\root)$ for any $n$ due to the given algorithm, we have
          \[
            d_\preflow(\root) = \lim_{n \to \infty} d_{\flowposn{n}}(\root) = d_\flowpos(\root).
          \]
          Thus, $\preflow$ is a flow, let us prove the second part of the proposition.
          To obtain a contradiction, suppose that there is a cycle $C$ such that $\preflow(e) > 0$ for
            each edge $e \in C$.
          Clearly, there exists such $n$ that the cycle $C$ lies within the graph $G_n$.
          Since at each step we reduced the flow, at the step $n$
            the cycle $C$ was a positive flow cycle as well: $\flowposn{n}(e) > 0$ for each edge $e \in C$.
          That is a contradiction.
        \end{proof}

        Now we can assume that $\flowpos$ contained no positive flow cycles in the first place.
        Also we remove the edges of the network $\net$ for which the flow $\flowpos$ equals zero.

      \medskip
      \subsection{Subgraphs construction}
        We are going to need a few definitions in order to proceed with the proof of the theorem.
        \begin{definition}
          Let $G = (V, E,\len, \root)$ be a weighted directed graph with a positive
            length function $\len$ defined on $E$ and a root vertex $\root \in V$.
          Then $\gpaths(u, v)$ denotes the set of paths from the vertex $u$ to the vertex $v$ in the graph $G$.
          Sometimes we will omit the first argument, and in that case we will refer to the paths from the root vertex
            $\gpaths(v) = \gpaths(\root, v)$.
          Furthermore, we expand this notion onto the vertices sets: $\gpaths(U,V)$ is the set of paths
            from the set of vertices $U$ to the set of vertices $V$ in the graph $G$.
          We write $\gpaths$ for the set of all paths in the graph $G$.
        \end{definition}
        \begin{definition}
          The distance function $\gfi: \gpaths \to \mathbb{R}^{+}$ is given by $\gfi(p) = \sum_{e \in p} \len(e)$.
          We extend this function to take values on the set of the vertices $V$ as well,
            $\gfi(v) = \displaystyle\inf_{\gpaths(v)} \gfi(p).$
        \end{definition}
        \begin{remark}
          Our ambition in the following paragraphs is to provide an estimate on the values of the distance function $\gfi$ on any vertex $v$
            located ''far'' from $\root$, namely for any integer $N > 0$ we are to provide $M > 0$ such that
            for any $v$ satisfying $\displaystyle\inf_{p \in \gpaths(v)} \#\left\{ e \mid e \in p\right\} > N$,
              one has $\gfi(v) < M$, where the symbol $\#$ denotes the number of elements in the set.
        \end{remark}

        The construction is based on the breadth-first search in the infinite graph $G$.
        We are going to define \emph{finite} subgraphs $G_n = (V_n, E_n)$ of the network $\net$ such that $G_{n-1} \subset G_{n}$ for each $n > 1$.
        We denote by $L_n$ the vertex set difference $V_n \setminus V_{n-1}$.
        Besides, we are going to establish a sequence of the positive preflow functions $\flowposn{n}: E_n \to \mathbb{R}^{+}$,
          pertaining the following properties.
        \begin{enumerate}[label=\textbf{P\arabic*}]
          \item \label{p1} $\flowposn{n+1}(e) \geq \flowposn{n}(e)$ for each $e \in E_n$;
          \item \label{p2} $\flowposn{n}(e) \leq \flowpos(e)$ for each $e \in E_n$;
          \item \label{p3} for the root vertex one has $d_{\flowposn{n}}(\root) = 1$;
          \item \label{p4} for any non-root $v \in G_{n-1}$ one has $d_{\flowposn{n}}(v) = 0$, for any $n > 1$;
          \item \label{p5} for each vertex $v \in L_n$ one has $d_{\flowposn{n}}(v) = -d^{-}_{\flowposn{n}}(v) < 0$.
        \end{enumerate}
        First of all, we scale the flow function $\flowpos$ at the root vertex so that $d^{+}_{\flowpos}(\root) > 1$.
        We are going to need this assumption at the first step.
      \medskip
      \subsection{Constructing \texorpdfstring{$G_n$}{Gn} and \texorpdfstring{$L_n$}{Ln}}
        Let $G_0$ be the trivial subgraph containing the root vertex only: $G_0 = \left\{ \root \right\}$.
        At the first step we build the graph $G_1$.
        We choose the set of the edges $E_1 \subseteq \eout(\root)$ such that $\sum_{e \in E_1} \flowpos(e) \geq 1$.
        It is possible since $d^{+}_{\flowpos}(\root) > 1$.

        Then we define the \emph{first layer} $L_1$ as the end vertices of $E_1$: $L_1 = \ter(E_1)$.
        Along with the graph $G_1 = (V_0 \cup L_1, E_1)$ we set the preflow $\flowposn{1}: E_1 \to \mathbb{R}^{+}$
        \[
          \flowposn{1}(e) = \frac{\flowpos(e)}{\sum_{e\in E_1}{\flowpos(e)}}, \quad e \in E_1.
        \]
        \begin{prop}
          The preflow $\flowposn{1}$ satisfies all of the properties~\ref{p1}--\ref{p5}.
        \end{prop}
        \begin{proof}
          The properties~\ref{p1}--\ref{p4} are trivial to check.

          We included the ends of $E_1$ edges without any additional edges.
          Thus each vertex in $L_1$ has only incoming edges, which makes their
            total flow strictly negative (recall that we removed all zero-flow edges).
          Thus~\ref{p5} holds as well.
        \end{proof}
        \begin{remark}
          We dealt with the possibly infinite degree of the root vertex by abandoning some of the children of the root.
          %\alex{a figure of the first layer (infinite degree!)}
          We need $G_n$ to be finite in order to analyze the function $\gfi$.
        \end{remark}

        We proceed by induction.
        Suppose that $G_{n-1}$, $L_{n-1}$ and the preflow $\flowposn{n-1}$ are already defined.
        Consider the outgoing edges of the vertex $v \in L_{n-1}$.
        Some of them might lead to some new vertices, which do not belong to $G_{n-1}$.
        Such edges will be referred to as $\efor_n$,
        \[
          \efor_n = \Big\{ e = (uv) \mid u \in L_{n-1} \text{ and } v \notin G_{n-1}\Big\}.
        \]
        Other edges might lead to the already visited vertices of $G$, namely the ones residing in the graph $G_{n-1}$.
        Such edges we will address as the \emph{back} edges of $L_{n-1}$ and denote them by $\eback_n$,
        \[
          \eback_n = \Big\{e = (us) \mid u \in L_{n-1} \text{ and } s \in G_{n-1}\Big\}.
        \]
        \begin{remark}
          Note that \emph{back} edge could never lead to the root vertex since that
            would yield an existence of a positive flow cycle for the flow $\flowpos$.
        \end{remark}
        %\alex{a figure of the $n$-th layer construction}
        Finally, we set $G_n$ and $L_n$.
        \begin{align*}
          &L_n = \ter(\efor_n),\\
          &G_n = (V_{n-1} \cup L_n, E_{n-1} \cup \eback_n \cup \efor_n).
        \end{align*}

      \medskip
      \subsection{\texorpdfstring{$n$}{n}-th step: setting a preflow}
        We divide the procedure in two steps.
        Consider the preflow function $\cal{G}: E_n \to \mathbb{R}^{+}$.
        \begin{align*}
          &\cal{G}(e) = \flowposn{n-1}, \quad e \in E_{n-1},\\
          &\cal{G}(e) = 0, \quad e \in E_n \setminus E_{n-1}.
        \end{align*}
        We are going to extend it further onto $E_n$ (step one) and then change it gradually in order
          to satisfy all the properties~\ref{p1}--~\ref{p5} (step two).
        Notice that all the vertices except the root and the last layer $L_{n-1}$ are $\cal{G}$-preserving.
        The root is $\cal{G}$-deficient and the $(n-1)$-th layer is currently $\cal{G}$-active.
        We first change the flow in the vertices $L_{n-1}$ in order to make them preserve the flow $\cal{G}$.
        For this purpose, we propagate the flow $\cal{G}$, incoming to the $(n-1)$-th layer, one edge further.

        Namely, consider the vertex $u \in L_{n-1}$.
        By~\ref{p2} we have $d_{\cal{G}}^{-}(u) \leq d_{\flowpos}^{-}(u)$,
          so we are able to set the flow $\cal{G}$ on the outgoing edges of $u$ in the following way:
        \begin{enumerate}[label=\textbf{(\roman*)}]
          \item\label{posprop} each outgoing edge has a positive flow: $\cal{G}(e) > 0$ for any $e \in \eout(u)$;
          \item $\cal{G}$ is still bounded from above: $\cal{G}(e) \leq \flowpos(e)$ for any $e \in \eout(u)$;
          \item the vertex $u \in L_{n-1}$ becomes $\cal{G}$-preserving.
        \end{enumerate}
        \begin{remark}
          Literally, here we are pushing the flow out of the vertex $u \in L_{n-1}$ and spreading it among all the outgoing edges
            $\eout_{G_n}(u) = \eout_G(u)$.
          Since the preflow $\cal{G}$ is bounded above by the flow $\flowpos$, which is preserved at each vertex of the graph $G$,
            particularly, at the vertex $u$, it is trivial that such an expansion exists.
        \end{remark}
        If we had no back edges, the function $\cal{G}$ would be the next preflow function $\flowposn{n}$, and this step would be accomplished,
          since all the properties~\ref{p1}--\ref{p5} would be complied by $\cal{G}$.
        However, the flow pushed from the $(n-1)$-th layer across the back edges made some of the vertices in $G_{n-1}$ \emph{not} flow-preserving.
        Namely, the end vertices of such edges $\eback_{n}$ now became $\cal{G}$-active, since for such vertices
          the total incoming flow now exceeds the total outgoing flow.
        %\alex{a figure of a back edge making some inner vertex non-preserving, unite with the figure of n-th layer?}
        Finally, we have reached the step number two of the $\flowposn{n}$ construction.
        We are going to carry out the \emph{relaxation} procedure in order to alleviate the flow excess in those $\cal{G}$-active vertices.

          %Denote $\gnpaths(\makebox[1ex]{$\cdot$}, \makebox[1ex]{$\cdot$}) = \cal{P}_{G_n}(\makebox[1ex]{$\cdot$},\makebox[1ex]{$\cdot$})$.
        For simplicity of notation we continue to write $\gnpaths$ instead of $\cal{P}_{G_n}$.
        Consider a $\cal{G}$-active vertex $s \in \ter(\eback_n)$ such that $d_{\cal{G}}^{-}(s) > d_{\cal{G}}^{+}(s)$.
        \begin{definition}
          A path $p \in \gnpaths(s, L_n)$ is referred as a \emph{$\cal{G}$-augmenting} path for the vertex $s$
            if $\delta_{max}=\min\limits_{e \in p}(\flowpos(e) - \cal{G}(e)) > 0$.
        \end{definition}
        The latter means that the preflow $\cal{G}$ can be increased along this path by some constant $\delta \leq \delta_{max}$
          in such a fashion that the preflow $\cal{G}(e)$ does not exceed the flow $\flowpos(e)$ for each $e \in p$.
        Obviously, for a $\cal{G}$-augmenting path $p$ one has $\cal{G}(e) < \flowpos(e)$ for each $e \in p$.
%            $\delta \leq d_{\cal{G}}^{-}(s) - d_{\cal{G}}^{+}(s) = -d_{\cal{G}}(s)$.
        \begin{definition}
          The edge $e$ is called a \emph{$\cal{G}$-saturated} edge if $\cal{G}(e) = \flowpos(e)$.
          The path $p$ is called \emph{$\cal{G}$-saturated} if there exists such an edge $e \in p$ that $e$ is $\cal{G}$-saturated.
        \end{definition}
        For each path $p \in \gnpaths(s, L_n)$ we are going to raise the preflow $\cal{G}$ at every edge of the path $p$
        by some $\delta > 0$.
        We call the described procedure \emph{relaxation} of the vertex $s$.
        Strictly speaking, the {relaxation}
          of the vertex $s$ is a reduction of the excess of the flow $\cal{G}$ in the vertex $s$.
        Our purpose is to relax the vertex $s$, transforming it into a $\cal{G}$-preserving vertex.

        On one hand, if $\delta_{max} \geq -d_{\cal{G}}(s)$, then \emph{pushing} the flow precisely $-d_{\cal{G}}(s)$ along the path $p$
          is enough to make the vertex $s$ preserving $\cal{G}$, where 
          \emph{pushing} the flow $C \in \mathbb{R}$ along the path $p$ means raising the flow $\cal{G}$ at each edge $e \in p$:
          $\cal{G}(e) \to \cal{G}(e) + C$.

        On the other hand, if $\delta_{max} < -d_{\cal{G}}(s)$, then pushing the flow $\delta_{max}$ along the path $p$ is not enough
          in order to make the vertex $\cal{G}$-preserving.
        In this case we push the flow $\delta_{max}$ along the path $p$ and look for the other augmenting paths in $\gnpaths(s, L_n)$.
        We will repeat the outlined procedure until we finally relax the vertex $s$.
        \begin{prop}
          Any vertex $s$ will be $\cal{G}$-relaxed in a finite number of steps.
        \end{prop}
        \begin{proof}
          Firstly, we have a finite graph $G_{n}$, and so there are only a finite number of paths in $\gnpaths(s, L_n)$.
          Secondly, each time we push the flow along the augmenting path $p$ either we successfully relax the vertex $s$
            or we saturate at least one edge lying on the chosen path $p$.
          Since the number of the edges is finite, the procedure halts after a finite number of steps.

          Thus, it happened that there are no augmenting paths in $\gnpaths(s, L_n)$.
          Examine the set of vertices $S \subseteq G_n$ that are reachable by non-saturated paths from the vertex $s$.
          We have $S \cap L_n = \emptyset$, hence $S \subseteq G_{n-1}$.
          Now consider the subgraph
            \[
              U = \bigcup\big\{p \in \gnpaths(s, S) \mid \text{$p$ is not $\cal{G}$-saturated}\big\}.
            \]
          Similarly, the subgraph $U$ does not contain any vertices from $L_n$.
          \begin{lemma}
            Any edge $e \in \eout_G(U)$ is saturated.
          \end{lemma}
          \begin{proof}
            Due to the absence of the positive flow cycles, the root vertex is not in $U$.
            Since for each non-root vertex in $G_{n-1}$ we included every outgoing edge into $G_n$,
              the edge $e$ belongs to $G_n$.
            If $e$ is not saturated, then its ending vertex $\ter(e)$ lies in $S$.
            Therefore, the edge $e$ belongs to $U$.
            We arrived to a contradiction.
          \end{proof}
          For a vertex $u \in S$ we see that $d_{\cal{G}}(u) = d^{+}_{\cal{G}}(u) - d^{-}_{\cal{G}}(u) \leq 0$, because
            the only $\cal{G}$-deficient vertex in the graph $G_n$ is the root vertex $\root$, which is not in $U$.
          Also for the vertex $s$ itself we have a strict inequality $d_{\cal{G}}(s) < 0$ since it is not relaxed by our assumption.
          It is clear now that the quantity $D = \sum_{u \in U} d_{\cal{G}}(u)$ is strictly less than zero.
          On the other hand,
          \[
            \begin{split}
              D &= \mathlarger\sum_{u \in U} \Big(d^{+}_{\cal{G}}(u) - d^{-}_{\cal{G}}(u)\Big)
              = \mathlarger{\smashoperator{\sum_{\eout_{G_n}(U)}}} \cal{G}(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \cal{G}(e) = \\
              &= \mathlarger{\smashoperator{\sum_{\eout_{G}(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \cal{G}(e)
                \overset{\ref{p2}}{\geq} \mathlarger{\smashoperator{\sum_{\eout_G(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G_n}(U)}}} \flowpos(e) 
                \overset{G_n \subset G} \geq \\
              &\geq \mathlarger{\smashoperator{\sum_{\eout_G(U)}}} \flowpos(e) - \mathlarger{\smashoperator{\sum_{\ein_{G}(U)}}} \flowpos(e) = 0.
            \end{split}
          \]
          Thus we deduce that $0 > D \geq 0$, and that is a contradiction.
        \end{proof}
        It follows that we can relax all the vertices in $\eback_n$.
        Conclusively, we set the preflow $\flowposn{n}$ equal to $\cal{G}$ that we got after the relaxations.
        \begin{prop}
          The properties~\ref{p1}--\ref{p5} are satisfied for the resulting preflow $\flowposn{n}$ on the network $\net_n = (G_n, \len, \root)$.
        \end{prop}
        \begin{proof}
          The monotonicity property~\ref{p1} is true since during the relaxation step we
            only increased the flow on the edges of the graph $G_n$.

          The boundedness property~\ref{p2} is also true since we chose the flow values in such a way
            that the bound $\flowposn{n}(e) \leq \flowpos(e)$ holds for each edge $e\in G_n$.

          The root vertex was not affected during the step $n > 1$, so~\ref{p3} holds.

          The flow $\cal{G}$ was redesigned in such a fashion that each non-root vertex $v$ in $G_{n} \setminus 
            \left(L_n \cup \{\root\}\right)$ became $\cal{G}$-preserving.
          This checks the property~\ref{p4}.

          Finally, due to the property~\ref{posprop} and the fact that
          any vertex in $L_n$ has only incoming edges in the graph $G_n$, the property~\ref{p5} holds.
        \end{proof}
        The flow construction is completed.

        \medskip
        \subsection{Estimates on the constructed preflow}
          For abbreviation, let $\phi_n$ stand for $\phi_n(v) = \phi_{G_n}(v)$.
          Likewise, we define the functions $d_n$, $d^{-}_n$, $d^{+}_n$.
          \begin{lemma}
            For each $G_n$, $n > 1$,
            \begin{equation}
              \label{main-ineq}
              \sum_{v\in L_n}d_{n}^{-}(v) \phi_n(v) \leq \sum_{e \in E_n} \len(e) \flowpos(e).
            \end{equation}
          \end{lemma}
          \begin{proof}
            Set
            \[
              LS = \sum_{v \in L_n} d_n^{-}(v) \phi_n(v) = \sum_{v \in V_n} d_n^{-}(v) \phi_n(v).
            \]
            The last equality holds since $\phi_n(\root) = 0$ and $d_n(u) = 0$
              for any $u \in G_{n} \setminus \left(L_n \cup \{\root\}\right)$,

            Next we regroup the summation in order to have a sum over the edges of $G_n$, not vertices.
            Recall that $d_n^{+}(v) = 0$ for each vertex $v \in L_n$,
              hence $d_n(v) = -d_n^{-}(v)$ whenever $v$ is in the $n$-th layer.
            \begin{align*}
              LS = \sum_{v \in V_n} d_n^{-}(v) \phi_n(v) = -\sum\limits_{v \in V_n} d_n(v) \phi_n(v) =\\
              =-\sum_{v \in V_n} \left(\sum_{\eout(v)} \flowposn{n}(e) - \sum_{\ein(v)}\flowposn{n}(e) \right) \phi_n(v)=\\
              =\sum_{(vu) \in E_n} \flowposn{n}(vu) \big(\phi_n(u) - \phi_n(v)\big).
            \end{align*}
            For any $(vu) \in E_n$ we have $\phi_n(u) \leq \phi_n(v) + \len(vu).$
            Therefore,
            \[
              LS\leq\sum_{(vu) \in E_n} \flowposn{n}(vu) \len(vu)= \sum_{e \in E_n} \flowposn{n}(e) \len(e) \overset{\ref{p2}}{\leq} \sum_{e \in E_n} \flowpos(e) \len(e).
            \]
            Inequality~\eqref{main-ineq} is proved.
          \end{proof}

          In what follows we prove that there is a vertex in any layer such that its root-distance is bounded by the mass of the flow.
          \begin{prop}
            \label{prop36}
            For each $n > 0$ there exists a vertex $r_n \in L_n$ such that $\phi_n(r_n) \leq \lvert\flowpos\rvert$.
          \end{prop}
          \begin{proof}
            We continue to write $LS$ for the left hand side of the inequality~\eqref{main-ineq}.
            Then
            \[
              LS = \sum_{v \in L_n}d^{-}_n(v) \phi_n(v) \geq \min_{v \in L_n}\phi_n(v) \sum_{v \in L_n} d^{-}_n(v).
            \]
            Since $\sum_{v \in L_n} d^{-}_n(v)$ is the total amount of the flow incoming to the deepest layer $L_n$, and the only
              active vertex in $G_n$ is the root, which produces the flow whose size is equal to $1$, we have $\sum_{v \in L_n} d^{-}_n(v) = d^{+}_n(\root) = 1.$
            Consequently, $LS \geq \min\limits_{v \in L_n} \phi_n(v).$

            Furthermore, combining the latter with~\eqref{main-ineq}, one gets
              \[
              \min_{L_n} \phi_n(v) \leq \sum_{e \in E_n} \len(e) \flowpos(e) \leq \lvert\flowpos\rvert.
              \]
            Since $L_n$ contains a finite number of vertices, there exists a vertex $r_n \in L_n$ such that
              $\phi_n(r_n) \leq \lvert\flowpos\rvert.$
          \end{proof}
          \begin{prop}
            There exists a ray $r=(r_1 r_2\dots)$ in the network $\net$ such that $\sum\limits_{n=1}^\infty \len(r_n r_{n+1}) < \infty$.
          \end{prop}
          \begin{proof}
            We will look for the ray $r$ in the graph $\gstar = \bigcup G_n.$
            We abbreviate $\phi_{\gstar}(v)$ to $\phistar$.
            Consider the paths $p$, starting on the root, such that $\phistar(p) \leq \lvert\flowpos\rvert$.
            Denote this set of paths by $\cal{P}^*$.

            For each $n > 0$ we are going to present a vertex $r_n$ such that there are an infinite number of paths
              in $\cal{P}^*$ starting on $(r_1 r_2 \dots r_n)$.

            At the first step we set $r_1 = \root$.
            By proposition~\ref{prop36}, for each layer $L_n$ there is a vertex $v_n \in L_n$ such that
              $\phi_n(v_n) \leq \lvert\flowpos\rvert$.
            Since $\phistar(v_n) \leq \phi_n(v_n)$, and there are an infinite number of layers,
              $\cal{P}^*$ contains an infinite number of paths.

            Now assume we have already constructed the path $p_n = (r_1 r_2\dots r_n)$ such that
              there are an infinite number of paths in $\cal{P}^*$ starting with the path $p_n$.
            The graph $\gstar$ is locally finite and in particular the degree of $r_n$ is finite.
            Since the number of the paths from $\cal{P}^*$ starting with $p_n$ is infinite by the assumption,
              we are able to choose $r_{n+1} \in \eout_{G^*}(r_n)$ such that the number of paths in $\cal{P}^*$ starting from
              the path $p_{n+1}= (p_n r_n)$ is infinite as well.

            We constructed the ray $r = (r_1 r_2 \dots) \subseteq \gstar$.
            The total length of the ray $\sum \len(r_n r_{n+1})$ is finite
              since the partial sums are bounded by $\lvert \flowpos \rvert$.
          \end{proof}
          We found a finite-length ray in the network $\net$.
          Hence, the implication is proved as well as the theorem itself.
      \end{proof}

      \medskip
      \subsection{Main theorem}
        Now we present the proof of Theorem~\ref{thm-main} using Theorems~\ref{thm-graph-eq} and~\ref{ray-thm}.
        \begin{proof}[Proof of Theorem~\ref{thm-main}]
          The system $\fsys$ belongs to B-class, so we can apply Theorem~\ref{thm-graph-eq}, which asserts
            that $\fsys$ admits the rank one density property if and only if
            the corresponding network $\net(\fsys)$ is $\flow$-preserving for any
            finite-mass flow $\flow$.
          We rephrase the last conclusion in terms of \emph{oriented} networks.
          The system $\fsys$ admits the rank one density property if and only if
            the oriented network $\net(\fsys)$ is $\flowpos$-preserving for any
            finite-mass flow $\flowpos$.
          After that we utilize Theorem~\ref{ray-thm}, which states that there exists such
            flow $\flowpos: E \to \mathbb{R}^{+}$ with a finite mass that is not preserved in
            the network $\net(\fsys)$, if and only if there exists a ray $r^{*} \subseteq \net$, originating in the vertex $\source$,
            whose total length is finite $\sum_{n=1}^\infty \len(r^{*}_n r^{*}_{n+1}) < \infty$.
          Combining these two statements we get that $\fsys$ is \emph{not} rank one dense if and only if
            there is a finite-length ray $r^*$ in the network $\net(\fsys)$.
          It is obvious that $r^*$ cannot include infinite number of the edges incident to the vertices
            $\source$ and $\sink$, since such edges have the length exactly one.
          Therefore, such $r^*$ exists in $\net(\fsys)$ if and only if there is a ray $r=\seq{r}$ in the original bipartite graph $B(\fsys)$ such that
            the series $\sum_{n=1}^\infty\lvert\len(r_n r_{n+1})\rvert$ converges.
          The theorem is proved.
        \end{proof}
        %\begin{figure}
          %\begin{center}
          %\begin{tikzpicture}[thick,
                              %every node/.style={draw,circle},
                              %%every fit/.style={ellipse,draw,inner sep=-1pt,text width=2cm},
                              %]
            %%\draw[help lines,step=9mm,gray!70] (0,-6) grid (6,0);
            %\node[fill=gray,draw, xshift=-3cm, yshift=-3.5cm] (source) {$s$};
            %\begin{scope}[start chain=going below,node distance=7mm]
              %\foreach \i in {1,3,5,7}
              %\node[lnode,on chain] (l\i) [] {$e_{\i}$};
              %\node[draw=none,on chain, yshift=7mm]{$\vdots$};
            %\end{scope}
            %\begin{scope}[xshift=3cm,yshift=-0.5cm,start chain=going below,node distance=7mm]
              %\foreach \i in {2,4,6,8}
              %\node[rnode,on chain] (r\i) [] {$e_\i$};
              %\node[draw=none,on chain, yshift=7mm]{$\vdots$};
            %\end{scope}
            %\node[xshift=6cm,yshift=-3.5cm,draw] (sink) {$t$};

            %% the set U
            %%\node [fit=(l1) (l5),label=above:\emph{left}] {};
            %% the set V
            %%\node [fit=(r6) (r9),label=above:\emph{right}] {};

            %% the edges
            %\foreach [evaluate={\k=int(\i*2 + 1)}] \i in {0,...,3}
            %\draw(source)--(l\k);
            %\foreach [evaluate={\k=int(\i*2 + 2)}] \i in {0,...,3}
            %\draw(sink)--(r\k);
            %\draw (l1) -- (r2);
            %\draw (r2) -- (l3);
            %\draw (l3) -- (r4);
            %\draw (r4) -- (l5);
            %\draw (l5) -- (r6);
            %\draw (r6) -- (l7);
            %\draw (l7) -- (r8);
          %\end{tikzpicture}
          %\caption{The network $\net$ built for the LW-system $\fsys_{LW}$} \label{LW-net}
          %\end{center}
        %\end{figure}

    \section{The \texorpdfstring{$k$}{k} point density property for B-class}
      \label{sec:kpd}
      In this section we investigate the connection between the $k$ point density property~\eqref{kpd} and
        the rank one density property~\eqref{r1d} in the context of B-class systems.
      Though it remains unclear for us whether there is an $M$-basis which is two point dense but not three point dense,
        even for B-class systems, we are able to prove the following theorem.

      \begin{theorem}
        \label{thm-kpd}
        Consider a B-class system $\fsys$ which has a band width equal to $B$.
        If $\fsys$ is $4B - 2$ point dense then it is rank one dense.
      \end{theorem}
      We are going to use the idea from~\cite{me} to get a reformulation for the $k$ point density property.
      \begin{prop}
        \label{prop-vec-est}
        The system $\fsys$ is $k$ point dense if and only if there exist vector sequences $\{u_l\}_{l=0}^\infty$, $\{u^*_l\}_{l=0}^\infty$,
          $\{v_r\}_{r=0}^\infty$ and $\{v^*_r\}_{r=0}^\infty$ in $\ell^2 (\mathbb{R}^k)$, such that
        \begin{equation}
          \label{prop-vec-eqn}
          \inner{u_l}{u^*_l + \sum_{r=0}^\infty v_r f_{lr}} = 0, \quad \quad
          \inner{v_r}{v^*_r + \sum_{l=0}^\infty u_l f_{rl}^*} = 0.
        \end{equation}
      \end{prop}
      \begin{proof}
        The system $\fsys$ is not $k$ point dense if and only if there exists an operator $T = \sum_{s=1}^k y^s \otimes x^s$, where
          $x^s, y^s \in \cal{H}$, such that $\inner{Tf_n}{f_n^*} = 0$ for any $n$.
        Consider vectors $v_l$, $u_l$ in $\mathbb{R}^k$ as follows
        \begin{equation*}
          v_r = (x^1_r, x^2_r, \dots, x^k_r),\qquad
          u_l = (y^1_l, y^2_l, \dots, y^k_l),
        \end{equation*}
          where $x^s_r = \inner{x^s}{e_r}$ and $y^s_l = \inner{y^s}{e_l}$.
        Then $T_{lr} = \sum_{s=1}^k y^s_l x^s_r = \inner{v_r}{u_l}$.
        According to~\eqref{almost-flow-eqn} the condition $\inner{Tf_n}{f^*_n} = 0$ could be viewed as
          $\inner{u_l}{u^*_l + \sum_r v_r f_{lr}} = 0$
        when the index $n=l$ corresponds to the left part of $B(\fsys)$ and
          $\inner{v_l}{v^*_l - \sum_l u_l f_{lr}} = 0$
        when the index $n=r$ corresponds to the right part of $B(\fsys)$.
      \end{proof}
      \begin{corol*}
        The system $\fsys$ is not $k$ point dense if and only if each vertex $v$ in the graph $B(\fsys)$ can be
          equipped with two vectors $z_v$, $z_v^*$ in $\mathbb{R}^k$ such that $\inner{z_v}{z_v^* + \sum\limits_{v \sim x} z_x \wt_{vx}} = 0$,
          where $v \sim x$ means that there is an edge between the vertices $v$ and $x$.
      \end{corol*}
      \begin{proof}[Proof of Theorem~\ref{thm-kpd}]
        Suppose that $\fsys$ is not rank one dense.
        According to Theorem~\ref{thm-main} there is an infinite ray $\seq{r}$ in the bipartite
          graph $B(\fsys)$ such that the series $\sum\lvert\wt_n\rvert$ converges.
        Here and below we write $\wt_n$ for $\wt(r_n, r_{n + 1})$, the weight of the $n$-th edge in the ray $r$.
        We are going to present vector sequences $\{z_n\}_{n=1}^\infty$, $\{z^*_n\}_{n=1}^\infty$ in $\ell^2 (\mathbb{R}^{4B-2})$
          such that~\eqref{prop-vec-eqn} hold.

        For each vertex $v$ that does not belong to the ray $\seq{r}$, we set the corresponding pair of vectors $z_v$, $z^*_v$ to zero.
        For the first vertex $r_1$ we set the vector $z_1$ to the vector $(2\wt^{-1/2}_1, 0, 0, \dots)$ and
          the vector $z^*_1$ to the unit vector $(0.5\wt^{1/2}_1, 0, 0, \dots)$;
          for all other $r_n$ we set $z^*_n$ to zero.

        We define the value $M_n = \max(\wt_{n-1}^{-1/2}, \wt_n^{-1/2})$; notice that $M_{n - 1} M_n \geq \wt_{n - 1}$ (let $M_0 = \wt_0 = 0$).

        Let $V_n$ denote the subspace $span(z_m  \mid m < n - 1 \text{ and } r_m \sim r_n)$.
        The dimension of $V_n$ is not greater than $2B - 2$.
        For each $n > 0$ we are to choose $z_n$ that satisfies four following conditions:
        \begin{itemize}
          \item First, $M_n \leq \lvert z_n \rvert \leq 3 M_n$,
          \item Secondly, $\wt_{n-1}\inner{z_n}{z_{n - 1}} = 1$,
          \item Thirdly, $z_n$ must be orthogonal to $V_n$,
          \item Finally, the angle between $z_n$ and $V_{n + 1}$ is at least $\pi/4$.
        \end{itemize}

        We argue by induction that such sequence $\seq{z}$ exists.
        Remember that $z_1$ is already set, and it satisfies all the conditions.
        Now suppose that we have set $z_{n - 1}$.
        We are going to find a vector $z$ which satisfies the first three conditions.

        Consider $U_1 = \{z \in \mathbb{R}^{4B-2} \mid \wt_{n-1} \inner{z}{z_{n-1}} = 1\}$ and $U_2 = V_n^\bot$.
        The dimension of $U_1$ is equal to $4B - 3$ and the dimension of $U_2$ is equal to $2B$.
        Due to the last condition the angle between $z_{n - 1}$ and $V_n$ is at least $\pi / 4$.
        Then the angle between $z_{n-1}$ and $U_2$ is at most $\pi / 4$.
        The subspace $U_1 \cap U_2$ is not empty since the angle between $z_{n-1}$ and $U_2$ is not $\pi/2$ and
          has the dimension equal to $2B-1$.
        The distance from zero to $U_1 \cap U_2$ is at most $d_{min} = 1/\cos(\pi/4)\lvert z_{n-1} \wt_{n-1}\rvert^{-1}$
          since the angle between $z_{n-1}$ and $U_2$ does not exceed $\pi/4$.
        Notice that $d_{min} = \sqrt{2} \lvert z_{n-1} \wt_{n-1} \rvert^{-1} \leq \sqrt{2}M_n$.
        Thus there exist vectors with the length $\sqrt{2}M_n$ in $U_1 \cap U_2$ (and form a set of dimension $2B-2$).

        This implies that we can choose a vector $z$ which complies with the first three conditions (and its length is exactly $\sqrt{2}M_n$).

        Assume the last condition does not hold for $z$.
        Then we find a unit vector $\zeta \in \mathbb{R}^{4B - 2}$ such that $\zeta$ is orthogonal to the linear subspace $V$ generated by
          $z_{n-1}$, $V_{n}$, $V_{n + 1}$.
        Since each vertex in the graph has degree at most $2B$, the subspace $V$ has dimension at most $1 + (2B - 2) + (2B - 2) = 4B - 3$.
        In $\mathbb{R}^{4B-2}$ such unit vector $\zeta$ exists.
        If the angle between $\zeta$ and $z$ is more than $\pi/2$ then choose $\zeta = -\zeta$.
        Then the vector $z_n = z + \lvert z \rvert \zeta$ satisfies all four conditions.

        Therefore, the sequence $\{z_n\}_{n=1}^\infty$ exists and the second and third conditions guarantee that~\eqref{prop-vec-eqn} holds.
        The constructed $\{z_n\}$ is square summable since $\lvert z_n \rvert \leq 3M_n$ and the sequence $\{M_n\}$ is square summable.
        Due to~\eqref{prop-vec-est} the system $\fsys$ is not $4B - 2$ point dense.
      \end{proof}
      \begin{remark*}
        In the graph theory terms it follows that if the maximal degree of $B(\fsys)$ is equal to $d$,
          then the $2d - 3$ point density implies the rank one density of $\fsys$.
      \end{remark*}
  \bigskip
  \section{Questions}
    First, we are interested whether the estimate $4B - 2$ in Proposition~\eqref{prop-vec-est} can be improved, for example to some constant.
    Secondly, we would like to know if Theorem~\ref{thm-main} holds for a larger class of $M$-bases, for instance, whether the condition of
      local finiteness of the graph $B(\fsys)$ or the condition~\ref{c5} could be dropped from the definition of B-class systems.
    Finally, it is of interest whether there is an elementary generalization of our approach to the case of a complex Hilbert space.

  \section{Acknowledgements}
    The author wishes to express his gratitude to Professor Dmitry Yakubovich for suggesting
      the construction of $M$-bases using the bipartite graphs.
    The author gratefully acknowledges the many helpful suggestions of
      Professor Anton Baranov during the preparation of the paper.
\begin {thebibliography}{20}
  \bibitem{argyroslambrou}
    S.~\!Argyros, M.~\!Lambrou and W.E.~\!Longstaff,
    \emph{Atomic Boolean Subspace Lattices and Applications to the Theory of Bases},
    Memoirs. Amer. Math. Soc., No. 445 (1991).

  \bibitem{azoff}
    E.~\!Azoff, H.~\!Shehada,
    \emph{Algebras generated by mutually orthogonal idempotent operators},
    J. Oper. Theory, 29 (1993), 2, 249--267.

  %\bibitem{bbb}
    %A.~\!Baranov, Y.~\!Belov and A.~\!Borichev,
    %\emph{Hereditary completeness for systems of exponentials and reproducing kernels},
    %Adv. Math., 235 (2013), 1, 525--554.

  %\bibitem{bbb1}
    %A.~\!Baranov, Y.~\!Belov and A.~\!Borichev,
    %\emph{Spectral synthesis in de Branges spaces},
    %Geom. Funct. Anal. (GAFA), 25 (2015), 2, 417--452.

  %\bibitem{ad_preprint}
    %A.D.~\!Baranov, D.V.~\!Yakubovich,
    %\emph{Completeness and spectral synthesis of nonselfadjoint one-dimensional
    %perturbations of selfadjoint operators},
    %Advances in Mathematics, 302 (2016), 740--798;

  \bibitem{erdos}
    J.A.~\!Erdos,
    \emph{Operators of finite rank in nest algebras},
    J. London Math. Soc., 43 (1968), 391--397.

  \bibitem{review}
    J.A.~\!Erdos,
    \emph{Basis theory and operator algebras},
    In: A.~\!Katavolos (ed.), Operator Algebras and Application, Kluwer Academic Publishers, 1997, 209--223.

  \bibitem{katavolos}
    A.~\!Katavolos, M.~\!Lambrou and M.~\!Papadakis,
    \emph{On some algebras diagonalized by $M$-bases of $\ell^2$},
    Integr. Equat. Oper. Theory, 17 (1993), 1, 68--94.

  \bibitem{larson}
    D.~\!Larson, W.~\!Wogen,
    \emph{Reflexivity properties of $T\bigoplus0$},
    J. Funct. Anal., 92 (1990), 448--467.

  \bibitem{laurielongstaff}
    C.~\!Laurie, W.~\!Longstaff,
    \emph{A note on rank one operators in reflexive algebras},
    Proc. Amer. Math. Soc., 89 (1983), 293--297.

  \bibitem{longstaff}
    W.E.~\!Longstaff,
    \emph{Operators of rank one in reflexive algebras},
    Canadian J. Math., 27 (1976), 19--23.

  \bibitem{raney}
    G.N.~\!Raney,
    \emph{Completely distributive complete lattices},
    Proc. Amer. Math. Soc. 3 (1952), 677--680.

  \bibitem{me}
    A.~\!Pyshkin
    \emph{On the $k$ point density problem for band-diagonal $M$-bases},
    Operators and Matrices (2020), Vol. 14 Number 2, 455--468.


% \bibitem{nikolski}
    %N.K.~\!Nikol'skii,
    %\emph{Complete extensions of Volterra operators},
    %Izv. Akad. Nauk SSSR Ser. Mat 33(1969), 1349--1355. (Russian)
\end{thebibliography}
\end{document}
